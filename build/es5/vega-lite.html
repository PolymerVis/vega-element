<html><head><script>!function(z){"object"==("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"undefined"!=typeof module?module.exports=z():"function"==typeof define&&define.amd?define([],z):("undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?this:self:global:window).vl=z()}(function(){return function z(H,B,V){function W(G,X){if(!B[G]){if(!H[G]){var K="function"==typeof require&&require;if(!X&&K)return K(G,!0);if(q)return q(G,!0);var Q=new Error("Cannot find module '"+G+"'");throw Q.code="MODULE_NOT_FOUND",Q}var Z=B[G]={exports:{}};H[G][0].call(Z.exports,function(J){var $=H[G][1][J];return W($||J)},Z,Z.exports,z,H,B,V)}return B[G].exports}for(var q="function"==typeof require&&require,Y=0;Y<V.length;Y++)W(V[Y]);return W}({1:[function(z,H){var V="undefined"==typeof JSON?z("jsonify"):JSON;H.exports=function(Y,G){G||(G={}),"function"==typeof G&&(G={cmp:G});var X=G.space||"";"number"==typeof X&&(X=Array(X+1).join(" "));var K="boolean"==typeof G.cycles&&G.cycles,Q=G.replacer||function($,ee){return ee},Z=G.cmp&&function($){return function(ee){return function(te,ae){var ne={key:te,value:ee[te]},ie={key:ae,value:ee[ae]};return $(ne,ie)}}}(G.cmp),J=[];return function $(ee,te,ae,ne){var ie=X?"\n"+Array(ne+1).join(X):"",oe=X?": ":":";if(ae&&ae.toJSON&&"function"==typeof ae.toJSON&&(ae=ae.toJSON()),void 0!==(ae=Q.call(ee,te,ae))){if("object"!=("undefined"===typeof ae?"undefined":babelHelpers.typeof(ae))||null===ae)return V.stringify(ae);if(W(ae)){for(var re,le=[],se=0;se<ae.length;se++)re=$(ae,se,ae[se],ne+1)||V.stringify(null),le.push(ie+X+re);return"["+le.join(",")+ie+"]"}if(-1!==J.indexOf(ae)){if(K)return V.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}J.push(ae);for(var ce,de=q(ae).sort(Z&&Z(ae)),le=[],se=0;se<de.length;se++)if(ce=$(ae,te=de[se],ae[te],ne+1),ce){var pe=V.stringify(te)+oe+ce;le.push(ie+X+pe)}return J.splice(J.indexOf(ae),1),"{"+le.join(",")+ie+"}"}}({"":Y},"",Y,0)};var W=Array.isArray||function(Y){return"[object Array]"==={}.toString.call(Y)},q=Object.keys||function(Y){var G=Object.prototype.hasOwnProperty||function(){return!0},X=[];for(var K in Y)G.call(Y,K)&&X.push(K);return X}},{jsonify:2}],2:[function(z,H,B){B.parse=z("./lib/parse"),B.stringify=z("./lib/stringify")},{"./lib/parse":3,"./lib/stringify":4}],3:[function(z,H){var V,W,q,Y,G={'"':"\"","\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},X=function(ne){throw{name:"SyntaxError",message:ne,at:V,text:q}},K=function(ne){return ne&&ne!==W&&X("Expected '"+ne+"' instead of '"+W+"'"),W=q.charAt(V),V+=1,W},Q=function(){var ne,ie="";for("-"===W&&(ie="-",K("-"));"0"<=W&&"9">=W;)ie+=W,K();if("."===W)for(ie+=".";K()&&"0"<=W&&"9">=W;)ie+=W;if("e"===W||"E"===W)for(ie+=W,K(),"-"!==W&&"+"!==W||(ie+=W,K());"0"<=W&&"9">=W;)ie+=W,K();return(ne=+ie,isFinite(ne))?ne:void X("Bad number")},Z=function(){var ne,ie,oe,le="";if("\""===W)for(;K();){if("\""===W)return K(),le;if("\\"!==W)le+=W;else if(K(),"u"===W){for(oe=0,ie=0;4>ie&&(ne=parseInt(K(),16),isFinite(ne));ie+=1)oe=16*oe+ne;le+=String.fromCharCode(oe)}else{if("string"!=typeof G[W])break;le+=G[W]}}X("Bad string")},J=function(){for(;W&&" ">=W;)K()},$=function(){switch(W){case"t":return K("t"),K("r"),K("u"),K("e"),!0;case"f":return K("f"),K("a"),K("l"),K("s"),K("e"),!1;case"n":return K("n"),K("u"),K("l"),K("l"),null;}X("Unexpected '"+W+"'")},ee=function(){var ne=[];if("["===W){if(K("["),J(),"]"===W)return K("]"),ne;for(;W;){if(ne.push(Y()),J(),"]"===W)return K("]"),ne;K(","),J()}}X("Bad array")},te=function(){var ne,ie={};if("{"===W){if(K("{"),J(),"}"===W)return K("}"),ie;for(;W;){if(ne=Z(),J(),K(":"),Object.hasOwnProperty.call(ie,ne)&&X("Duplicate key \""+ne+"\""),ie[ne]=Y(),J(),"}"===W)return K("}"),ie;K(","),J()}}X("Bad object")};Y=function(){switch(J(),W){case"{":return te();case"[":return ee();case"\"":return Z();case"-":return Q();default:return"0"<=W&&"9">=W?Q():$();}},H.exports=function(ae,ne){var ie;return q=ae,V=0,W=" ",ie=Y(),J(),W&&X("Syntax error"),"function"==typeof ne?function oe(le,se){var re,de,ce=le[se];if(ce&&"object"==("undefined"===typeof ce?"undefined":babelHelpers.typeof(ce)))for(re in ce)Object.prototype.hasOwnProperty.call(ce,re)&&(void 0===(de=oe(ce,re))?delete ce[re]:ce[re]=de);return ne.call(le,se,ce)}({"":ie},""):ie}},{}],4:[function(z,H){function V(Q){return X.lastIndex=0,X.test(Q)?"\""+Q.replace(X,function(Z){var J=K[Z];return"string"==typeof J?J:"\\u"+("0000"+Z.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+Q+"\""}function W(Q,Z){var J,$,ee,te,ae,ne=q,ie=Z[Q];switch(ie&&"object"==("undefined"===typeof ie?"undefined":babelHelpers.typeof(ie))&&"function"==typeof ie.toJSON&&(ie=ie.toJSON(Q)),"function"==typeof G&&(ie=G.call(Z,Q,ie)),"undefined"===typeof ie?"undefined":babelHelpers.typeof(ie)){case"string":return V(ie);case"number":return isFinite(ie)?ie+"":"null";case"boolean":case"null":return ie+"";case"object":if(!ie)return"null";if(q+=Y,ae=[],"[object Array]"===Object.prototype.toString.apply(ie)){for(te=ie.length,J=0;J<te;J+=1)ae[J]=W(J,ie)||"null";return ee=0===ae.length?"[]":q?"[\n"+q+ae.join(",\n"+q)+"\n"+ne+"]":"["+ae.join(",")+"]",q=ne,ee}if(G&&"object"==("undefined"===typeof G?"undefined":babelHelpers.typeof(G)))for(te=G.length,J=0;J<te;J+=1)"string"==typeof($=G[J])&&(ee=W($,ie))&&ae.push(V($)+(q?": ":":")+ee);else for($ in ie)Object.prototype.hasOwnProperty.call(ie,$)&&(ee=W($,ie))&&ae.push(V($)+(q?": ":":")+ee);return ee=0===ae.length?"{}":q?"{\n"+q+ae.join(",\n"+q)+"\n"+ne+"}":"{"+ae.join(",")+"}",q=ne,ee;}}var q,Y,G,X=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,K={"":"\\b","	":"\\t","\n":"\\n","":"\\f","\r":"\\r",'"':"\\\"","\\":"\\\\"};H.exports=function(Q,Z,J){var $;if(q="",Y="","number"==typeof J)for($=0;$<J;$+=1)Y+=" ";else"string"==typeof J&&(Y=J);if(G=Z,Z&&"function"!=typeof Z&&("object"!=("undefined"===typeof Z?"undefined":babelHelpers.typeof(Z))||"number"!=typeof Z.length))throw new Error("JSON.stringify");return W("",{"":Q})}},{}],5:[function(z,H){(function(V){var W,q,Y,G,X,K,Q,Z,J,$,ee,te,ae,ne,ie,oe;!function(le){function se(de,ce){return function(pe,ue){return de[pe]=ce?ce(pe,ue):ue}}var re="object"==("undefined"===typeof V?"undefined":babelHelpers.typeof(V))?V:"object"==("undefined"===typeof self?"undefined":babelHelpers.typeof(self))?self:"object"==babelHelpers.typeof(this)?this:{};le("object"==("undefined"===typeof H?"undefined":babelHelpers.typeof(H))&&"object"==babelHelpers.typeof(H.exports)?se(re,se(H.exports)):se(re))}(function(le){var se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(re,de){re.__proto__=de}||function(re,de){for(var ce in de)de.hasOwnProperty(ce)&&(re[ce]=de[ce])};W=function(de,ce){function pe(){this.constructor=de}se(de,ce),de.prototype=null===ce?Object.create(ce):(pe.prototype=ce.prototype,new pe)},q=Object.assign||function(re){for(var de,ce=1,pe=arguments.length;ce<pe;ce++)for(var ue in de=arguments[ce],de)Object.prototype.hasOwnProperty.call(de,ue)&&(re[ue]=de[ue]);return re},Y=function(de,ce){var pe={};for(var ue in de)Object.prototype.hasOwnProperty.call(de,ue)&&0>ce.indexOf(ue)&&(pe[ue]=de[ue]);if(null!=de&&"function"==typeof Object.getOwnPropertySymbols)for(var re=0,ue=Object.getOwnPropertySymbols(de);re<ue.length;re++)0>ce.indexOf(ue[re])&&(pe[ue[re]]=de[ue[re]]);return pe},G=function(de,ce,pe,ue){var me,re=arguments.length,ge=3>re?ce:null===ue?ue=Object.getOwnPropertyDescriptor(ce,pe):ue;if("object"==("undefined"===typeof Reflect?"undefined":babelHelpers.typeof(Reflect))&&"function"==typeof Reflect.decorate)ge=Reflect.decorate(de,ce,pe,ue);else for(var fe=de.length-1;0<=fe;fe--)(me=de[fe])&&(ge=(3>re?me(ge):3<re?me(ce,pe,ge):me(ce,pe))||ge);return 3<re&&ge&&Object.defineProperty(ce,pe,ge),ge},X=function(de,ce){return function(pe,ue){ce(pe,ue,de)}},K=function(de,ce){if("object"==("undefined"===typeof Reflect?"undefined":babelHelpers.typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(de,ce)},Q=function(de,ce,pe,ue){return new(pe||(pe=Promise))(function(me,ge){function fe(_e){try{ye(ue.next(_e))}catch(Se){ge(Se)}}function he(_e){try{ye(ue.throw(_e))}catch(Se){ge(Se)}}function ye(_e){_e.done?me(_e.value):new pe(function(Se){Se(_e.value)}).then(fe,he)}ye((ue=ue.apply(de,ce||[])).next())})},Z=function(de,ce){function pe(_e){return function(Se){return ue([_e,Se])}}function ue(_e){if(me)throw new TypeError("Generator is already executing.");for(;ye;)try{if(me=1,ge&&(fe=ge[2&_e[0]?"return":_e[0]?"throw":"next"])&&!(fe=fe.call(ge,_e[1])).done)return fe;switch(ge=0,fe&&(_e=[0,fe.value]),_e[0]){case 0:case 1:fe=_e;break;case 4:return ye.label++,{value:_e[1],done:!1};case 5:ye.label++,ge=_e[1],_e=[0];continue;case 7:_e=ye.ops.pop(),ye.trys.pop();continue;default:if(fe=ye.trys,!(fe=0<fe.length&&fe[fe.length-1])&&(6===_e[0]||2===_e[0])){ye=0;continue}if(3===_e[0]&&(!fe||_e[1]>fe[0]&&_e[1]<fe[3])){ye.label=_e[1];break}if(6===_e[0]&&ye.label<fe[1]){ye.label=fe[1],fe=_e;break}if(fe&&ye.label<fe[2]){ye.label=fe[2],ye.ops.push(_e);break}fe[2]&&ye.ops.pop(),ye.trys.pop();continue;}_e=ce.call(de,ye)}catch(Se){_e=[6,Se],ge=0}finally{me=fe=0}if(5&_e[0])throw _e[1];return{value:_e[0]?_e[1]:void 0,done:!0}}var me,ge,fe,he,ye={label:0,sent:function(){if(1&fe[0])throw fe[1];return fe[1]},trys:[],ops:[]};return he={next:pe(0),throw:pe(1),return:pe(2)},"function"==typeof Symbol&&(he[Symbol.iterator]=function(){return this}),he},J=function(de,ce){for(var pe in de)ce.hasOwnProperty(pe)||(ce[pe]=de[pe])},$=function(de){var ce="function"==typeof Symbol&&de[Symbol.iterator],pe=0;return ce?ce.call(de):{next:function(){return de&&pe>=de.length&&(de=void 0),{value:de&&de[pe++],done:!de}}}},ee=function(de,ce){var pe="function"==typeof Symbol&&de[Symbol.iterator];if(!pe)return de;var ue,me,ge=pe.call(de),fe=[];try{for(;(void 0===ce||0<ce--)&&!(ue=ge.next()).done;)fe.push(ue.value)}catch(he){me={error:he}}finally{try{ue&&!ue.done&&(pe=ge.return)&&pe.call(ge)}finally{if(me)throw me.error}}return fe},te=function(){for(var de=[],ce=0;ce<arguments.length;ce++)de=de.concat(ee(arguments[ce]));return de},ae=function(de){return this instanceof ae?(this.v=de,this):new ae(de)},ne=function(de,ce,pe){function ue(ve){Se[ve]&&(_e[ve]=function(xe){return new Promise(function(Ee,Ne){1<be.push([ve,xe,Ee,Ne])||me(ve,xe)})})}function me(ve,xe){try{ge(Se[ve](xe))}catch(Ee){ye(be[0][3],Ee)}}function ge(ve){ve.value instanceof ae?Promise.resolve(ve.value.v).then(fe,he):ye(be[0][2],ve)}function fe(ve){me("next",ve)}function he(ve){me("throw",ve)}function ye(ve,xe){ve(xe),be.shift(),be.length&&me(be[0][0],be[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _e,Se=pe.apply(de,ce||[]),be=[];return _e={},ue("next"),ue("throw"),ue("return"),_e[Symbol.asyncIterator]=function(){return this},_e},ie=function(de){function ce(me,ge){de[me]&&(pe[me]=function(fe){return(ue=!ue)?{value:ae(de[me](fe)),done:"return"===me}:ge?ge(fe):fe})}var pe,ue;return pe={},ce("next"),ce("throw",function(me){throw me}),ce("return"),pe[Symbol.iterator]=function(){return this},pe},oe=function(de){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var ce=de[Symbol.asyncIterator];return ce?ce.call(de):"function"==typeof $?$(de):de[Symbol.iterator]()},le("__extends",W),le("__assign",q),le("__rest",Y),le("__decorate",G),le("__param",X),le("__metadata",K),le("__awaiter",Q),le("__generator",Z),le("__exportStar",J),le("__values",$),le("__read",ee),le("__spread",te),le("__await",ae),le("__asyncGenerator",ne),le("__asyncDelegator",ie),le("__asyncValues",oe)})}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],6:[function(z,H,B){!function(V,W){W("object"==("undefined"===typeof B?"undefined":babelHelpers.typeof(B))&&void 0!==H?B:V.vega=V.vega||{})}(this,function(V){"use strict";function W(ce){return J.hasOwnProperty(ce)}function q(ce,pe,ue,me,ge){for(var fe,he=0,ye=ce.length;pe<ye;++pe){if(fe=ce[pe],!he&&fe===ue)return pe;ge&&0<=ge.indexOf(fe)?--he:me&&0<=me.indexOf(fe)&&++he}return pe}function Y(ce){for(var pe=[],ue=0,me=ce.length,ge=0;ge<me;)ge=q(ce,ge,oe,ee+ae,te+ne),pe.push(ce.substring(ue,ge).trim()),ue=++ge;if(0===pe.length)throw"Empty event selector: "+ce;return pe}function G(ce){return"["===ce[0]?X(ce):K(ce)}function X(ce){var pe,ue,me=ce.length,ge=1;if((ge=q(ce,ge,te,ee,te))===me)throw"Empty between selector: "+ce;if(2!==(pe=Y(ce.substring(1,ge))).length)throw"Between selector must have two elements: "+ce;if((ce=ce.slice(ge+1).trim())[0]!==se)throw"Expected '>' after between selector: "+ce;return pe=pe.map(G),(ue=G(ce.slice(1).trim())).between?{between:pe,stream:ue}:(ue.between=pe,ue)}function K(ce){var pe,ue,me={source:Z},ge=[],fe=[0,0],he=0,ye=0,_e=ce.length,Se=0;if(ce[_e-1]===ne){if(!(0<=(Se=ce.lastIndexOf(ae))))throw"Unmatched right brace: "+ce;try{fe=Q(ce.substring(Se+1,_e-1))}catch(be){throw"Invalid throttle specification: "+ce}_e=(ce=ce.slice(0,Se).trim()).length,Se=0}if(!_e)throw ce;if(ce[0]===le&&(he=++Se),(pe=q(ce,Se,ie))<_e&&(ge.push(ce.substring(ye,pe).trim()),ye=Se=++pe),(Se=q(ce,Se,ee))===_e)ge.push(ce.substring(ye,_e).trim());else if(ge.push(ce.substring(ye,Se).trim()),ue=[],(ye=++Se)===_e)throw"Unmatched left bracket: "+ce;for(;Se<_e;){if((Se=q(ce,Se,te))===_e)throw"Unmatched left bracket: "+ce;if(ue.push(ce.substring(ye,Se).trim()),Se<_e-1&&ce[++Se]!==ee)throw"Expected left bracket: "+ce;ye=++Se}if(!(_e=ge.length)||re.test(ge[_e-1]))throw"Invalid event selector: "+ce;return 1<_e?(me.type=ge[1],he?me.markname=ge[0].slice(1):W(ge[0])?me.marktype=ge[0]:me.source=ge[0]):me.type=ge[0],"!"===me.type.slice(-1)&&(me.consume=!0,me.type=me.type.slice(0,-1)),null!=ue&&(me.filter=ue),fe[0]&&(me.throttle=fe[0]),fe[1]&&(me.debounce=fe[1]),me}function Q(ce){var pe=ce.split(oe);if(!ce.length||2<pe.length)throw ce;return pe.map(function(ue){var me=+ue;if(me!==me)throw ce;return me})}var Z,J,ee="[",te="]",ae="{",ne="}",ie=":",oe=",",le="@",se=">",re=/[[\]{}]/,de={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};V.selector=function(ce,pe,ue){return Z=pe||"view",J=ue||de,Y(ce.trim()).map(G)},Object.defineProperty(V,"__esModule",{value:!0})})},{}],7:[function(z,H,B){!function(V,W){W("object"==("undefined"===typeof B?"undefined":babelHelpers.typeof(B))&&void 0!==H?B:V.vega=V.vega||{})}(this,function(V){"use strict";function W(ge){return null==ge?null:ge.fields}function q(ge){return Z(ge)?"["+ge.map(q)+"]":J(ge)||$(ge)?JSON.stringify(ge).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):ge}function Y(ge,fe,he){var ye=[fe].concat([].slice.call(he));console[ge].apply(console,ye)}function G(ge){return ue(ge)?ge:pe(ge)?ge:Date.parse(ge)}var X=function(fe,he,ye){return fe.fields=he||[],fe.fname=ye,fe},K=function(fe){throw Error(fe)},Q=function(fe){function he(){be.push(Ee+fe.substring(ye,_e)),Ee="",ye=_e+1}var ye,_e,Se,be=[],ge=null,ve=0,xe=fe.length,Ee="";for(fe+="",ye=_e=0;_e<xe;++_e)if("\\"===(Se=fe[_e]))Ee+=fe.substring(ye,_e),ye=++_e;else if(Se===ge)he(),ge=null,ve=-1;else{if(ge)continue;ye===ve&&"\""===Se?(ye=_e+1,ge=Se):ye===ve&&"'"===Se?(ye=_e+1,ge=Se):"."!==Se||ve?"["===Se?(_e>ye&&he(),ve=ye=_e+1):"]"===Se&&(ve||K("Access path missing open bracket: "+fe),0<ve&&he(),ve=0,ye=_e+1):_e>ye?he():ye=_e+1}return ve&&K("Access path missing closing bracket: "+fe),ge&&K("Access path missing closing quote: "+fe),_e>ye&&(_e++,he()),be},Z=Array.isArray,J=function(fe){return fe===Object(fe)},$=function(fe){return"string"==typeof fe},ee=function(fe,he){var ye=Q(fe),_e="return _["+ye.map(q).join("][")+"];";return X(Function("_",_e),[fe=1===ye.length?ye[0]:fe],he||fe)},te=[],ae=ee("id"),ne=X(function(ge){return ge},te,"identity"),ie=X(function(){return 0},te,"zero"),oe=X(function(){return 1},te,"one"),le=X(function(){return!0},te,"true"),se=X(function(){return!1},te,"false"),re=function(fe){return null==fe?[]:Z(fe)?fe:[fe]},de=function(fe){return"function"==typeof fe},ce={},pe=function(fe){return"[object Date]"===Object.prototype.toString.call(fe)},ue=function(fe){return"number"==typeof fe},me=function(fe,he){for(var ye="";0<=--he;)ye+=fe;return ye};V.accessor=X,V.accessorName=function(ge){return null==ge?null:ge.fname},V.accessorFields=W,V.id=ae,V.identity=ne,V.zero=ie,V.one=oe,V.truthy=le,V.falsy=se,V.logger=function(ge){var fe=ge||0;return{level:function(ye){return arguments.length?(fe=+ye,this):fe},error:function(){return 1<=fe&&Y("error","ERROR",arguments),this},warn:function(){return 2<=fe&&Y("warn","WARN",arguments),this},info:function(){return 3<=fe&&Y("log","INFO",arguments),this},debug:function(){return 4<=fe&&Y("log","DEBUG",arguments),this}}},V.None=0,V.Error=1,V.Warn=2,V.Info=3,V.Debug=4,V.array=re,V.compare=function(ge,fe){var he,ye,_e,Se,be,ve,xe,Ee,Ne,Te=[],De=(ge=re(ge)).map(function(Ae,Pe){return null==Ae?null:(Te.push(Pe),de(Ae)?Ae:Q(Ae).map(q).join("]["))}),ke=Te.length-1,Oe=re(fe),Ce="var u,v;return ";if(0>ke)return null;for(ye=0;ye<=ke;++ye)_e=De[he=Te[ye]],de(_e)?(Se="(u=this."+(ve="f"+he)+"(a))",be="(v=this."+ve+"(b))",(xe=xe||{})[ve]=_e):(Se="(u=a["+_e+"])",be="(v=b["+_e+"])"),ve="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"===Oe[he]?(Ne=-1,Ee=1):(Ne=1,Ee=-1),Ce+="("+Se+"<"+be+"||u==null)&&v!=null?"+Ee+":(u>v||v==null)&&u!=null?"+Ne+":"+ve+"!==u&&v===v?"+Ee+":v!==v&&u===u?"+Ne+(he<ke?":":":0");return _e=Function("a","b",Ce+";"),xe&&(_e=_e.bind(xe)),ge=ge.reduce(function(Ae,Pe){return de(Pe)?(W(Pe)||[]).forEach(function(Re){Ae[Re]=1}):null!=Pe&&(Ae[Pe+""]=1),Ae},{}),X(_e,Object.keys(ge))},V.constant=function(ge){return de(ge)?ge:function(){return ge}},V.debounce=function(ge,fe){function he(){fe(_e),ye=_e=null}var ye,_e;return function(Se){_e=Se,ye&&clearTimeout(ye),ye=setTimeout(he,ge)}},V.error=K,V.extend=function(ge){for(var fe,he,ye=1,_e=arguments.length;ye<_e;++ye)for(he in fe=arguments[ye],fe)ge[he]=fe[he];return ge},V.extentIndex=function(ge,fe){var he,ye,_e,Se,be,ve=-1,xe=ge.length;if(null==fe){for(;++ve<xe;)if(null!=(ye=ge[ve])&&ye>=ye){he=_e=ye;break}for(Se=be=ve;++ve<xe;)null!=(ye=ge[ve])&&(he>ye&&(he=ye,Se=ve),_e<ye&&(_e=ye,be=ve))}else{for(;++ve<xe;)if(null!=(ye=fe(ge[ve],ve,ge))&&ye>=ye){he=_e=ye;break}for(Se=be=ve;++ve<xe;)null!=(ye=fe(ge[ve],ve,ge))&&(he>ye&&(he=ye,Se=ve),_e<ye&&(_e=ye,be=ve))}return[Se,be]},V.fastmap=function(ge){function fe(Se){return _e.hasOwnProperty(Se)&&_e[Se]!==ce}var he,ye,_e={};return he={size:0,empty:0,object:_e,has:fe,get:function(be){return fe(be)?_e[be]:void 0},set:function(be,ve){return fe(be)||(++he.size,_e[be]===ce&&--he.empty),_e[be]=ve,this},delete:function(be){return fe(be)&&(--he.size,++he.empty,_e[be]=ce),this},clear:function(){he.size=he.empty=0,he.object=_e={}},test:function(be){return arguments.length?(ye=be,he):ye},clean:function(){var be,ve,xe={},Ee=0;for(be in _e)(ve=_e[be])===ce||ye&&ye(ve)||(xe[be]=ve,++Ee);he.size=Ee,he.empty=0,he.object=_e=xe}},ge&&Object.keys(ge).forEach(function(Se){he.set(Se,ge[Se])}),he},V.field=ee,V.inherits=function(ge,fe){var he=ge.prototype=Object.create(fe.prototype);return he.constructor=ge,he},V.isArray=Z,V.isBoolean=function(ge){return"boolean"==typeof ge},V.isDate=pe,V.isFunction=de,V.isNumber=ue,V.isObject=J,V.isRegExp=function(ge){return"[object RegExp]"===Object.prototype.toString.call(ge)},V.isString=$,V.key=function(ge){var fe=(ge=ge?re(ge):ge)&&ge.length?Function("_","return ''+"+ge.map(function(he){return"_["+Q(he).map(q).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return X(fe,ge,"key")},V.merge=function(ge,fe,he,ye){var _e=fe.length,Se=he.length;if(!Se)return fe;if(!_e)return he;for(var be=ye||new fe.constructor(_e+Se),ve=0,xe=0,Ee=0;ve<_e&&xe<Se;++Ee)be[Ee]=0<ge(fe[ve],he[xe])?he[xe++]:fe[ve++];for(;ve<_e;++ve,++Ee)be[Ee]=fe[ve];for(;xe<Se;++xe,++Ee)be[Ee]=he[xe];return be},V.pad=function(ge,fe,he,ye){var _e=he||" ",Se=ge+"",be=fe-Se.length;return 0>=be?Se:"left"===ye?me(_e,be)+Se:"center"===ye?me(_e,~~(be/2))+Se+me(_e,Math.ceil(be/2)):Se+me(_e,be)},V.peek=function(ge){return ge[ge.length-1]},V.repeat=me,V.splitAccessPath=Q,V.stringValue=q,V.toBoolean=function(ge){return null==ge||""===ge?null:ge&&"false"!==ge&&"0"!==ge&&ge},V.toDate=function(ge,fe){return fe=fe||G,null==ge||""===ge?null:fe(ge)},V.toNumber=function(ge){return null==ge||""===ge?null:+ge},V.toString=function(ge){return null==ge||""===ge?null:ge+""},V.toSet=function(ge){for(var fe={},he=0,ye=ge.length;he<ye;++he)fe[ge[he]]=1;return fe},V.truncate=function(ge,fe,he,ye){var _e=null==ye?"\u2026":ye,Se=ge+"",be=Se.length,ve=Math.max(0,fe-_e.length);return be<=fe?Se:"left"===he?_e+Se.slice(be-ve):"center"===he?Se.slice(0,Math.ceil(ve/2))+_e+Se.slice(be-~~(ve/2)):Se.slice(0,ve)+_e},V.visitArray=function(ge,fe,he){if(ge){var ye,_e=0,Se=ge.length;if(fe)for(;_e<Se;++_e)(ye=fe(ge[_e]))&&he(ye,_e,ge);else ge.forEach(he)}},Object.defineProperty(V,"__esModule",{value:!0})})},{}],8:[function(z,H){H.exports={name:"vega-lite",author:"Jeffrey Heer, Dominik Moritz, Kanit \"Ham\" Wongsuphasawat",version:"2.0.0-rc2",collaborators:["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (https://www.domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],homepage:"https://vega.github.io/vega-lite/",description:"Vega-lite provides a higher-level grammar for visual analysis, comparable to ggplot or Tableau, that generates complete Vega specifications.",main:"build/src/index.js",types:"typings/vega-lite.d.ts",bin:{vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},directories:{test:"test"},scripts:{pretsc:"mkdir -p build && rm -rf build/*/** && cp package.json build/",tsc:"tsc",prebuild:"mkdir -p build/site build/test-gallery",build:"npm run build:only","build:only":"npm run tsc && cp package.json build && browserify src/index.ts -p tsify -d -s vl | exorcist build/vega-lite.js.map > build/vega-lite.js",postbuild:"node node_modules/uglify-js/bin/uglifyjs build/vega-lite.js -cm --source-map content=build/vega-lite.js.map,filename=build/vega-lite.min.js.map -o build/vega-lite.min.js && npm run schema","build:examples":"npm run data && npm run build:only && npm run build:examples-only","build:examples-only":"TZ=America/Los_Angeles ./scripts/build-examples.sh && rm -f examples/specs/normalized/*.vl.json && scripts/build-normalized-examples","build:example":"./scripts/build-example.sh","build:toc":"bundle exec jekyll build -q && scripts/generate-toc","build:site":"browserify site/static/main.ts -p [tsify -p site] -d | exorcist build/site/main.js.map > build/site/main.js","build:versions":"scripts/update-version.sh","build:test-gallery":"browserify test-gallery/main.ts -p [tsify -p test-gallery] -d > build/test-gallery/main.js","check:examples":"scripts/check-examples.sh","check:schema":"scripts/check-schema.sh",clean:"rm -rf build && rm -f vega-lite.* & find -E src test site examples -regex '.*\\.(js|js.map|d.ts)' -delete",data:"rsync -r node_modules/vega-datasets/data/* data",link:"npm link && npm link vega-lite",deploy:"scripts/deploy.sh","deploy:gh":"scripts/deploy-gh.sh","deploy:schema":"scripts/deploy-schema.sh",prestart:"npm run data && npm run build && scripts/index-examples",start:"nodemon -x 'npm run build:test-gallery' & browser-sync start --server --files 'build/test-gallery/main.js' --index 'test-gallery/index.html'",poststart:"rm examples/all-examples.json",preschema:"npm run prebuild",schema:"ts-json-schema-generator --path tsconfig.json --type TopLevelExtendedSpec > build/vega-lite-schema.json && npm run renameschema && cp build/vega-lite-schema.json _data/",renameschema:"scripts/rename-schema.sh",presite:"npm run build && npm run data && npm run build:site && npm run build:toc && npm run build:versions",site:"bundle exec jekyll serve",lint:"tslint --project tsconfig.json -c tslint.json --type-check",test:"npm run build:only && npm run test:only && npm run test:runtime && npm run lint",posttest:"npm run schema && npm run data && npm run mocha:examples","test:nocompile":"npm run test:only && npm run test:runtime && npm run lint && npm run mocha:examples","test:only":"nyc --reporter=html --reporter=text-summary npm run mocha:test","test:runtime":"TZ=America/Los_Angeles wdio wdio.conf.js","test:runtime:generate":"rm -Rf test-runtime/resources && VL_GENERATE_TESTS=true npm run test:runtime","test:debug":"npm run tsc && mocha --recursive --debug-brk --inspect build/test","test:debug-examples":"npm run tsc && npm run schema && mocha --recursive --debug-brk --inspect build/examples","mocha:test":"mocha --require source-map-support/register --reporter dot --recursive build/test","mocha:examples":"mocha --require source-map-support/register --reporter dot --recursive build/examples",codecov:"nyc report --reporter=json && codecov -f coverage/*.json","watch:build":"watchify src/index.ts -p tsify -v -d -s vl -o 'exorcist build/vega-lite.js.map > build/vega-lite.js'","watch:tsc":"npm run tsc -- -w","watch:test":"nodemon -x 'npm test'",watch:"nodemon -x 'npm run build && npm run test:nocompile' # already ran schema in build"},repository:{type:"git",url:"https://github.com/vega/vega-lite.git"},license:"BSD-3-Clause",bugs:{url:"https://github.com/vega/vega-lite/issues"},devDependencies:{"@types/chai":"^4.0.2","@types/d3":"^4.10.0","@types/highlight.js":"^9.1.9","@types/json-stable-stringify":"^1.0.31","@types/mkdirp":"^0.5.0","@types/mocha":"^2.2.41","@types/node":"^8.0.19","@types/webdriverio":"^4.8.4",ajv:"5.2.2","browser-sync":"^2.18.13",browserify:"^14.4.0","browserify-shim":"^3.8.14",chai:"^4.1.0",cheerio:"^1.0.0-rc.2",chromedriver:"^2.30.1",codecov:"^2.3.0",d3:"^4.10.0",exorcist:"^0.4.0","highlight.js":"^9.12.0",mkdirp:"^0.5.1",mocha:"^3.5.0",nodemon:"^1.11.0",nyc:"^11.1.0","source-map-support":"^0.4.15","ts-json-schema-generator":"^0.12.0","ts-node":"^3.2.1",tsify:"^3.0.1",tslint:"5.4.3","tslint-eslint-rules":"^4.1.1",typescript:"^2.4.2","uglify-js":"^3.0.27",vega:"^3.0.0","vega-datasets":"vega/vega-datasets#gh-pages","vega-embed":"^3.0.0-beta.20","vega-tooltip":"^0.4.2",watchify:"^3.9.0","wdio-chromedriver-service":"^0.1.0","wdio-dot-reporter":"0.0.9","wdio-mocha-framework":"^0.5.10","wdio-static-server-service":"^1.0.1",webdriverio:"^4.8.0","yaml-front-matter":"^3.4.0"},dependencies:{"json-stable-stringify":"^1.0.1",tslib:"^1.7.1","vega-event-selector":"^2.0.0","vega-util":"^1.5.0",yargs:"^8.0.2"}}},{}],9:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./util"),W={values:1,count:1,valid:1,missing:1,distinct:1,sum:1,mean:1,average:1,variance:1,variancep:1,stdev:1,stdevp:1,median:1,q1:1,q3:1,ci0:1,ci1:1,min:1,max:1,argmin:1,argmax:1};B.AGGREGATE_OPS=V.flagKeys(W),B.isAggregateOp=function(q){return!!W[q]},B.COUNTING_OPS=["count","valid","missing","distinct"],B.isCountingAggregateOp=function(q){return q&&V.contains(B.COUNTING_OPS,q)},B.SUM_OPS=["count","sum","distinct","valid","missing"],B.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],B.SHARED_DOMAIN_OP_INDEX=V.toSet(B.SHARED_DOMAIN_OPS)},{"./util":114}],10:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.AXIS_PROPERTY_TYPE={grid:"grid",labelOverlap:"main",offset:"main",title:"main"},B.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","labelOverlap","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"],B.VG_AXIS_PROPERTIES=[].concat(B.AXIS_PROPERTIES,["gridScale"])},{}],11:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./channel"),W=z("./util");B.binToString=function(q){return W.isBoolean(q)?"bin":"bin"+W.keys(q).map(function(Y){return"_"+Y+"_"+q[Y]}).join("")},B.autoMaxBins=function(q){return q===V.ROW||q===V.COLUMN||q===V.SIZE||q===V.COLOR||q===V.OPACITY||q===V.SHAPE?6:10}},{"./channel":12,"./util":114}],12:[function(z,H,B){"use strict";function V(te){return te===B.X||te===B.Y||te===B.COLOR||te===B.DETAIL||te===B.TOOLTIP||te===B.ORDER||te===B.OPACITY||te===B.ROW||te===B.COLUMN?{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0}:te===B.X2||te===B.Y2?{rule:!0,bar:!0,rect:!0,area:!0}:te===B.SIZE?{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0}:te===B.SHAPE?{point:!0}:te===B.TEXT?{text:!0}:void 0}Object.defineProperty(B,"__esModule",{value:!0});var W,q=z("tslib"),Y=z("./util");!function(te){te.ROW="row",te.COLUMN="column",te.X="x",te.Y="y",te.X2="x2",te.Y2="y2",te.COLOR="color",te.SHAPE="shape",te.SIZE="size",te.OPACITY="opacity",te.TEXT="text",te.ORDER="order",te.DETAIL="detail",te.TOOLTIP="tooltip"}(W=B.Channel||(B.Channel={})),B.X=W.X,B.Y=W.Y,B.X2=W.X2,B.Y2=W.Y2,B.ROW=W.ROW,B.COLUMN=W.COLUMN,B.SHAPE=W.SHAPE,B.SIZE=W.SIZE,B.COLOR=W.COLOR,B.TEXT=W.TEXT,B.DETAIL=W.DETAIL,B.ORDER=W.ORDER,B.OPACITY=W.OPACITY,B.TOOLTIP=W.TOOLTIP;var G={x:1,y:1,x2:1,y2:1,size:1,shape:1,color:1,order:1,opacity:1,text:1,detail:1,tooltip:1},K=q.__assign({},G,{row:1,column:1});B.CHANNELS=Y.flagKeys(K),K.order,K.detail;var Q=q.__rest(K,["order","detail"]);B.SINGLE_DEF_CHANNELS=Y.flagKeys(Q),B.isChannel=function(te){return!!K[te]},B.UNIT_CHANNELS=Y.flagKeys(G);var Z=q.__rest(G,["x","y","x2","y2"]);B.NONSPATIAL_CHANNELS=Y.flagKeys(Z);var J={x:1,y:1};B.SPATIAL_SCALE_CHANNELS=Y.flagKeys(J),Z.text,Z.tooltip,Z.detail,Z.order;var $=q.__rest(Z,["text","tooltip","detail","order"]);B.NONSPATIAL_SCALE_CHANNELS=Y.flagKeys($);var ee=q.__assign({},J,$);B.SCALE_CHANNELS=Y.flagKeys(ee),B.isScaleChannel=function(te){return!!ee[te]},B.supportMark=function(te,ae){return ae in V(te)},B.getSupportedMark=V,B.rangeType=function(te){switch(te){case B.X:case B.Y:case B.SIZE:case B.OPACITY:case B.X2:case B.Y2:return"continuous";case B.ROW:case B.COLUMN:case B.SHAPE:case B.TEXT:case B.TOOLTIP:return"discrete";case B.COLOR:return"flexible";case B.DETAIL:case B.ORDER:return;}throw new Error("getSupportedRole not implemented for "+te)}},{"./util":114,tslib:5}],13:[function(z,H,B){"use strict";function V(Y){return function(G,X){return X[Y]&&G.push(X[Y].combine()),G}}Object.defineProperty(B,"__esModule",{value:!0});var W=V("main"),q=V("grid");B.assembleAxes=function(Y){return[].concat(Y.x?[].concat(Y.x.reduce(W,[]),Y.x.reduce(q,[])):[],Y.y?[].concat(Y.y.reduce(W,[]),Y.y.reduce(q,[])):[])}},{}],14:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=function(q){function Y(){return null!==q&&q.apply(this,arguments)||this}return V.__extends(Y,q),Y}(z("../split").Split);B.AxisComponentPart=W},{"../split":86,tslib:5}],15:[function(z,H,B){"use strict";function V(J,$,ee){return void 0===J.labelAngle?$===Y.X&&(Q.contains([K.NOMINAL,K.ORDINAL],ee.type)||ee.bin||G.isTimeFieldDef(ee))?270:void 0:(J.labelAngle%360+360)%360}function W(J,$){if(J&&0<J){if(180<J)return"top"===$?"left":"right";if(180>J)return"top"===$?"right":"left"}}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../../channel"),G=z("../../fielddef"),X=z("../../scale"),K=z("../../type"),Q=z("../../util"),Z=z("../common");B.labels=function(J,$,ee,te){var ae=J.fieldDef($)||("x"===$?J.fieldDef("x2"):"y"===$?J.fieldDef("y2"):void 0),ne=J.axis($),ie=J.config,oe={};if(G.isTimeFieldDef(ae)){var le=J.getScaleComponent($).get("type")===X.ScaleType.UTC;oe.text={signal:Z.timeFormatExpression("datum.value",ae.timeUnit,ne.format,ie.axis.shortTimeLabels,ie.timeFormat,le)}}var se=V(ne,$,ae);if(se&&(oe.angle={value:se}),oe.angle&&"x"===$){var re=W(se,te.get("orient"));re&&(oe.align={value:re}),Q.contains([90,270],se)&&(oe.baseline={value:"middle"})}return oe=q.__assign({},oe,ee),0===Q.keys(oe).length?void 0:oe},B.labelAngle=V,B.labelAlign=W},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../type":113,"../../util":114,"../common":20,tslib:5}],16:[function(z,H,B){"use strict";function V(ce,pe){if(!ce)return pe.map(function(be){return J.__assign({},be.main?{main:be.main.clone()}:{},be.grid?{grid:be.grid.clone()}:{})});if(ce.length===pe.length){for(var ue=ce.length,me=0;me<ue;me++){var ge=ce[me].main,fe=pe[me].main;if(!!ge!=!!fe)return;if(ge&&fe){var he=ge.getWithExplicit("orient"),ye=fe.getWithExplicit("orient");if(he.explicit&&ye.explicit&&he.value!==ye.value)return;ce[me].main=W(ge,fe)}var _e=ce[me].grid,Se=pe[me].grid;if(!!_e!=!!Se)return;_e&&Se&&(ce[me].grid=W(_e,Se))}return ce}}function W(ce,pe){for(var ue=0,me=$.VG_AXIS_PROPERTIES;ue<me.length;ue++)!function(ge){var fe=ie.mergeValuesWithExplicit(ce.getWithExplicit(ge),pe.getWithExplicit(ge),ge,"axis",function(he,ye){return"title"===ge?ae.titleMerger(he,ye):"gridScale"===ge?{explicit:he.explicit,value:he.value||ye.value}:ie.defaultTieBreaker(he,ye,ge,"axis")});ce.setWithExplicit(ge,fe)}(me[ue]);return ce}function q(ce){return!1===ce||null===ce}function Y(ce){return te.some(re,function(pe){return G(ce,pe)})}function G(ce,pe){return"axis"===pe||("grid"===pe||"title"===pe?!!ce.get(pe):!q(ce.get(pe)))}function X(ce,pe){return Q(ce,pe,!0)}function K(ce,pe){return Q(ce,pe,!1)}function Q(ce,pe,ue){var me=pe.axis(ce),ge=new oe.AxisComponentPart({},{scale:pe.scaleName(ce)});$.AXIS_PROPERTIES.forEach(function(_e){var Se=Z(_e,me,ce,pe,ue);if(void 0!==Se){var be="values"===_e?!!me.values:Se===me[_e];ge.set(_e,Se,be)}});var fe=se.gridScale(pe,ce,ue);void 0!==fe&&ge.set("gridScale",fe,!1);var he=me.encoding||{},ye=re.reduce(function(_e,Se){if(!G(ge,Se))return _e;var be="labels"===Se?le.labels(pe,ce,he.labels||{},ge):he[Se]||{};return void 0!==be&&0<te.keys(be).length&&(_e[Se]={update:be}),_e},{});return 0<te.keys(ye).length&&ge.set("encode",ye,!!me.encoding||!!me.labelAngle),ge}function Z(ce,pe,ue,me,ge){var fe=me.fieldDef(ue);if((!ge||"main"!==$.AXIS_PROPERTY_TYPE[ce])&&(ge||"grid"!==$.AXIS_PROPERTY_TYPE[ce])){switch(ce){case"domain":return se.domain(ce,pe,ge,ue);case"format":return ae.numberFormat(fe,pe.format,me.config);case"grid":return he=me.getScaleComponent(ue).get("type"),ae.getSpecifiedOrDefaultValue(pe.grid,se.grid(he,fe));case"labels":return!ge&&pe.labels;case"labelOverlap":return he=me.getScaleComponent(ue).get("type"),se.labelOverlap(fe,pe,ue,he);case"minExtent":return se.minMaxExtent(pe.minExtent,ge);case"maxExtent":return se.minMaxExtent(pe.maxExtent,ge);case"orient":return ae.getSpecifiedOrDefaultValue(pe.orient,se.orient(ue));case"tickCount":var he=me.getScaleComponent(ue).get("type"),ye="x"===ue?"width":"y"===ue?"height":void 0,_e=ye?me.getSizeSignalRef(ye):void 0;return ae.getSpecifiedOrDefaultValue(pe.tickCount,se.tickCount(ue,fe,he,_e));case"ticks":return se.ticks(ce,pe,ge,ue);case"title":return ae.getSpecifiedOrDefaultValue(pe.title,se.title(pe.titleMaxLength,fe,me.config));case"values":return se.values(pe,me,fe);case"zindex":return ae.getSpecifiedOrDefaultValue(pe.zindex,se.zindex(ge));}return pe[ce]}}Object.defineProperty(B,"__esModule",{value:!0});var J=z("tslib"),$=z("../../axis"),ee=z("../../channel"),te=z("../../util"),ae=z("../common"),ne=z("../resolve"),ie=z("../split"),oe=z("./component"),le=z("./encode"),se=z("./properties"),re=["domain","grid","labels","ticks","title"];B.parseUnitAxis=function(ce){return ee.SPATIAL_SCALE_CHANNELS.reduce(function(pe,ue){if(ce.axis(ue)){var me={},ge=K(ue,ce);ge&&Y(ge)&&(me.main=ge);var fe=X(ue,ce);fe&&Y(fe)&&(me.grid=fe),pe[ue]=[me]}return pe},{})};var de={bottom:"top",top:"bottom",left:"right",right:"left"};B.parseLayerAxis=function(ce){for(var pe=ce.component,ue=pe.axes,me=pe.resolve,ge={top:0,bottom:0,right:0,left:0},fe=0,he=ce.children;fe<he.length;fe++)!function(ye){ye.parseAxisAndHeader(),te.keys(ye.component.axes).forEach(function(_e){me.axis[_e]=ne.parseGuideResolve(ce.component.resolve,_e),"shared"===me.axis[_e]&&(ue[_e]=V(ue[_e],ye.component.axes[_e]),ue[_e]||(me.axis[_e]="independent",delete ue[_e]))})}(he[fe]);["x","y"].forEach(function(ye){for(var be,_e=0,Se=ce.children;_e<Se.length;_e++)be=Se[_e],be.component.axes[ye]&&("independent"===me.axis[ye]&&(ue[ye]=(ue[ye]||[]).concat(be.component.axes[ye]),be.component.axes[ye].forEach(function(ve){var xe=ve.main.getWithExplicit("orient"),Ee=xe.value,Ne=xe.explicit;if(0<ge[Ee]&&!Ne){var Te=de[Ee];ge[Ee]>ge[Te]&&ve.main.set("orient",Te,!1)}ge[Ee]++})),delete be.component.axes[ye])})},B.parseGridAxis=X,B.parseMainAxis=K},{"../../axis":10,"../../channel":12,"../../util":114,"../common":20,"../resolve":66,"../split":86,"./component":14,"./encode":15,"./properties":17,tslib:5}],17:[function(z,H,B){"use strict";function V(Q,Z,J){return!J&&Z[Q]}Object.defineProperty(B,"__esModule",{value:!0});var W=z("../../channel"),q=z("../../datetime"),Y=z("../../fielddef"),G=z("../../log"),X=z("../../scale"),K=z("../../util");B.domainAndTicks=V,B.domain=V,B.ticks=V,B.grid=function(Q,Z){return!X.hasDiscreteDomain(Q)&&!Z.bin},B.gridScale=function(Q,Z,J){if(J){var $="x"===Z?"y":"x";if(Q.getScaleComponent($))return Q.scaleName($)}},B.labelOverlap=function(Q,Z,J,$){if("nominal"!==Q.type)return"log"!==$||"greedy"},B.minMaxExtent=function(Q,Z){return Z?0:Q},B.orient=function(Q){switch(Q){case W.X:return"bottom";case W.Y:return"left";}throw new Error(G.message.INVALID_CHANNEL_FOR_AXIS)},B.tickCount=function(Q,Z,J,$){if(!X.hasDiscreteDomain(J)&&"log"!==J&&!K.contains(["month","hours","day","quarter"],Z.timeUnit))return Z.bin?{signal:"min(ceil("+$.signal+"/40), "+Z.bin.maxbins+")"}:{signal:"ceil("+$.signal+"/40)"}},B.title=function(Q,Z,J){var $=Y.title(Z,J);return Q?K.truncate($,Q):$},B.values=function(Q){var $=Q.values;return Q.values&&q.isDateTime($[0])?$.map(function(ee){return{signal:q.dateTimeExpr(ee,!0)}}):$},B.zindex=function(Q){return Q?0:1}},{"../../channel":12,"../../datetime":93,"../../fielddef":96,"../../log":101,"../../scale":104,"../../util":114}],18:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../util"),q=z("./data/parse"),Y=z("./layoutsize/assemble"),G=function(X){function K(Q,Z,J,$,ee){return X.call(this,Q,Z,J,$,ee)||this}return V.__extends(K,X),K.prototype.parseData=function(){this.component.data=q.parseData(this),this.children.forEach(function(Q){Q.parseData()})},K.prototype.parseSelection=function(){var Q=this;this.component.selection={};for(var Z=0,J=this.children;Z<J.length;Z++)!function($){$.parseSelection(),W.keys($.component.selection).forEach(function(ee){Q.component.selection[ee]=$.component.selection[ee]})}(J[Z])},K.prototype.parseMarkGroup=function(){for(var Q=0,Z=this.children;Q<Z.length;Q++)Z[Q].parseMarkGroup()},K.prototype.parseAxisAndHeader=function(){for(var Q=0,Z=this.children;Q<Z.length;Q++)Z[Q].parseAxisAndHeader()},K.prototype.assembleSelectionTopLevelSignals=function(Q){return this.children.reduce(function(Z,J){return J.assembleSelectionTopLevelSignals(Z)},Q)},K.prototype.assembleSelectionSignals=function(){return this.children.forEach(function(Q){return Q.assembleSelectionSignals()}),[]},K.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(Q,Z){return Q.concat(Z.assembleLayoutSignals())},Y.assembleLayoutSignals(this))},K.prototype.assembleSelectionData=function(){return this.children.reduce(function(Z,J){return J.assembleSelectionData(Z)},[])},K.prototype.assembleMarks=function(){return this.children.map(function(Q){var Z=Q.assembleTitle(),J=Q.assembleGroupStyle(),$=Q.assembleLayoutSize();return V.__assign({type:"group",name:Q.getName("group")},Z?{title:Z}:{},J?{style:J}:{},$?{encode:{update:$}}:{},Q.assembleGroup())})},K}(z("./model").Model);B.BaseConcatModel=G},{"../util":114,"./data/parse":37,"./layoutsize/assemble":44,"./model":63,tslib:5}],19:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../log"),W=z("../spec"),q=z("./concat"),Y=z("./facet"),G=z("./layer"),X=z("./repeat"),K=z("./unit");B.buildModel=function(Q,Z,J,$,ee,te){if(W.isFacetSpec(Q))return new Y.FacetModel(Q,Z,J,ee,te);if(W.isLayerSpec(Q))return new G.LayerModel(Q,Z,J,$,ee,te);if(W.isUnitSpec(Q))return new K.UnitModel(Q,Z,J,$,ee,te);if(W.isRepeatSpec(Q))return new X.RepeatModel(Q,Z,J,ee,te);if(W.isConcatSpec(Q))return new q.ConcatModel(Q,Z,J,ee,te);throw new Error(V.message.INVALID_SPEC)}},{"../log":101,"../spec":107,"./concat":22,"./facet":41,"./layer":42,"./repeat":64,"./unit":87}],20:[function(z,H,B){"use strict";function V(ae){return ae.style?te.isArray(ae.style)?ae.style:[ae.style]:[ae.type]}function W(ae,ne,ie){var oe=ie.mark[ae],le=ie[ne.type];void 0!==le[ae]&&(oe=le[ae]);for(var se=0,re=V(ne);se<re.length;se++){var de=re[se],ce=ie.style[de],pe=ae;ce&&void 0!==ce[pe]&&(oe=ce[pe])}return oe}function q(ae,ne,ie){if(ae.type===ee.QUANTITATIVE)return ne||ie.numberFormat}function Y(ae,ne){return"format("+ae+", \""+(ne||"")+"\")"}function G(ae,ne,ie){return Y(ae,ne||ie.numberFormat)}function X(ae,ne,ie,oe){return ae+" === null || isNaN("+ae+") ? \"null\" : "+G(ae,ie,oe)+" + \" - \" + "+G(ne,ie,oe)}function K(ae,ne,ie,oe,le,se){if(!ne||ie){var re=ie||le;return se?"utcFormat("+ae+", '"+re+"')":"timeFormat("+ae+", '"+re+"')"}return $.formatExpression(ne,ae,oe,se)}Object.defineProperty(B,"__esModule",{value:!0});var Q=z("../channel"),Z=z("../fielddef"),J=z("../scale"),$=z("../timeunit"),ee=z("../type"),te=z("../util");B.applyConfig=function(ae,ne,ie){for(var oe=0,le=ie;oe<le.length;oe++){var se=le[oe],re=ne[se];void 0!==re&&(ae[se]={value:re})}return ae},B.applyMarkConfig=function(ae,ne,ie){for(var oe=0,le=ie;oe<le.length;oe++){var se=le[oe],re=W(se,ne.markDef,ne.config);void 0!==re&&(ae[se]={value:re})}return ae},B.getStyles=V,B.getMarkConfig=W,B.formatSignalRef=function(ae,ne,ie,oe){var le=q(ae,ne,oe);if(ae.bin)return{signal:X(Z.field(ae,{expr:ie}),Z.field(ae,{expr:ie,binSuffix:"end"}),le,oe)};if("quantitative"===ae.type)return{signal:""+Y(Z.field(ae,{expr:ie}),le)};if(Z.isTimeFieldDef(ae)){var se=Z.isScaleFieldDef(ae)&&ae.scale&&ae.scale.type===J.ScaleType.UTC;return{signal:K(Z.field(ae,{expr:ie}),ae.timeUnit,ne,oe.text.shortTimeLabels,oe.timeFormat,se)}}return{signal:"''+"+Z.field(ae,{expr:ie})}},B.getSpecifiedOrDefaultValue=function(ae,ne){return void 0===ae?ne:ae},B.numberFormat=q,B.numberFormatExpr=G,B.binFormatExpression=X,B.timeFormatExpression=K,B.sortParams=function(ae,ne){return(te.isArray(ae)?ae:[ae]).reduce(function(ie,oe){return ie.field.push(Z.field(oe,ne)),ie.order.push(oe.sort||"ascending"),ie},{field:[],order:[]})},B.titleMerger=function(ae,ne){return{explicit:ae.explicit,value:ae.value===ne.value?ae.value:ae.value+", "+ne.value}},B.binRequiresRange=function(ae,ne){return ae.bin?Q.isScaleChannel(ne)&&te.contains(["ordinal","nominal"],ae.type):(console.warn("Only use this method with binned field defs"),!1)}},{"../channel":12,"../fielddef":96,"../scale":104,"../timeunit":109,"../type":113,"../util":114}],21:[function(z,H,B){"use strict";function V($,ee){return q.__assign({},K.extractTopLevelProperties(ee),K.extractTopLevelProperties($))}function W($,ee){var te=$.config?Y.stripAndRedirectConfig($.config):void 0,ae=(ee.autoResize,q.__rest(ee,["autoResize"])),ne=$.assembleTitle(),ie=$.assembleGroupStyle();return{spec:q.__assign({$schema:"https://vega.github.io/schema/vega/v3.0.json"},$.description?{description:$.description}:{},{autosize:ee.autoResize?{type:"pad",resize:!0}:"pad"},ae,ne?{title:ne}:{},ie?{style:ie}:{},{data:[].concat($.assembleSelectionData([]),Z.assembleRootData($.component.data))},$.assembleGroup($.assembleLayoutSignals().concat($.assembleSelectionTopLevelSignals([]))),te?{config:te}:{})}}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../config"),G=z("../log"),X=z("../spec"),K=z("../toplevelprops"),Q=z("./buildmodel"),Z=z("./data/assemble"),J=z("./data/optimize");B.compile=function($,ee){ee&&G.set(ee);try{var te=Y.initConfig($.config),ae=X.normalize($,te),ne=Q.buildModel(ae,null,"",void 0,void 0,te);return ne.parse(),J.optimizeDataflow(ne.component.data),W(ne,V($,te))}finally{ee&&G.reset()}}},{"../config":91,"../log":101,"../spec":107,"../toplevelprops":111,"./buildmodel":19,"./data/assemble":24,"./data/optimize":35,tslib:5}],22:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../spec"),q=z("./baseconcat"),Y=z("./buildmodel"),G=z("./layoutsize/parse"),X=function(K){function Q(Z,J,$,ee,te){var ae=K.call(this,Z,J,$,te,Z.resolve)||this;return ae.type="concat",ae.isVConcat=W.isVConcatSpec(Z),ae.children=(W.isVConcatSpec(Z)?Z.vconcat:Z.hconcat).map(function(ne,ie){return Y.buildModel(ne,ae,ae.getName("concat_"+ie),void 0,ee,te)}),ae}return V.__extends(Q,K),Q.prototype.parseLayoutSize=function(){G.parseConcatLayoutSize(this)},Q.prototype.parseAxisGroup=function(){return null},Q.prototype.assembleLayout=function(){return V.__assign({padding:{row:10,column:10},offset:10},this.isVConcat?{columns:1}:{},{bounds:"full",align:"each"})},Q}(q.BaseConcatModel);B.ConcatModel=X},{"../spec":107,"./baseconcat":18,"./buildmodel":19,"./layoutsize/parse":45,tslib:5}],23:[function(z,H,B){"use strict";function V(J,$,ee){return ee.bin?(J[G.field(ee,{})]=!0,J[G.field(ee,{binSuffix:"end"})]=!0,Q.binRequiresRange(ee,$)&&(J[G.field(ee,{binSuffix:"range"})]=!0)):J[G.field(ee)]=!0,J}function W(J,$){for(var ee in $)if($.hasOwnProperty(ee)){var te=$[ee];for(var ae in te)te.hasOwnProperty(ae)&&(ee in J?J[ee][ae]=te[ae]:J[ee]={op:te[ae]})}}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../../channel"),G=z("../../fielddef"),X=z("../../log"),K=z("../../util"),Q=z("../common"),Z=function(J){function $(ee,te){var ae=J.call(this)||this;return ae.dimensions=ee,ae.measures=te,ae}return q.__extends($,J),$.prototype.clone=function(){return new $(q.__assign({},this.dimensions),K.duplicate(this.measures))},$.makeFromEncoding=function(ee){var te=!1;ee.forEachFieldDef(function(ie){ie.aggregate&&(te=!0)});var ae={},ne={};return te?(ee.forEachFieldDef(function(ie,oe){ie.aggregate?"count"===ie.aggregate?(ae["*"]=ae["*"]||{},ae["*"].count=G.field(ie,{aggregate:"count"})):(ae[ie.field]=ae[ie.field]||{},ae[ie.field][ie.aggregate]=G.field(ie),Y.isScaleChannel(oe)&&"unaggregated"===ee.scaleDomain(oe)&&(ae[ie.field].min=G.field(ie,{aggregate:"min"}),ae[ie.field].max=G.field(ie,{aggregate:"max"}))):V(ne,oe,ie)}),0===K.keys(ne).length+K.keys(ae).length?null:new $(ne,ae)):null},$.makeFromTransform=function(ee){for(var te={},ae={},ne=0,ie=ee.summarize;ne<ie.length;ne++)(se=ie[ne]).aggregate&&("count"===se.aggregate?(ae["*"]=ae["*"]||{},ae["*"].count=se.as||G.field(se)):(ae[se.field]=ae[se.field]||{},ae[se.field][se.aggregate]=se.as||G.field(se)));for(var se,oe=0,le=ee.groupby;oe<le.length;oe++)se=le[oe],te[se]=!0;return 0===K.keys(te).length+K.keys(ae).length?null:new $(te,ae)},$.prototype.merge=function(ee){K.differ(this.dimensions,ee.dimensions)?X.debug("different dimensions, cannot merge"):(W(this.measures,ee.measures),ee.remove())},$.prototype.addDimensions=function(ee){var te=this;ee.forEach(function(ae){return te.dimensions[ae]=!0})},$.prototype.dependentFields=function(){var ee={};return K.keys(this.dimensions).forEach(function(te){return ee[te]=!0}),K.keys(this.measures).forEach(function(te){return ee[te]=!0}),ee},$.prototype.producedFields=function(){var ee=this,te={};return K.keys(this.measures).forEach(function(ae){K.keys(ee.measures[ae]).forEach(function(ne){te[ne+"_"+ae]=!0})}),te},$.prototype.assemble=function(){var ee=this,te=[],ae=[],ne=[];return K.keys(this.measures).forEach(function(ie){K.keys(ee.measures[ie]).forEach(function(oe){ne.push(ee.measures[ie][oe]),te.push(oe),ae.push(ie)})}),{type:"aggregate",groupby:K.keys(this.dimensions),ops:te,fields:ae,as:ne}},$}(z("./dataflow").DataFlowNode);B.AggregateNode=Z},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../util":114,"../common":20,"./dataflow":27,tslib:5}],24:[function(z,H,B){"use strict";function V(se){function re(ce,pe){if(ce instanceof ie.SourceNode&&(q.isUrlData(ce.data)||(se.push(pe),pe=ue={name:null,source:pe.name,transform:[]})),ce instanceof $.ParseNode&&(ce.parent instanceof ie.SourceNode&&!pe.source?pe.format=W.__assign({},pe.format||{},{parse:ce.assembleFormatParse()}):pe.transform=pe.transform.concat(ce.assembleTransforms())),ce instanceof Z.FacetNode)return pe.name||(pe.name="data_"+de++),!pe.source||0<pe.transform.length?(se.push(pe),ce.data=pe.name):ce.data=pe.source,void ce.assemble().forEach(function(ge){return se.push(ge)});if((ce instanceof J.FilterNode||ce instanceof ne.NullFilterNode||ce instanceof K.CalculateNode||ce instanceof G.AggregateNode||ce instanceof te.LookupNode||ce instanceof ee.IdentifierNode)&&pe.transform.push(ce.assemble()),(ce instanceof ae.NonPositiveFilterNode||ce instanceof X.BinNode||ce instanceof le.TimeUnitNode||ce instanceof oe.StackNode)&&(pe.transform=pe.transform.concat(ce.assemble())),ce instanceof G.AggregateNode&&(pe.name||(pe.name="data_"+de++)),ce instanceof Q.OutputNode)if(pe.source&&0===pe.transform.length)ce.setSource(pe.source);else if(ce.parent instanceof Q.OutputNode)ce.setSource(pe.name);else if(pe.name||(pe.name="data_"+de++),ce.setSource(pe.name),1===ce.numChildren()){se.push(pe);var ue={name:null,source:pe.name,transform:[]};pe=ue}switch(ce.numChildren()){case 0:ce instanceof Q.OutputNode&&(!pe.source||0<pe.transform.length)&&se.push(pe);break;case 1:re(ce.children[0],pe);break;default:pe.name||(pe.name="data_"+de++);var me=pe.name;!pe.source||0<pe.transform.length?se.push(pe):me=pe.source,ce.children.forEach(function(ge){re(ge,{name:null,source:me,transform:[]})});}}var de=0;return re}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("../../data"),Y=z("../../util"),G=z("./aggregate"),X=z("./bin"),K=z("./calculate"),Q=z("./dataflow"),Z=z("./facet"),J=z("./filter"),$=z("./formatparse"),ee=z("./indentifier"),te=z("./lookup"),ae=z("./nonpositivefilter"),ne=z("./nullfilter"),ie=z("./source"),oe=z("./stack"),le=z("./timeunit");B.assembleFacetData=function(se){var re=[],de=V(re);return se.children.forEach(function(ce){return de(ce,{source:se.name,name:null,transform:[]})}),re},B.assembleRootData=function(se){var re=Y.vals(se.sources),de=[],ce=V(de),pe=0;re.forEach(function(ye){ye.hasName()||(ye.dataName="source_"+pe++);var _e=ye.assemble();ce(ye,_e)}),de.forEach(function(ye){0===ye.transform.length&&delete ye.transform}),de.sort(function(ye,_e){return 0===(ye.transform||[]).length?-1:0===(_e.transform||[]).length?1:0});for(var ue=0,me=de;ue<me.length;ue++)for(var he,ge=0,fe=me[ue].transform||[];ge<fe.length;ge++)he=fe[ge],"lookup"===he.type&&(he.from=se.outputNodes[he.from].getSource());return de}},{"../../data":92,"../../util":114,"./aggregate":23,"./bin":25,"./calculate":26,"./dataflow":27,"./facet":28,"./filter":29,"./formatparse":30,"./indentifier":31,"./lookup":32,"./nonpositivefilter":33,"./nullfilter":34,"./source":38,"./stack":39,"./timeunit":40,tslib:5}],25:[function(z,H,B){"use strict";function V(te,ae,ne,ie){if(J.binRequiresRange(ae,ne)){var oe=$.isUnitModel(te)?te.axis(ne)||te.legend(ne)||{}:{},le=Q.field(ae,{expr:"datum"}),se=Q.field(ae,{expr:"datum",binSuffix:"end"});return{formulaAs:Q.field(ae,{binSuffix:"range"}),formula:J.binFormatExpression(le,se,oe.format,ie)}}return{}}function W(te,ae){return K.binToString(te)+"_"+ae}function q(te){return!!te.model}function Y(te,ae){if(q(te)){var ne=te.model;return{signal:ne.getName(ae+"_bins"),extentSignal:ne.getName(ae+"_extent")}}return te}function G(te,ae){var ne=Q.normalizeBin(te.bin,void 0)||{},ie=W(ne,te.field),oe=Y(ae,ie),le=oe.signal,se=oe.extentSignal;return{key:ie,binComponent:X.__assign({bin:ne,field:te.field,as:[Q.field(te,{}),Q.field(te,{binSuffix:"end"})]},le?{signal:le}:{},se?{extentSignal:se}:{})}}Object.defineProperty(B,"__esModule",{value:!0});var X=z("tslib"),K=z("../../bin"),Q=z("../../fielddef"),Z=z("../../util"),J=z("../common"),$=z("../model"),ee=function(te){function ae(ne){var ie=te.call(this)||this;return ie.bins=ne,ie}return X.__extends(ae,te),ae.prototype.clone=function(){return new ae(Z.duplicate(this.bins))},ae.makeBinFromEncoding=function(ne){var ie=ne.reduceFieldDef(function(oe,le,se){if(le.bin){var re=G(le,{model:ne}),de=re.key,ce=re.binComponent;oe[de]=X.__assign({},ce,oe[de],V(ne,le,se,ne.config))}return oe},{});return 0===Z.keys(ie).length?null:new ae(ie)},ae.makeFromTransform=function(ne,ie){var oe=G(ne,ie),le=oe.key,se=oe.binComponent;return new ae((re={},re[le]=se,re));var re},ae.prototype.merge=function(ne){this.bins=X.__assign({},this.bins,ne.bins),ne.remove()},ae.prototype.producedFields=function(){var ne={};return Z.vals(this.bins).forEach(function(ie){ie.as.forEach(function(oe){return ne[oe]=!0})}),ne},ae.prototype.dependentFields=function(){var ne={};return Z.vals(this.bins).forEach(function(ie){ne[ie.field]=!0}),ne},ae.prototype.assemble=function(){return Z.flatten(Z.vals(this.bins).map(function(ne){var ie=[],oe=X.__assign({type:"bin",field:ne.field,as:ne.as,signal:ne.signal},ne.bin);return!ne.bin.extent&&ne.extentSignal&&(ie.push({type:"extent",field:ne.field,signal:ne.extentSignal}),oe.extent={signal:ne.extentSignal}),ie.push(oe),ne.formula&&ie.push({type:"formula",expr:ne.formula,as:ne.formulaAs}),ie}))},ae}(z("./dataflow").DataFlowNode);B.BinNode=ee},{"../../bin":11,"../../fielddef":96,"../../util":114,"../common":20,"../model":63,"./dataflow":27,tslib:5}],26:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../util"),q=function(Y){function G(X){var K=Y.call(this)||this;return K.transform=X,K}return V.__extends(G,Y),G.prototype.clone=function(){return new G(W.duplicate(this.transform))},G.prototype.producedFields=function(){var X={};return X[this.transform.as]=!0,X},G.prototype.assemble=function(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}},G}(z("./dataflow").DataFlowNode);B.CalculateNode=q},{"../../util":114,"./dataflow":27,tslib:5}],27:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=function(){function Y(G){this.debugName=G,this._children=[],this._parent=null}return Y.prototype.clone=function(){throw new Error("Cannot clone node")},Y.prototype.producedFields=function(){return{}},Y.prototype.dependentFields=function(){return{}},Object.defineProperty(Y.prototype,"parent",{get:function(){return this._parent},set:function(X){this._parent=X,X.addChild(this)},enumerable:!0,configurable:!0}),Object.defineProperty(Y.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Y.prototype.numChildren=function(){return this._children.length},Y.prototype.addChild=function(G){this._children.push(G)},Y.prototype.removeChild=function(G){this._children.splice(this._children.indexOf(G),1)},Y.prototype.remove=function(){for(var G=0,X=this._children;G<X.length;G++)X[G].parent=this._parent;this._parent.removeChild(this)},Y.prototype.insertAsParentOf=function(G){var X=G.parent;X.removeChild(this),this.parent=X,G.parent=this},Y.prototype.swapWithParent=function(){for(var G=this._parent,X=G.parent,K=0,Q=this._children;K<Q.length;K++)Q[K].parent=G;this._children=[],G.removeChild(this),G.parent.removeChild(G),this.parent=X,G.parent=this},Y}();B.DataFlowNode=W;var q=function(Y){function G(X,K,Q){var Z=Y.call(this,X)||this;return Z.type=K,Z.refCounts=Q,Z._source=Z._name=X,!Z.refCounts||Z._name in Z.refCounts||(Z.refCounts[Z._name]=0),Z}return V.__extends(G,Y),G.prototype.clone=function(){var X=new this.constructor;return X.debugName="clone_"+this.debugName,X._source=this._source,X._name="clone_"+this._name,X.type=this.type,X.refCounts=this.refCounts,X.refCounts[X._name]=0,X},G.prototype.getSource=function(){return this.refCounts[this._name]++,this._source},G.prototype.isRequired=function(){return!!this.refCounts[this._name]},G.prototype.setSource=function(X){this._source=X},G}(W);B.OutputNode=q},{tslib:5}],28:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../channel"),q=z("../../log"),Y=z("../../scale"),G=z("../../vega.schema"),X=z("../scale/domain"),K=function(Q){function Z(J,$,ee){var te=Q.call(this)||this;return te.model=J,te.name=$,te.data=ee,J.facet.column&&(te.columnFields=[J.field(W.COLUMN)],te.columnName=J.getName("column_domain"),J.fieldDef(W.COLUMN).bin&&te.columnFields.push(J.field(W.COLUMN,{binSuffix:"end"}))),J.facet.row&&(te.rowFields=[J.field(W.ROW)],te.rowName=J.getName("row_domain"),J.fieldDef(W.ROW).bin&&te.rowFields.push(J.field(W.ROW,{binSuffix:"end"}))),te.childModel=J.child,te}return V.__extends(Z,Q),Object.defineProperty(Z.prototype,"fields",{get:function(){var $=[];return this.columnFields&&($=$.concat(this.columnFields)),this.rowFields&&($=$.concat(this.rowFields)),$},enumerable:!0,configurable:!0}),Z.prototype.getSource=function(){return this.name},Z.prototype.getChildIndependentFieldsWithStep=function(){for(var J={},$=0,ee=["x","y"];$<ee.length;$++){var te=ee[$],ae=this.childModel.component.scales[te];if(ae&&!ae.merged){var ne=ae.get("type"),ie=ae.get("range");if(Y.hasDiscreteDomain(ne)&&G.isVgRangeStep(ie)){var oe=X.assembleDomain(this.childModel,te),le=X.getFieldFromDomain(oe);le?J[te]=le:q.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return J},Z.prototype.assembleRowColumnData=function(J,$,ee){var te={},ae="row"===J?"y":"x";return ee[ae]&&(te=$?{fields:["distinct_"+ee[ae]],ops:["max"],as:["distinct_"+ee[ae]]}:{fields:[ee[ae]],ops:["distinct"]}),{name:"row"===J?this.rowName:this.columnName,source:$||this.data,transform:[V.__assign({type:"aggregate",groupby:"row"===J?this.rowFields:this.columnFields},te)]}},Z.prototype.assemble=function(){var J=[],$=null,ee=this.getChildIndependentFieldsWithStep();if(this.columnName&&this.rowName&&(ee.x||ee.y)){$="cross_"+this.columnName+"_"+this.rowName;var te=[].concat(ee.x?[ee.x]:[],ee.y?[ee.y]:[]),ae=te.map(function(){return"distinct"});J.push({name:$,source:this.data,transform:[{type:"aggregate",groupby:this.columnFields.concat(this.rowFields),fields:te,ops:ae}]})}return this.columnName&&J.push(this.assembleRowColumnData("column",$,ee)),this.rowName&&J.push(this.assembleRowColumnData("row",$,ee)),J},Z}(z("./dataflow").DataFlowNode);B.FacetNode=K},{"../../channel":12,"../../log":101,"../../scale":104,"../../vega.schema":116,"../scale/domain":69,"./dataflow":27,tslib:5}],29:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../filter"),q=z("../../util"),Y=function(G){function X(K,Q){var Z=G.call(this)||this;return Z.model=K,Z.filter=Q,Z.expr=W.expression(Z.model,Z.filter,Z),Z}return V.__extends(X,G),X.prototype.clone=function(){return new X(this.model,q.duplicate(this.filter))},X.prototype.assemble=function(){return{type:"filter",expr:this.expr}},X}(z("./dataflow").DataFlowNode);B.FilterNode=Y},{"../../filter":97,"../../util":114,"./dataflow":27,tslib:5}],30:[function(z,H,B){"use strict";function V(ee,te){var ae="datum["+Z.stringValue(ee)+"]";if("number"===te)return"toNumber("+ae+")";if("boolean"===te)return"toBoolean("+ae+")";if("string"===te)return"toString("+ae+")";if("date"===te)return"toDate("+ae+")";if(0===te.indexOf("date:"))return"timeParse("+ae+","+(ne=te.slice(5,te.length))+")";if(0===te.indexOf("utc:")){var ne=te.slice(4,te.length);return"utcParse("+ae+","+ne+")"}return X.warn(X.message.unrecognizedParse(te)),null}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("../../aggregate"),Y=z("../../fielddef"),G=z("../../filter"),X=z("../../log"),K=z("../../logical"),Q=z("../../transform"),Z=z("../../util"),J=z("../model"),$=function(ee){function te(ae){var ne=ee.call(this)||this;return ne._parse={},ne._parse=ae,ne}return W.__extends(te,ee),te.prototype.clone=function(){return new te(Z.duplicate(this.parse))},te.make=function(ae){var ne={},ie={};(ae.transforms||[]).forEach(function(re){Q.isCalculate(re)?ie[re.as]=!0:Q.isFilter(re)&&K.forEachLeave(re.filter,function(de){(G.isEqualFilter(de)||G.isRangeFilter(de)||G.isOneOfFilter(de))&&de.timeUnit&&(ne[de.field]="date")})},{}),(J.isUnitModel(ae)||J.isFacetModel(ae))&&ae.forEachFieldDef(function(re){if(Y.isTimeFieldDef(re))ne[re.field]="date";else if(Y.isNumberFieldDef(re)){if(ie[re.field]||q.isCountingAggregateOp(re.aggregate))return;ne[re.field]="number"}});var oe=ae.data;if(oe&&oe.format&&oe.format.parse){var le=oe.format.parse;Z.keys(le).forEach(function(re){ne[re]=le[re]})}var se=ae.component.data.ancestorParse;return Z.keys(se).forEach(function(re){ne[re]===se[re]?delete ne[re]:X.warn(X.message.differentParse(re,ne[re],se[re]))}),0===Z.keys(ne).length?null:new te(ne)},Object.defineProperty(te.prototype,"parse",{get:function(){return this._parse},enumerable:!0,configurable:!0}),te.prototype.merge=function(ae){this._parse=W.__assign({},this._parse,ae.parse),ae.remove()},te.prototype.assembleFormatParse=function(){return this._parse},te.prototype.producedFields=function(){return Z.toSet(Z.keys(this.parse))},te.prototype.dependentFields=function(){return Z.toSet(Z.keys(this.parse))},te.prototype.assembleTransforms=function(){var ae=this;return Z.keys(this._parse).map(function(ne){var ie=V(ne,ae._parse[ne]);return ie?{type:"formula",expr:ie,as:ne}:null}).filter(function(ne){return null!==ne})},te}(z("./dataflow").DataFlowNode);B.ParseNode=$},{"../../aggregate":9,"../../fielddef":96,"../../filter":97,"../../log":101,"../../logical":102,"../../transform":112,"../../util":114,"../model":63,"./dataflow":27,tslib:5}],31:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../selection"),q=function(Y){function G(){return Y.call(this)||this}return V.__extends(G,Y),G.prototype.clone=function(){return new G},G.prototype.producedFields=function(){return X={},X[W.SELECTION_ID]=!0,X;var X},G.prototype.assemble=function(){return{type:"identifier",as:W.SELECTION_ID}},G}(z("./dataflow").DataFlowNode);B.IdentifierNode=q},{"../../selection":105,"./dataflow":27,tslib:5}],32:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("vega-util"),q=z("../../log"),Y=z("./dataflow"),G=z("./source"),X=function(K){function Q(Z,J){var $=K.call(this)||this;return $.transform=Z,$.secondary=J,$}return V.__extends(Q,K),Q.make=function(Z,J,$){var ee=Z.component.data.sources,te=new G.SourceNode(J.from.data),ae=ee[te.hash()];ae||(ee[te.hash()]=te,ae=te);var ne=Z.getName("lookup_"+$),ie=new Y.OutputNode(ne,"lookup",Z.component.data.outputNodeRefCounts);return ie.parent=ae,Z.component.data.outputNodes[ne]=ie,new Q(J,ie.getSource())},Q.prototype.producedFields=function(){return W.toSet(this.transform.from.fields||(this.transform.as instanceof Array?this.transform.as:[this.transform.as]))},Q.prototype.assemble=function(){var Z;if(this.transform.from.fields)Z=V.__assign({values:this.transform.from.fields},this.transform.as?{as:this.transform.as instanceof Array?this.transform.as:[this.transform.as]}:{});else{var J=this.transform.as;W.isString(J)||(q.warn(q.message.NO_FIELDS_NEEDS_AS),J="_lookup"),Z={as:[J]}}return V.__assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},Z,this.transform.default?{default:this.transform.default}:{})},Q}(Y.DataFlowNode);B.LookupNode=X},{"../../log":101,"./dataflow":27,"./source":38,tslib:5,"vega-util":7}],33:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../channel"),q=z("../../scale"),Y=z("../../util"),G=function(X){function K(Q){var Z=X.call(this)||this;return Z._filter=Q,Z}return V.__extends(K,X),K.prototype.clone=function(){return new K(V.__assign({},this._filter))},K.make=function(Q){var Z=W.SCALE_CHANNELS.reduce(function(J,$){var ee=Q.getScaleComponent($);return ee&&Q.field($)?(J[Q.field($)]=ee.get("type")===q.ScaleType.LOG,J):J},{});return Y.keys(Z).length?new K(Z):null},Object.defineProperty(K.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),K.prototype.assemble=function(){var Q=this;return Y.keys(this._filter).filter(function(Z){return Q._filter[Z]}).map(function(Z){return{type:"filter",expr:"datum["+Y.stringValue(Z)+"] > 0"}})},K}(z("./dataflow").DataFlowNode);B.NonPositiveFilterNode=G},{"../../channel":12,"../../scale":104,"../../util":114,"./dataflow":27,tslib:5}],34:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../channel"),q=z("../../scale"),Y=z("../../type"),G=z("../../util"),X=function(K){function Q(Z){var J=K.call(this)||this;return J._filteredFields=Z,J}return V.__extends(Q,K),Q.prototype.clone=function(){return new Q(G.duplicate(this._filteredFields))},Q.make=function(Z){var J=Z.reduceFieldDef(function($,ee,te){if("filter"===Z.config.invalidValues&&!ee.aggregate&&ee.field){var ae=W.isScaleChannel(te)&&Z.getScaleComponent(te);if(ae){var ne=ae.get("type");q.hasContinuousDomain(ne)&&($[ee.field]=ee)}}return $},{});return 0===G.keys(J).length?null:new Q(J)},Object.defineProperty(Q.prototype,"filteredFields",{get:function(){return this._filteredFields},enumerable:!0,configurable:!0}),Q.prototype.merge=function(Z){var J=this,$=G.keys(this._filteredFields).map(function(te){return te+" "+G.hash(J._filteredFields[te])}),ee=G.keys(Z.filteredFields).map(function(te){return te+" "+G.hash(Z.filteredFields[te])});G.differArray($,ee)||(this._filteredFields=V.__assign({},this._filteredFields,Z._filteredFields),Z.remove())},Q.prototype.assemble=function(){var Z=this,J=G.keys(this._filteredFields).reduce(function($,ee){var te=Z._filteredFields[ee];return null!==te&&($.push("datum["+G.stringValue(te.field)+"] !== null"),G.contains([Y.QUANTITATIVE,Y.TEMPORAL],te.type)&&$.push("!isNaN(datum["+G.stringValue(te.field)+"])")),$},[]);return 0<J.length?{type:"filter",expr:J.join(" && ")}:null},Q}(z("./dataflow").DataFlowNode);B.NullFilterNode=X},{"../../channel":12,"../../scale":104,"../../type":113,"../../util":114,"./dataflow":27,tslib:5}],35:[function(z,H,B){"use strict";function V(ne){function ie(oe){if(!(oe instanceof J.FacetNode)){var le=oe.clone();if(le instanceof Z.OutputNode){var se=B.FACET_SCALE_PREFIX+le.getSource();le.setSource(se),ne.model.component.data.outputNodes[se]=le}else(le instanceof Q.AggregateNode||le instanceof ae.StackNode)&&le.addDimensions(ne.fields);return K.flatten(oe.children.map(ie)).forEach(function(re){return re.parent=le}),[le]}return K.flatten(oe.children.map(ie))}return ie}function W(ne){if(!(ne instanceof J.FacetNode))ne.children.forEach(W);else if(1!==ne.numChildren()||ne.children[0]instanceof Z.OutputNode)q(ne.model.component.data.main),K.flatten(ne.children.map(V(ne))).forEach(function(oe){return oe.parent=ne.model.component.data.main});else{var ie=ne.children[0];(ie instanceof Q.AggregateNode||ie instanceof ae.StackNode)&&ie.addDimensions(ne.fields),ie.swapWithParent(),W(ne)}}function q(ne){if(ne instanceof Z.OutputNode&&ne.type===X.MAIN&&1===ne.numChildren()){var ie=ne.children[0];ie instanceof J.FacetNode||(ie.swapWithParent(),q(ne))}}function Y(ne){ne instanceof $.NonPositiveFilterNode&&K.every(K.vals(ne.filter),function(ie){return!1===ie})&&ne.remove(),ne instanceof ee.NullFilterNode&&K.every(K.vals(ne.filteredFields),function(ie){return null===ie})&&ne.remove(),ne instanceof Z.OutputNode&&!ne.isRequired()&&ne.remove(),ne.children.forEach(Y)}function G(ne){function ie(le){0===le.numChildren()?oe.push(le):le.children.forEach(ie)}var oe=[];return ne.forEach(ie),oe}Object.defineProperty(B,"__esModule",{value:!0});var X=z("../../data"),K=z("../../util"),Q=z("./aggregate"),Z=z("./dataflow"),J=z("./facet"),$=z("./nonpositivefilter"),ee=z("./nullfilter"),te=z("./optimizers"),ae=z("./stack");B.FACET_SCALE_PREFIX="scale_",B.optimizeDataflow=function(ne){var ie=K.vals(ne.sources);ie.forEach(Y),G(ie=ie.filter(function(oe){return 0<oe.numChildren()})).forEach(te.iterateFromLeaves(te.removeUnusedSubtrees)),G(ie=ie.filter(function(oe){return 0<oe.numChildren()})).forEach(te.iterateFromLeaves(te.moveParseUp)),G(ie).forEach(te.removeDuplicateTimeUnits),ie.forEach(W),K.keys(ne.sources).forEach(function(oe){0===ne.sources[oe].numChildren()&&delete ne.sources[oe]})}},{"../../data":92,"../../util":114,"./aggregate":23,"./dataflow":27,"./facet":28,"./nonpositivefilter":33,"./nullfilter":34,"./optimizers":36,"./stack":39}],36:[function(z,H,B){"use strict";function V(Q){function Z(J){if(!(J instanceof X.SourceNode)){var $=J.parent;Q(J)&&Z($)}}return Z}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("../../util"),Y=z("./dataflow"),G=z("./formatparse"),X=z("./source"),K=z("./timeunit");B.iterateFromLeaves=V,B.moveParseUp=function(Q){var Z=Q.parent;if(Q instanceof G.ParseNode){if(Z instanceof X.SourceNode)return!1;if(1<Z.numChildren())return!0;if(Z instanceof G.ParseNode)Z.merge(Q);else{if(q.hasIntersection(Z.producedFields(),Q.dependentFields()))return!0;Q.swapWithParent()}}return!0},B.removeUnusedSubtrees=function(Q){return!(Q instanceof Y.OutputNode||0<Q.numChildren()||(Q.remove(),0))},B.removeDuplicateTimeUnits=function(Q){var Z={};return V(function(J){if(J instanceof K.TimeUnitNode){var $=J.producedFields();q.keys($).every(function(ee){return!!Z[ee]})?J.remove():Z=W.__assign({},Z,$)}return!0})(Q)}},{"../../util":114,"./dataflow":27,"./formatparse":30,"./source":38,"./timeunit":40,tslib:5}],37:[function(z,H,B){"use strict";function V(fe,he){if(fe.data||!fe.parent){var ye=new ue.SourceNode(fe.data),_e=ye.hash();return _e in he?he[_e]:(he[_e]=ye,ye)}return fe.parent.component.data.facetRoot?fe.parent.component.data.facetRoot:fe.parent.component.data.main}function W(fe){function he(ve){Se?ve.parent?_e.insertAsParentOf(ve):ve.parent=_e:Se=ve.parent||ve,_e=ve}var ye,_e,Se=null,be=0;return fe.transforms.forEach(function(ve){if(Z.isCalculate(ve))ye=new ne.CalculateNode(ve);else if(Z.isFilter(ve)){var xe={},Ee=ve.filter,Ne=null;K.isEqualFilter(Ee)?Ne=Ee.equal:K.isRangeFilter(Ee)?Ne=Ee.range[0]:K.isOneOfFilter(Ee)&&(Ne=(Ee.oneOf||Ee.in)[0]),Ne&&(X.isDateTime(Ne)?xe[Ee.field]="date":Y.isNumber(Ne)?xe[Ee.field]="number":Y.isString(Ne)&&(xe[Ee.field]="string")),0<J.keys(xe).length&&he(new se.ParseNode(xe)),ye=new le.FilterNode(fe,ve.filter)}else if(Z.isBin(ve))ye=ae.BinNode.makeFromTransform(ve,{model:fe});else if(Z.isTimeUnit(ve))ye=ge.TimeUnitNode.makeFromTransform(ve);else if(Z.isSummarize(ve))ye=te.AggregateNode.makeFromTransform(ve),ee.requiresSelectionId(fe)&&(he(ye),ye=new re.IdentifierNode);else{if(!Z.isLookup(ve))return void Q.warn(Q.message.invalidTransformIgnored(ve));ye=de.LookupNode.make(fe,ve,be++)}he(ye)}),{first:Se,last:ye}}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("vega-util"),G=z("../../data"),X=z("../../datetime"),K=z("../../filter"),Q=z("../../log"),Z=z("../../transform"),J=z("../../util"),$=z("../model"),ee=z("../selection/selection"),te=z("./aggregate"),ae=z("./bin"),ne=z("./calculate"),ie=z("./dataflow"),oe=z("./facet"),le=z("./filter"),se=z("./formatparse"),re=z("./indentifier"),de=z("./lookup"),ce=z("./nonpositivefilter"),pe=z("./nullfilter"),ue=z("./source"),me=z("./stack"),ge=z("./timeunit");B.parseTransformArray=W,B.parseData=function(fe){var he=V(fe,fe.component.data.sources),ye=fe.component.data.outputNodes,_e=fe.component.data.outputNodeRefCounts,Se=he;ee.requiresSelectionId(fe)&&!fe.parent&&((Pe=new re.IdentifierNode).parent=Se,Se=Pe);var be=fe.parent&&$.isLayerModel(fe.parent);if(($.isUnitModel(fe)||$.isFacetModel(fe))&&be&&(De=ae.BinNode.makeBinFromEncoding(fe))&&(De.parent=Se,Se=De),0<fe.transforms.length){var ve=W(fe),xe=ve.first,Ee=ve.last;xe.parent=Se,Se=Ee}var Ne=se.ParseNode.make(fe);if(Ne&&(Ne.parent=Se,Se=Ne),$.isUnitModel(fe)||$.isFacetModel(fe)){var Te=pe.NullFilterNode.make(fe);if(Te&&(Te.parent=Se,Se=Te),!be){var De=ae.BinNode.makeBinFromEncoding(fe);De&&(De.parent=Se,Se=De)}var ke=ge.TimeUnitNode.makeFromEncoding(fe);ke&&(ke.parent=Se,Se=ke)}var Oe=fe.getName(G.RAW),Ce=new ie.OutputNode(Oe,G.RAW,_e);if(ye[Oe]=Ce,Ce.parent=Se,Se=Ce,$.isUnitModel(fe)){var Ae=te.AggregateNode.makeFromEncoding(fe);if(Ae&&(Ae.parent=Se,Se=Ae,ee.requiresSelectionId(fe))){var Pe=new re.IdentifierNode;Pe.parent=Se,Se=Pe}var Re=me.StackNode.make(fe);Re&&(Re.parent=Se,Se=Re);var Me=ce.NonPositiveFilterNode.make(fe);Me&&(Me.parent=Se,Se=Me)}var Le=fe.getName(G.MAIN),we=new ie.OutputNode(Le,G.MAIN,_e);ye[Le]=we,we.parent=Se,Se=we;var Ie=null;if($.isFacetModel(fe)){var Fe=fe.getName("facet");Ie=new oe.FacetNode(fe,Fe,we.getSource()),ye[Fe]=Ie,Ie.parent=Se,Se=Ie}var Ue=q.__assign({},fe.component.data.ancestorParse,Ne?Ne.parse:{});return q.__assign({},fe.component.data,{outputNodes:ye,outputNodeRefCounts:_e,raw:Ce,main:we,facetRoot:Ie,ancestorParse:Ue})}},{"../../data":92,"../../datetime":93,"../../filter":97,"../../log":101,"../../transform":112,"../../util":114,"../model":63,"../selection/selection":76,"./aggregate":23,"./bin":25,"./calculate":26,"./dataflow":27,"./facet":28,"./filter":29,"./formatparse":30,"./indentifier":31,"./lookup":32,"./nonpositivefilter":33,"./nullfilter":34,"./source":38,"./stack":39,"./timeunit":40,tslib:5,"vega-util":7}],38:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../data"),q=z("../../util"),Y=0,G=function(X){function K(Q){var Z=X.call(this)||this;if(Z._id=Y++,Q=Q||{name:"source"},W.isInlineData(Q))Z._data={values:Q.values};else if(!W.isUrlData(Q))W.isNamedData(Q)&&(Z._name=Q.name,Z._data={});else if(Z._data={url:Q.url},Q.format||(Q.format={}),!Q.format||!Q.format.type){var J=/(?:\.([^.]+))?$/.exec(Q.url)[1];q.contains(["json","csv","tsv","topojson"],J)||(J="json"),Q.format.type=J}if(!W.isNamedData(Q)){var $=V.__assign({type:"json"},Q.format||{}),ee=($.parse,V.__rest($,["parse"]));Z._data.format=ee}return Z}return V.__extends(K,X),Object.defineProperty(K.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),K.prototype.hasName=function(){return!!this._name},Object.defineProperty(K.prototype,"dataName",{get:function(){return this._name},set:function(Z){this._name=Z},enumerable:!0,configurable:!0}),Object.defineProperty(K.prototype,"parent",{set:function(){throw new Error("Source nodes have to be roots.")},enumerable:!0,configurable:!0}),K.prototype.remove=function(){throw new Error("Source nodes are roots and cannot be removed.")},K.prototype.hash=function(){return W.isInlineData(this._data)?1e3<this._data.values.length?q.hash([this._data.format,this._id]):q.hash(this._data):W.isUrlData(this._data)?q.hash([this._data.url,this._data.format]):this._name},K.prototype.assemble=function(){return V.__assign({name:this._name},this._data,{transform:[]})},K}(z("./dataflow").DataFlowNode);B.SourceNode=G},{"../../data":92,"../../util":114,"./dataflow":27,tslib:5}],39:[function(z,H,B){"use strict";function V(Q){return Q.stack.stackBy.reduce(function(Z,J){var $=J.fieldDef,ee=Y.field($);return ee&&Z.push(ee),Z},[])}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("vega-util"),Y=z("../../fielddef"),G=z("../../util"),X=z("../common"),K=function(Q){function Z(J){var $=Q.call(this)||this;return $._stack=J,$}return W.__extends(Z,Q),Z.prototype.clone=function(){return new Z(G.duplicate(this._stack))},Z.make=function(J){var $=J.stack;if(!$)return null;var ee;$.groupbyChannel&&(ee=J.fieldDef($.groupbyChannel));var te,ae=V(J),ne=J.encoding.order;return te=ne?X.sortParams(ne):ae.reduce(function(ie,oe){return ie.field.push(oe),ie.order.push("descending"),ie},{field:[],order:[]}),new Z({dimensionFieldDef:ee,field:J.field($.fieldChannel),facetby:[],stackby:ae,sort:te,offset:$.offset,impute:$.impute})},Object.defineProperty(Z.prototype,"stack",{get:function(){return this._stack},enumerable:!0,configurable:!0}),Z.prototype.addDimensions=function(J){this._stack.facetby=this._stack.facetby.concat(J)},Z.prototype.dependentFields=function(){var J={};J[this._stack.field]=!0,this.getGroupbyFields().forEach(function(ee){return J[ee]=!0}),this._stack.facetby.forEach(function(ee){return J[ee]=!0});var $=this._stack.sort.field;return q.isArray($)?$.forEach(function(ee){return J[ee]=!0}):J[$]=!0,J},Z.prototype.producedFields=function(){var J={};return J[this._stack.field+"_start"]=!0,J[this._stack.field+"_end"]=!0,J},Z.prototype.getGroupbyFields=function(){var J=this._stack,$=J.dimensionFieldDef,ee=J.impute;return $?$.bin?ee?[Y.field($,{binSuffix:"mid"})]:[Y.field($,{}),Y.field($,{binSuffix:"end"})]:[Y.field($)]:[]},Z.prototype.assemble=function(){var J=[],$=this._stack,ee=$.facetby,te=$.field,ae=$.dimensionFieldDef,ne=$.impute,ie=$.offset,oe=$.sort,le=$.stackby;if(ne&&ae){var se=ae?Y.field(ae,{binSuffix:"mid"}):void 0;ae.bin&&J.push({type:"formula",expr:"("+Y.field(ae,{expr:"datum"})+"+"+Y.field(ae,{expr:"datum",binSuffix:"end"})+")/2",as:se}),J.push({type:"impute",field:te,groupby:le,key:se,method:"value",value:0})}return J.push({type:"stack",groupby:this.getGroupbyFields().concat(ee),field:te,sort:oe,as:[te+"_start",te+"_end"],offset:ie}),J},Z}(z("./dataflow").DataFlowNode);B.StackNode=K},{"../../fielddef":96,"../../util":114,"../common":20,"./dataflow":27,tslib:5,"vega-util":7}],40:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../fielddef"),q=z("../../timeunit"),Y=z("../../util"),G=function(X){function K(Q){var Z=X.call(this)||this;return Z.formula=Q,Z}return V.__extends(K,X),K.prototype.clone=function(){return new K(Y.duplicate(this.formula))},K.makeFromEncoding=function(Q){var Z=Q.reduceFieldDef(function(J,$){if($.timeUnit){var ee=W.field($);J[ee]={as:ee,timeUnit:$.timeUnit,field:$.field}}return J},{});return 0===Y.keys(Z).length?null:new K(Z)},K.makeFromTransform=function(Q){return new K((Z={},Z[Q.field]={as:Q.as,timeUnit:Q.timeUnit,field:Q.field},Z));var Z},K.prototype.merge=function(Q){this.formula=V.__assign({},this.formula,Q.formula),Q.remove()},K.prototype.producedFields=function(){var Q={};return Y.vals(this.formula).forEach(function(Z){Q[Z.as]=!0}),Q},K.prototype.dependentFields=function(){var Q={};return Y.vals(this.formula).forEach(function(Z){Q[Z.field]=!0}),Q},K.prototype.assemble=function(){return Y.vals(this.formula).map(function(Q){return{type:"formula",as:Q.as,expr:q.fieldExpr(Q.timeUnit,Q.field)}})},K}(z("./dataflow").DataFlowNode);B.TimeUnitNode=G},{"../../fielddef":96,"../../timeunit":109,"../../util":114,"./dataflow":27,tslib:5}],41:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../channel"),q=z("../encoding"),Y=z("../fielddef"),G=z("../log"),X=z("../scale"),K=z("../util"),Q=z("../vega.schema"),Z=z("./buildmodel"),J=z("./data/assemble"),$=z("./data/parse"),ee=z("./layout/header"),te=z("./layoutsize/parse"),ae=z("./model"),ne=z("./repeater"),ie=z("./resolve"),oe=z("./scale/domain"),le=function(se){function re(de,ce,pe,ue,me){var ge=se.call(this,de,ce,pe,me,de.resolve)||this;ge.type="facet",ge.child=Z.buildModel(de.spec,ge,ge.getName("child"),void 0,ue,me),ge.children=[ge.child];var fe=ne.replaceRepeaterInFacet(de.facet,ue);return ge.facet=ge.initFacet(fe),ge}return V.__extends(re,se),re.prototype.initFacet=function(de){return q.reduce(de,function(ce,pe,ue){return K.contains([W.ROW,W.COLUMN],ue)?void 0===pe.field?(G.warn(G.message.emptyFieldDef(pe,ue)),ce):(ce[ue]=Y.normalize(pe,ue),ce):(G.warn(G.message.incompatibleChannel(ue,"facet")),ce)},{})},re.prototype.channelHasField=function(de){return!!this.facet[de]},re.prototype.fieldDef=function(de){return this.facet[de]},re.prototype.parseData=function(){this.component.data=$.parseData(this),this.child.parseData()},re.prototype.parseLayoutSize=function(){te.parseChildrenLayoutSize(this)},re.prototype.parseSelection=function(){this.child.parseSelection(),this.component.selection=this.child.component.selection},re.prototype.parseMarkGroup=function(){this.child.parseMarkGroup()},re.prototype.parseAxisAndHeader=function(){this.child.parseAxisAndHeader(),this.parseHeader("column"),this.parseHeader("row"),this.mergeChildAxis("x"),this.mergeChildAxis("y")},re.prototype.parseHeader=function(de){if(this.channelHasField(de)){var ce=this.facet[de],pe=ce.header||{},ue=void 0===pe.title?Y.title(ce,this.config):pe.title;this.child.component.layoutHeaders[de].title&&(ue+=" / "+this.child.component.layoutHeaders[de].title,this.child.component.layoutHeaders[de].title=null),this.component.layoutHeaders[de]={title:ue,facetFieldDef:ce,header:[this.makeHeaderComponent(de,!0)]}}},re.prototype.makeHeaderComponent=function(de,ce){var pe="row"===de?"height":"width";return{labels:ce,sizeSignal:this.child.component.layoutSize.get(pe)?this.child.getSizeSignalRef(pe):void 0,axes:[]}},re.prototype.mergeChildAxis=function(de){var ce=this.child;if(ce.component.axes[de]){var pe=this.component,ue=pe.layoutHeaders,me=pe.resolve;if(me.axis[de]=ie.parseGuideResolve(me,de),"shared"===me.axis[de])for(var ge="x"===de?"column":"row",fe=ue[ge],he=0,ye=ce.component.axes[de];he<ye.length;he++){var _e=ye[he],Se=_e.main,be=ee.getHeaderType(Se.get("orient"));fe[be]=fe[be]||[this.makeHeaderComponent(ge,!1)],fe[be][0].axes.push(Se.combine()),delete _e.main}}},re.prototype.assembleSelectionTopLevelSignals=function(de){return this.child.assembleSelectionTopLevelSignals(de)},re.prototype.assembleSelectionSignals=function(){return this.child.assembleSelectionSignals(),[]},re.prototype.assembleSelectionData=function(de){return this.child.assembleSelectionData(de)},re.prototype.getLayoutBandMixins=function(de){for(var ce={},pe="header"===de?"headerBand":"footerBand",ue=0,me=["row","column"];ue<me.length;ue++){var ge=me[ue],fe=this.component.layoutHeaders[ge][de];if(fe&&fe[0]){var he="row"===ge?"height":"width";this.child.component.layoutSize.get(he)||(ce[pe]=ce[pe]||{},ce[pe][ge]=.5)}}return ce},re.prototype.assembleLayout=function(){var de=this.channelHasField("column")?this.columnDistinctSignal():1;return V.__assign({padding:{row:10,column:10}},this.getLayoutBandMixins("header"),this.getLayoutBandMixins("footer"),{offset:10,columns:de,bounds:"full",align:"all"})},re.prototype.assembleLayoutSignals=function(){return this.child.assembleLayoutSignals()},re.prototype.columnDistinctSignal=function(){return this.parent&&this.parent instanceof re?void 0:{signal:"length(data('"+this.getName("column_domain")+"'))"}},re.prototype.assembleGroup=function(de){return this.parent&&this.parent instanceof re?V.__assign({},this.channelHasField("column")?{encode:{update:{columns:{field:Y.field(this.facet.column,{prefix:"distinct"})}}}}:{},se.prototype.assembleGroup.call(this,de)):se.prototype.assembleGroup.call(this,de)},re.prototype.getCardinalityAggregateForChild=function(){var de=[],ce=[];if(this.child instanceof re)this.child.channelHasField("column")&&(de.push(Y.field(this.child.facet.column)),ce.push("distinct"));else for(var pe=0,ue=["x","y"];pe<ue.length;pe++){var me=ue[pe],ge=this.child.component.scales[me];if(ge&&!ge.merged){var fe=ge.get("type"),he=ge.get("range");if(X.hasDiscreteDomain(fe)&&Q.isVgRangeStep(he)){var ye=oe.assembleDomain(this.child,me),_e=oe.getFieldFromDomain(ye);_e?(de.push(_e),ce.push("distinct")):G.warn("Unknown field for ${channel}.  Cannot calculate view size.")}}}return de.length?{fields:de,ops:ce}:void 0},re.prototype.assembleMarks=function(){var de=this,ce=de.child,pe=de.facet,ue=this.component.data.facetRoot,me=J.assembleFacetData(ue),ge=this.channelHasField(W.ROW),fe=this.channelHasField(W.COLUMN),he=ce.assembleLayoutSize(),ye={};ge&&fe&&(ye.aggregate={cross:!0});var _e=this.getCardinalityAggregateForChild();_e&&(ye.aggregate=V.__assign({},ye.aggregate,_e));var Se=ce.assembleTitle(),be=ce.assembleGroupStyle();return[V.__assign({name:this.getName("cell"),type:"group"},Se?{title:Se}:{},be?{style:be}:{},{from:{facet:V.__assign({name:ue.name,data:ue.data,groupby:[].concat(ge?[this.field(W.ROW)]:[],fe?[this.field(W.COLUMN)]:[])},ye)},sort:{field:[].concat(ge?[this.field(W.ROW,{expr:"datum"})]:[],fe?[this.field(W.COLUMN,{expr:"datum"})]:[]),order:[].concat(ge?[pe.row.sort||"ascending"]:[],fe?[pe.column.sort||"ascending"]:[])}},0<me.length?{data:me}:{},he?{encode:{update:he}}:{},ce.assembleGroup())]},re.prototype.getMapping=function(){return this.facet},re}(ae.ModelWithField);B.FacetModel=le},{"../channel":12,"../encoding":94,"../fielddef":96,"../log":101,"../scale":104,"../util":114,"../vega.schema":116,"./buildmodel":19,"./data/assemble":24,"./data/parse":37,"./layout/header":43,"./layoutsize/parse":45,"./model":63,"./repeater":65,"./resolve":66,"./scale/domain":69,tslib:5}],42:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../log"),q=z("../spec"),Y=z("../util"),G=z("./axis/parse"),X=z("./data/parse"),K=z("./layoutsize/assemble"),Q=z("./layoutsize/parse"),Z=z("./legend/assemble"),J=z("./model"),$=z("./selection/selection"),ee=z("./unit"),te=function(ae){function ne(ie,oe,le,se,re,de){var ce=ae.call(this,ie,oe,le,de,ie.resolve)||this;ce.type="layer";var pe=V.__assign({},se,ie.width?{width:ie.width}:{},ie.height?{height:ie.height}:{});return ce.initSize(pe),ce.children=ie.layer.map(function(ue,me){if(q.isLayerSpec(ue))return new ne(ue,ce,ce.getName("layer_"+me),pe,re,de);if(q.isUnitSpec(ue))return new ee.UnitModel(ue,ce,ce.getName("layer_"+me),pe,re,de);throw new Error(W.message.INVALID_SPEC)}),ce}return V.__extends(ne,ae),ne.prototype.parseData=function(){this.component.data=X.parseData(this);for(var ie=0,oe=this.children;ie<oe.length;ie++)oe[ie].parseData()},ne.prototype.parseLayoutSize=function(){Q.parseLayerLayoutSize(this)},ne.prototype.parseSelection=function(){var ie=this;this.component.selection={};for(var oe=0,le=this.children;oe<le.length;oe++)!function(se){se.parseSelection(),Y.keys(se.component.selection).forEach(function(re){ie.component.selection[re]=se.component.selection[re]})}(le[oe])},ne.prototype.parseMarkGroup=function(){for(var ie=0,oe=this.children;ie<oe.length;ie++)oe[ie].parseMarkGroup()},ne.prototype.parseAxisAndHeader=function(){G.parseLayerAxis(this)},ne.prototype.assembleSelectionTopLevelSignals=function(ie){return this.children.reduce(function(oe,le){return le.assembleSelectionTopLevelSignals(oe)},ie)},ne.prototype.assembleSelectionSignals=function(){return this.children.reduce(function(ie,oe){return ie.concat(oe.assembleSelectionSignals())},[])},ne.prototype.assembleLayoutSignals=function(){return this.children.reduce(function(ie,oe){return ie.concat(oe.assembleLayoutSignals())},K.assembleLayoutSignals(this))},ne.prototype.assembleSelectionData=function(){return this.children.reduce(function(oe,le){return le.assembleSelectionData(oe)},[])},ne.prototype.assembleTitle=function(){var ie=ae.prototype.assembleTitle.call(this);if(ie)return ie;for(var oe=0,le=this.children;oe<le.length;oe++)if(ie=le[oe].assembleTitle())return ie},ne.prototype.assembleLayout=function(){return null},ne.prototype.assembleMarks=function(){return $.assembleLayerSelectionMarks(this,Y.flatten(this.children.map(function(ie){return ie.assembleMarks()})))},ne.prototype.assembleLegends=function(){return this.children.reduce(function(ie,oe){return ie.concat(oe.assembleLegends())},Z.assembleLegends(this))},ne}(J.Model);B.LayerModel=te},{"../log":101,"../spec":107,"../util":114,"./axis/parse":16,"./data/parse":37,"./layoutsize/assemble":44,"./layoutsize/parse":45,"./legend/assemble":46,"./model":63,"./selection/selection":76,"./unit":87,tslib:5}],43:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../fielddef"),q=z("../common");B.HEADER_CHANNELS=["row","column"],B.HEADER_TYPES=["header","footer"],B.getHeaderType=function(Y){return"top"===Y||"left"===Y?"header":"footer"},B.getTitleGroup=function(Y,G){var X=Y.component.layoutHeaders[G].title,K="row"===G?"vertical":void 0;return{name:Y.getName(G+"_title"),role:G+"-title",type:"group",marks:[{type:"text",role:G+"-title-text",style:"guide-title",encode:{update:V.__assign({align:{value:"center"},text:{value:X}},"vertical"===K?{angle:{value:270}}:{})}}]}},B.getHeaderGroup=function(Y,G,X,K,Q){if(Q){var Z=null;if(K.facetFieldDef&&Q.labels){var J=K.facetFieldDef,$=J.header?J.header.format:void 0;Z={text:q.formatSignalRef(J,$,"parent",Y.config),offset:10,orient:"row"===G?"left":"top",style:"guide-label",encode:{update:V.__assign({fontWeight:{value:"normal"},angle:{value:0},fontSize:{value:10}},"row"===G?{align:{value:"right"},baseline:{value:"middle"}}:{})}}}var ee=Q.axes,te=ee&&0<ee.length;if(Z||te){var ae="row"===G?"height":"width";return V.__assign({name:Y.getName(G+"_"+X),type:"group",role:G+"-"+X},K.facetFieldDef?{from:{data:Y.getName(G+"_domain")},sort:{field:W.field(K.facetFieldDef,{expr:"datum"}),order:K.facetFieldDef.header&&K.facetFieldDef.sort||"ascending"}}:{},Z?{title:Z}:{},Q.sizeSignal?{encode:{update:(ne={},ne[ae]=Q.sizeSignal,ne)}}:{},te?{axes:ee}:{})}}return null;var ne}},{"../../fielddef":96,"../common":20,tslib:5}],44:[function(z,H,B){"use strict";function V(K,Q){var Z="width"===Q?"x":"y",J=K.component.layoutSize.get(Q);if(!J||"merged"===J)return[];var $=K.getSizeSignalRef(Q).signal;if("range-step"===J){var ee=K.getScaleComponent(Z);if(ee){var te=ee.get("type"),ae=ee.get("range");if(Y.hasDiscreteDomain(te)&&G.isVgRangeStep(ae)){var ne=K.scaleName(Z);return X.isFacetModel(K.parent)&&"independent"===K.parent.component.resolve.scale[Z]?[W(ne,ae)]:[W(ne,ae),{name:$,update:q(ne,ee,"domain('"+ne+"').length")}]}}throw new Error("layout size is range step although there is no rangeStep.")}return[{name:$,update:""+J}]}function W(K,Q){return{name:K+"_step",value:Q.step}}function q(K,Q,Z){var J=Q.get("type"),$=Q.get("padding"),ee=Q.get("paddingOuter");ee=void 0===ee?$:ee;var te=Q.get("paddingInner");return te="band"===J?void 0===te?$:te:1,"bandspace("+Z+", "+te+", "+ee+") * "+K+"_step"}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("../../scale"),G=z("../../vega.schema"),X=z("../model");B.assembleLayoutSignals=function(K){return[].concat(V(K,"width"),V(K,"height"))},B.sizeSignals=V,B.sizeExpr=q},{"../../scale":104,"../../vega.schema":116,"../model":63}],45:[function(z,H,B){"use strict";function V(Q){W(Q);var Z=Q.component.layoutSize;Z.setWithExplicit("width",q(Q,"width")),Z.setWithExplicit("height",q(Q,"height"))}function W(Q){for(var Z=0,J=Q.children;Z<J.length;Z++)J[Z].parseLayoutSize()}function q(Q,Z){for(var J,$="width"===Z?"x":"y",ee=Q.component.resolve,te=0,ae=Q.children;te<ae.length;te++){var ne=(se=ae[te]).component.layoutSize.getWithExplicit(Z),ie=ee.scale[$];if("independent"===ie&&"range-step"===ne.value){J=void 0;break}if(J){if("independent"===ie&&J.value!==ne.value){J=void 0;break}J=K.mergeValuesWithExplicit(J,ne,Z,"",K.defaultTieBreaker)}else J=ne}if(J){for(var se,oe=0,le=Q.children;oe<le.length;oe++)se=le[oe],Q.renameLayoutSize(se.getName(Z),Q.getName(Z)),se.component.layoutSize.set(Z,"merged",!1);return J}return{explicit:!1,value:void 0}}function Y(Q,Z){var J="width"===Z?"x":"y",$=Q.config,ee=Q.getScaleComponent(J);if(ee){var te=ee.get("type"),ae=ee.get("range");return G.hasDiscreteDomain(te)&&X.isVgRangeStep(ae)?"range-step":$.view[Z]}return"width"===Z&&"text"===Q.mark()?$.scale.textXRangeStep:$.scale.rangeStep||G.defaultScaleConfig.rangeStep}Object.defineProperty(B,"__esModule",{value:!0});var G=z("../../scale"),X=z("../../vega.schema"),K=z("../split");B.parseLayerLayoutSize=V,B.parseRepeatLayoutSize=V,B.parseConcatLayoutSize=function(Q){W(Q);var Z=Q.component.layoutSize,J=Q.isVConcat?"width":"height";Z.setWithExplicit(J,q(Q,J))},B.parseChildrenLayoutSize=W,B.parseUnitLayoutSize=function(Q){var Z=Q.component.layoutSize;if(!Z.explicit.width){var J=Y(Q,"width");Z.set("width",J,!1)}if(!Z.explicit.height){var $=Y(Q,"height");Z.set("height",$,!1)}}},{"../../scale":104,"../../vega.schema":116,"../split":86}],46:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("json-stable-stringify"),W=z("../../util"),q=z("./parse");B.assembleLegends=function(Y){var G=Y.component.legends,X={};return W.keys(G).forEach(function(K){var Q=Y.getScaleComponent(K),Z=V(Q.domains);if(X[Z])for(var ee,J=0,$=X[Z];J<$.length;J++)ee=$[J],q.mergeLegendComponent(ee,G[K])||X[Z].push(G[K]);else X[Z]=[G[K].clone()]}),W.flatten(W.vals(X)).map(function(K){return K.combine()})}},{"../../util":114,"./parse":49,"json-stable-stringify":1}],47:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=function(q){function Y(){return null!==q&&q.apply(this,arguments)||this}return V.__extends(Y,q),Y}(z("../split").Split);B.LegendComponent=W},{"../split":86,tslib:5}],48:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../../channel"),q=z("../../fielddef"),Y=z("../../mark"),G=z("../../scale"),X=z("../../util"),K=z("../common"),Q=z("../mark/mixins");B.symbols=function(Z,J,$,ee,te){if("gradient"!==te.get("type")){var ae={},ne=$.mark();switch(ne){case Y.BAR:case Y.TICK:case Y.TEXT:ae.shape={value:"square"};break;case Y.CIRCLE:case Y.SQUARE:ae.shape={value:ne};break;case Y.POINT:case Y.LINE:case Y.AREA:}var ie=$.markDef.filled,oe=ee===W.COLOR?X.without(Y.FILL_STROKE_CONFIG,[ie?"fill":"stroke","strokeDash","strokeDashOffset"]):Y.FILL_STROKE_CONFIG;if(oe=X.without(oe,["strokeDash","strokeDashOffset"]),K.applyMarkConfig(ae,$,oe),ee!==W.COLOR){var le=Q.color($);le.fill&&(le.fill.field||"transparent"===le.fill.value)&&delete le.fill,le.stroke&&(le.stroke.field||"transparent"===le.stroke.value)&&delete le.stroke,ae=V.__assign({},ae,le)}if(ee!==W.SHAPE){var se=$.encoding.shape;q.isValueDef(se)&&(ae.shape={value:se.value})}if(ee!==W.OPACITY){var re=$.encoding.opacity;q.isValueDef(re)&&(ae.opacity={value:re.value})}return ae=V.__assign({},ae,J),0<X.keys(ae).length?ae:void 0}},B.gradient=function(Z,J,$,ee,te){var ae={};if("gradient"===te.get("type")){var ne=$.encoding.opacity;q.isValueDef(ne)&&(ae.opacity={value:ne.value})}return ae=V.__assign({},ae,J),0<X.keys(ae).length?ae:void 0},B.labels=function(Z,J,$,ee){var ae=$.legend(ee),ne=$.config,ie={};if(q.isTimeFieldDef(Z)){var oe=$.getScaleComponent(ee).get("type")===G.ScaleType.UTC;J=V.__assign({text:{signal:K.timeFormatExpression("datum.value",Z.timeUnit,ae.format,ne.legend.shortTimeLabels,ne.timeFormat,oe)}},J)}return ie=V.__assign({},ie,J),0<X.keys(ie).length?ie:void 0}},{"../../channel":12,"../../fielddef":96,"../../mark":103,"../../scale":104,"../../util":114,"../common":20,"../mark/mixins":56,tslib:5}],49:[function(z,H,B){"use strict";function V(re){re.component.legends=te.isUnitModel(re)?W(re):X(re)}function W(re){return[Q.COLOR,Q.SIZE,Q.SHAPE,Q.OPACITY].reduce(function(de,ce){return re.legend(ce)&&(de[ce]=Y(re,ce)),de},{})}function q(re,de){switch(de){case Q.COLOR:var ce=re.scaleName(Q.COLOR);return re.markDef.filled?{fill:ce}:{stroke:ce};case Q.SIZE:return{size:re.scaleName(Q.SIZE)};case Q.SHAPE:return{shape:re.scaleName(Q.SHAPE)};case Q.OPACITY:return{opacity:re.scaleName(Q.OPACITY)};}return null}function Y(re,de){var ce=re.fieldDef(de),pe=re.legend(de),ue=new oe.LegendComponent({},q(re,de));J.LEGEND_PROPERTIES.forEach(function(fe){var he=G(fe,pe,de,re);if(void 0!==he){var ye="values"===fe?!!pe.values:he===pe[fe];ue.set(fe,he,ye)}});var me=pe.encoding||{},ge=["labels","legend","title","symbols","gradient"].reduce(function(fe,he){var ye=le[he]?le[he](ce,me[he],re,de,ue):me[he];return void 0!==ye&&0<$.keys(ye).length&&(fe[he]={update:ye}),fe},{});return 0<$.keys(ge).length&&ue.set("encode",ge,!!pe.encoding),ue}function G(re,de,ce,pe){var ue=pe.fieldDef(ce);return"format"===re?ee.numberFormat(ue,de.format,pe.config):"title"===re?ee.getSpecifiedOrDefaultValue(de.title,Z.title(ue,pe.config)):"values"===re?se.values(de):"type"===re?ee.getSpecifiedOrDefaultValue(de.type,se.type(ue.type,ce,pe.getScaleComponent(ce).get("type"))):de[re]}function X(re){for(var de=re.component,ce=de.legends,pe=de.resolve,ue=0,me=re.children;ue<me.length;ue++)!function(ge){V(ge),$.keys(ge.component.legends).forEach(function(fe){pe.legend[fe]=ae.parseGuideResolve(re.component.resolve,fe),"shared"===pe.legend[fe]&&(ce[fe]=K(ce[fe],ge.component.legends[fe]),ce[fe]||(pe.legend[fe]="independent",delete ce[fe]))})}(me[ue]);return $.keys(ce).forEach(function(ge){for(var ye,fe=0,he=re.children;fe<he.length;fe++)ye=he[fe],ye.component.legends[ge]&&"shared"===pe.legend[ge]&&delete ye.component.legends[ge]}),ce}function K(re,de){if(!re)return de.clone();var ce=re.getWithExplicit("orient"),pe=de.getWithExplicit("orient");if(!ce.explicit||!pe.explicit||ce.value===pe.value){for(var ue=!1,me=0,ge=J.VG_LEGEND_PROPERTIES;me<ge.length;me++)!function(fe){var he=ie.mergeValuesWithExplicit(re.getWithExplicit(fe),de.getWithExplicit(fe),fe,"legend",function(ye,_e){return"title"===fe?ee.titleMerger(ye,_e):"type"===fe?(ue=!0,ne.makeImplicit("symbol")):ie.defaultTieBreaker(ye,_e,fe,"legend")});re.setWithExplicit(fe,he)}(ge[me]);return ue&&(((re.implicit||{}).encode||{}).gradient&&$.deleteNestedProperty(re.implicit,["encode","gradient"]),((re.explicit||{}).encode||{}).gradient&&$.deleteNestedProperty(re.explicit,["encode","gradient"])),re}}Object.defineProperty(B,"__esModule",{value:!0});var Q=z("../../channel"),Z=z("../../fielddef"),J=z("../../legend"),$=z("../../util"),ee=z("../common"),te=z("../model"),ae=z("../resolve"),ne=z("../split"),ie=z("../split"),oe=z("./component"),le=z("./encode"),se=z("./properties");B.parseLegend=V,B.parseLegendForChannel=Y,B.mergeLegendComponent=K},{"../../channel":12,"../../fielddef":96,"../../legend":100,"../../util":114,"../common":20,"../model":63,"../resolve":66,"../split":86,"./component":47,"./encode":48,"./properties":50}],50:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../channel"),W=z("../../datetime"),q=z("../../scale"),Y=z("../../util");B.values=function(G){var X=G.values;return X&&W.isDateTime(X[0])?X.map(function(K){return{signal:W.dateTimeExpr(K,!0)}}):X},B.type=function(G,X,K){if(X===V.COLOR&&("quantitative"===G&&!q.isBinScale(K)||"temporal"===G&&Y.contains(["time","utc"],K)))return"gradient"}},{"../../channel":12,"../../datetime":93,"../../scale":104,"../../util":114}],51:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("./mixins");B.area={vgMark:"area",encodeEntry:function(Y){return V.__assign({},W.pointPosition("x",Y,"zeroOrMin"),W.pointPosition("y",Y,"zeroOrMin"),W.pointPosition2(Y,"zeroOrMin"),W.color(Y),W.text(Y,"tooltip"),W.nonPosition("opacity",Y),W.markDefProperties(Y.markDef,["orient","interpolate","tension"]))}}},{"./mixins":56,tslib:5}],52:[function(z,H,B){"use strict";function V(te){var ne=te.config,ie=te.width,oe=te.markDef.orient,le=te.encoding.size,se=te.encoding.x,re=te.scaleName(X.X),de=te.getScaleComponent(X.X);if("horizontal"===oe)return Y.__assign({},$.pointPosition("x",te,"zeroOrMin"),$.pointPosition2(te,"zeroOrMin"));if(K.isFieldDef(se)){var ce=de.get("type");if(se.bin&&!le&&!Z.hasDiscreteDomain(ce))return $.binnedPosition(se,"x",te.scaleName("x"),ne.bar.binSpacing,de.get("reverse"));if(ce===Z.ScaleType.BAND)return $.bandPosition(se,"x",te)}return $.centeredBandPosition("x",te,Y.__assign({},ee.mid(ie)),q(re,de,ne))}function W(te){var ne=te.config,ie=te.encoding,oe=te.height,le=te.markDef.orient,se=ie.size,re=ie.y,de=te.scaleName(X.Y),ce=te.getScaleComponent(X.Y);if("vertical"===le)return Y.__assign({},$.pointPosition("y",te,"zeroOrMin"),$.pointPosition2(te,"zeroOrMin"));if(K.isFieldDef(re)){var pe=ce.get("type");if(re.bin&&!se&&!Z.hasDiscreteDomain(pe))return $.binnedPosition(re,"y",te.scaleName("y"),ne.bar.binSpacing,ce.get("reverse"));if(pe===Z.ScaleType.BAND)return $.bandPosition(re,"y",te)}return $.centeredBandPosition("y",te,ee.mid(oe),q(de,ce,ne))}function q(te,ae,ne){if(ne.bar.discreteBandSize)return{value:ne.bar.discreteBandSize};if(ae){var ie=ae.get("type");if(ie!==Z.ScaleType.POINT)return ie===Z.ScaleType.BAND?ee.band(te):{value:ne.bar.continuousBandSize};var oe=ae.get("range");if(J.isVgRangeStep(oe)&&G.isNumber(oe.step))return{value:oe.step-1};Q.warn(Q.message.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL)}return ne.scale.rangeStep&&null!==ne.scale.rangeStep?{value:ne.scale.rangeStep-1}:{value:20}}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("tslib"),G=z("vega-util"),X=z("../../channel"),K=z("../../fielddef"),Q=z("../../log"),Z=z("../../scale"),J=z("../../vega.schema"),$=z("./mixins"),ee=z("./valueref");B.bar={vgMark:"rect",encodeEntry:function(ae){return ae.stack,Y.__assign({},V(ae),W(ae),$.color(ae),$.text(ae,"tooltip"),$.nonPosition("opacity",ae))}}},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../scale":104,"../../vega.schema":116,"./mixins":56,"./valueref":62,tslib:5,"vega-util":7}],53:[function(z,H,B){"use strict";function V(ee,te){if(J.contains([K.POINT,K.TICK,K.CIRCLE,K.SQUARE],ee)&&!Y.isAggregate(te))return .7}function W(ee,te){var ae=$.getMarkConfig("filled",ee,te),ne=ee.type;return void 0===ae?ne!==K.POINT&&ne!==K.LINE&&ne!==K.RULE:ae}function q(ee,te,ae,ne){switch(ee){case K.POINT:case K.CIRCLE:case K.SQUARE:case K.TEXT:case K.RECT:return;}var ie=te.y&&te.y2,oe=te.x&&te.x2;switch(ee){case K.TICK:var le=ae.x?ae.x.get("type"):null,se=ae.y?ae.y.get("type"):null;return!Q.hasDiscreteDomain(le)&&(!te.y||Q.hasDiscreteDomain(se)||G.isFieldDef(te.y)&&te.y.bin)?"vertical":"horizontal";case K.RULE:case K.BAR:case K.AREA:if(ie)return"vertical";if(oe)return"horizontal";if(ee===K.RULE){if(te.x&&!te.y)return"vertical";if(te.y&&!te.x)return"horizontal"}case K.LINE:var re=G.isFieldDef(te.x)&&G.isContinuous(te.x),de=G.isFieldDef(te.y)&&G.isContinuous(te.y);if(re&&!de)return"horizontal";if(!re&&de)return"vertical";if(re&&de){var ce=te.x,pe=te.y,ue=ce.type===Z.TEMPORAL,me=pe.type===Z.TEMPORAL;return ue&&!me?"vertical":!ue&&me?"horizontal":!ce.aggregate&&pe.aggregate?"vertical":ce.aggregate&&!pe.aggregate?"horizontal":ne||(ee===K.LINE&&te.order||X.warn(X.message.unclearOrientContinuous(ee)),"vertical")}return void X.warn(X.message.unclearOrientDiscreteOrEmpty(ee));}return"vertical"}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("../../encoding"),G=z("../../fielddef"),X=z("../../log"),K=z("../../mark"),Q=z("../../scale"),Z=z("../../type"),J=z("../../util"),$=z("../common");B.normalizeMarkDef=function(ee,te,ae,ne){var ie=ee.orient||$.getMarkConfig("orient",ee,ne);ee.orient=q(ee.type,te,ae,ie),void 0!==ie&&ie!==ee.orient&&X.warn(X.message.orientOverridden(ee.orient,ie)),void 0===ee.filled&&(ee.filled=W(ee,ne))},B.initEncoding=function(ee,te,ae,ne){var ie=$.getMarkConfig("opacity",ee,ne);if(!te.opacity&&void 0===ie){var oe=V(ee.type,te);void 0!==oe&&(te.opacity={value:oe})}return te}},{"../../encoding":94,"../../fielddef":96,"../../log":101,"../../mark":103,"../../scale":104,"../../type":113,"../../util":114,"../common":20}],54:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("./mixins"),q=z("./valueref");B.line={vgMark:"line",encodeEntry:function(G){var X=G.width,K=G.height;return V.__assign({},W.pointPosition("x",G,q.mid(X)),W.pointPosition("y",G,q.mid(K)),W.color(G),W.text(G,"tooltip"),W.nonPosition("opacity",G),W.nonPosition("size",G,{vgChannel:"strokeWidth"}),W.markDefProperties(G.markDef,["interpolate","tension"]))}}},{"./mixins":56,"./valueref":62,tslib:5}],55:[function(z,H,B){"use strict";function V(ye){if(oe.isUnitModel(ye))re.normalizeMarkDef(ye.markDef,ye.encoding,ye.component.scales,ye.config);else for(var _e=0,Se=ye.children;_e<Se.length;_e++)V(Se[_e])}function W(ye){var _e=ye.mark(),Se=G(ye),be=void 0===ye.markDef.clip?X(ye):!!ye.markDef.clip,ve=ie.getStyles(ye.markDef),xe=q(ye),Ee=[K.__assign({name:ye.getName("marks"),type:fe[_e].vgMark},be?{clip:!0}:{},ve?{style:ve}:{},xe?{sort:xe}:{},{from:{data:(0<Se.length?he:"")+ye.requestDataName(J.MAIN)},encode:{update:fe[_e].encodeEntry(ye)}})];return 0<Se.length?[{name:ye.getName("pathgroup"),type:"group",from:{facet:{name:he+ye.requestDataName(J.MAIN),data:ye.requestDataName(J.MAIN),groupby:Se}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:Ee}]:Ee}function q(ye){if("line"===ye.mark()&&ye.channelHasField("order"))return ie.sortParams(ye.encoding.order,{expr:"datum"});var _e="horizontal"===ye.markDef.orient?"y":"x",Se=ye.sort(_e),be=ae.isSortField(Se)?ee.field({aggregate:$.isAggregate(ye.encoding)?Se.op:void 0,field:Se.field},{expr:"datum"}):ye.field(_e,{binSuffix:ye.stack&&ye.stack.impute?"mid":void 0,expr:"datum"});return be?{field:be,order:"descending"}:void 0}function Y(ye){var _e=ye.mark(),Se=ie.getStyles(ye.markDef),be=void 0===ye.markDef.clip?X(ye):!!ye.markDef.clip,ve=[];return ve.push(K.__assign({name:ye.getName("marks"),type:fe[_e].vgMark},be?{clip:!0}:{},Se?{style:Se}:{},{from:{data:ye.requestDataName(J.MAIN)},encode:{update:fe[_e].encodeEntry(ye)}})),ve}function G(ye){return Z.NONSPATIAL_CHANNELS.reduce(function(_e,Se){var be=ye.encoding;if("order"===Se)return _e;if("detail"===Se){var ve=be[Se];ve&&(Q.isArray(ve)?ve:[ve]).forEach(function(Ee){Ee.aggregate||_e.push(ee.field(Ee,{}))})}else{var xe=ee.getFieldDef(be[Se]);xe&&!xe.aggregate&&_e.push(ee.field(xe,{}))}return _e},[])}function X(ye){var _e=ye.getScaleComponent("x"),Se=ye.getScaleComponent("y");return!!(_e&&_e.get("domainRaw")||Se&&Se.get("domainRaw"))}Object.defineProperty(B,"__esModule",{value:!0});var K=z("tslib"),Q=z("vega-util"),Z=z("../../channel"),J=z("../../data"),$=z("../../encoding"),ee=z("../../fielddef"),te=z("../../mark"),ae=z("../../sort"),ne=z("../../util"),ie=z("../common"),oe=z("../model"),le=z("./area"),se=z("./bar"),re=z("./init"),de=z("./line"),ce=z("./point"),pe=z("./rect"),ue=z("./rule"),me=z("./text"),ge=z("./tick"),fe={area:le.area,bar:se.bar,line:de.line,point:ce.point,text:me.text,tick:ge.tick,rect:pe.rect,rule:ue.rule,circle:ce.circle,square:ce.square};B.parseMarkDef=V,B.parseMarkGroup=function(ye){return ne.contains([te.LINE,te.AREA],ye.mark())?W(ye):Y(ye)};var he="faceted_path_";B.getPathSort=q},{"../../channel":12,"../../data":92,"../../encoding":94,"../../fielddef":96,"../../mark":103,"../../sort":106,"../../util":114,"../common":20,"../model":63,"./area":51,"./bar":52,"./init":53,"./line":54,"./point":57,"./rect":58,"./rule":59,"./text":60,"./tick":61,tslib:5,"vega-util":7}],56:[function(z,H,B){"use strict";function V($,ee,te){void 0===te&&(te={});var ae=te.defaultValue,ne=te.vgChannel,ie=te.defaultRef||(void 0===ae?void 0:{value:ae}),oe=ee.encoding[$];return W(ee,oe,ne||$,function(le){return J.midPoint($,le,ee.scaleName($),ee.getScaleComponent($),null,ie)})}function W($,ee,te,ae){var ne=ee&&ee.condition,ie=ae(ee);if(ne){var oe=ae(ne);return le={},le[te]=[Y.__assign({test:Z.predicate($,ne.selection)},oe)].concat(void 0===ie?[]:[ie]),le}return void 0===ie?{}:(se={},se[te]=ie,se);var le,se}function q($,ee,te,ae){var ne=ee.encoding,ie=ee.stack,oe=J.stackable($,ne[$],ee.scaleName($),ee.getScaleComponent($),ie,te);return le={},le[ae||$]=oe,le;var le}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("tslib"),G=z("../../fielddef"),X=z("../../log"),K=z("../../util"),Q=z("../common"),Z=z("../selection/selection"),J=z("./valueref");B.color=function($){var ee=$.config,te=$.markDef.filled?"fill":"stroke",ae=V("color",$,{vgChannel:te,defaultValue:Q.getMarkConfig(te,$.markDef,ee)||Q.getMarkConfig("color",$.markDef,ee)});return!ae.fill&&K.contains(["bar","point","circle","square"],$.mark())&&(ae.fill={value:"transparent"}),ae},B.markDefProperties=function($,ee){return ee.reduce(function(te,ae){return $[ae]&&(te[ae]={value:$[ae]}),te},{})},B.valueIfDefined=function($,ee){return void 0===ee?void 0:(te={},te[$]={value:ee},te);var te},B.nonPosition=V,B.text=function($,ee){void 0===ee&&(ee="text");var te=$.encoding[ee];return W($,te,ee,function(ae){return J.text(ae,$.config)})},B.bandPosition=function($,ee,te){var ae=te.scaleName(ee),ne="x"===ee?"width":"height";if(te.encoding.size)if(te.markDef.orient){var ie=(oe={},oe[ee+"c"]=J.fieldRef($,ae,{},{band:.5}),oe);if(G.getFieldDef(te.encoding.size))X.warn(X.message.cannotUseSizeFieldWithBandSize(ee));else if(G.isValueDef(te.encoding.size))return Y.__assign({},ie,V("size",te,{vgChannel:ne}))}else X.warn(X.message.cannotApplySizeToNonOrientedMark(te.markDef.type));return le={},le[ee]=J.fieldRef($,ae,{binSuffix:"range"}),le[ne]=J.band(ae),le;var oe,le},B.centeredBandPosition=function($,ee,te,ae){var ne="x"===$?"xc":"yc",ie="x"===$?"width":"height";return Y.__assign({},q($,ee,te,ne),V("size",ee,{defaultRef:ae,vgChannel:ie}))},B.binnedPosition=function($,ee,te,ae,ne){return"x"===ee?{x2:J.bin($,te,"start",ne?0:ae),x:J.bin($,te,"end",ne?ae:0)}:{y2:J.bin($,te,"start",ne?ae:0),y:J.bin($,te,"end",ne?0:ae)}},B.pointPosition=q,B.pointPosition2=function($,ee,te){var ae=$.encoding,ne=$.markDef,ie=$.stack,oe="x2"===(te=te||("horizontal"===ne.orient?"x2":"y2"))?"x":"y",le=J.stackable2(te,ae[oe],ae[te],$.scaleName(oe),$.getScaleComponent(oe),ie,ee);return se={},se[te]=le,se;var se}},{"../../fielddef":96,"../../log":101,"../../util":114,"../common":20,"../selection/selection":76,"./valueref":62,tslib:5}],57:[function(z,H,B){"use strict";function V(K,Q){var Z=K.config,J=K.width,$=K.height;return q.__assign({},G.pointPosition("x",K,X.mid(J)),G.pointPosition("y",K,X.mid($)),G.color(K),G.text(K,"tooltip"),G.nonPosition("size",K),W(K,Z,Q),G.nonPosition("opacity",K))}function W(K,Q,Z){return Z?{shape:{value:Z}}:G.nonPosition("shape",K,{defaultValue:Y.getMarkConfig("shape",K.markDef,Q)})}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../common"),G=z("./mixins"),X=z("./valueref");B.shapeMixins=W,B.point={vgMark:"symbol",encodeEntry:function(Q){return V(Q)}},B.circle={vgMark:"symbol",encodeEntry:function(Q){return V(Q,"circle")}},B.square={vgMark:"symbol",encodeEntry:function(Q){return V(Q,"square")}}},{"../common":20,"./mixins":56,"./valueref":62,tslib:5}],58:[function(z,H,B){"use strict";function V(J){var $=J.encoding.x,ee=J.encoding.x2,te=J.getScaleComponent(Y.X),ae=te?te.get("type"):void 0;if(G.isFieldDef($)&&$.bin&&!ee)return Z.binnedPosition($,"x",J.scaleName("x"),0,te.get("reverse"));if(G.isFieldDef($)&&te&&Q.hasDiscreteDomain(ae)){if(ae===Q.ScaleType.BAND)return Z.bandPosition($,"x",J);throw new Error(X.message.scaleTypeNotWorkWithMark(K.RECT,ae))}return q.__assign({},Z.pointPosition("x",J,"zeroOrMax"),Z.pointPosition2(J,"zeroOrMin","x2"))}function W(J){var $=J.encoding.y,ee=J.encoding.y2,te=J.getScaleComponent(Y.Y),ae=te?te.get("type"):void 0;if(G.isFieldDef($)&&$.bin&&!ee)return Z.binnedPosition($,"y",J.scaleName("y"),0,te.get("reverse"));if(G.isFieldDef($)&&te&&Q.hasDiscreteDomain(ae)){if(ae===Q.ScaleType.BAND)return Z.bandPosition($,"y",J);throw new Error(X.message.scaleTypeNotWorkWithMark(K.RECT,ae))}return q.__assign({},Z.pointPosition("y",J,"zeroOrMax"),Z.pointPosition2(J,"zeroOrMin","y2"))}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../../channel"),G=z("../../fielddef"),X=z("../../log"),K=z("../../mark"),Q=z("../../scale"),Z=z("./mixins");B.rect={vgMark:"rect",encodeEntry:function($){return q.__assign({},V($),W($),Z.color($),Z.text($,"tooltip"),Z.nonPosition("opacity",$))}}},{"../../channel":12,"../../fielddef":96,"../../log":101,"../../mark":103,"../../scale":104,"./mixins":56,tslib:5}],59:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("./mixins"),q=z("./valueref");B.rule={vgMark:"rule",encodeEntry:function(G){G.config;var X=G.markDef,K=G.width,Q=G.height,Z=X.orient;return V.__assign({},W.pointPosition("x",G,"horizontal"===Z?"zeroOrMin":q.mid(K)),W.pointPosition("y",G,"vertical"===Z?"zeroOrMin":q.mid(Q)),W.pointPosition2(G,"zeroOrMax"),W.color(G),W.text(G,"tooltip"),W.nonPosition("opacity",G),W.nonPosition("size",G,{vgChannel:"strokeWidth"}))}}},{"./mixins":56,"./valueref":62,tslib:5}],60:[function(z,H,B){"use strict";function V($,ee){return X.isFieldDef(ee)&&ee.type===K.QUANTITATIVE?{field:{group:"width"},offset:-5}:{value:$.scale.textXRangeStep/2}}function W($,ee,te){if(void 0===Q.getMarkConfig("align",$,te))return G.channelHasField(ee,Y.X)?"center":"right"}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../../channel"),G=z("../../encoding"),X=z("../../fielddef"),K=z("../../type"),Q=z("../common"),Z=z("./mixins"),J=z("./valueref");B.text={vgMark:"text",encodeEntry:function(ee){var te=ee.config,ae=ee.encoding,ne=ee.height,ie=ae.text;return q.__assign({},Z.pointPosition("x",ee,V(te,ie)),Z.pointPosition("y",ee,J.mid(ne)),Z.text(ee),Z.color(ee),Z.text(ee,"tooltip"),Z.nonPosition("opacity",ee),Z.nonPosition("size",ee,{vgChannel:"fontSize"}),Z.valueIfDefined("align",W(ee.markDef,ae,te)))}}},{"../../channel":12,"../../encoding":94,"../../fielddef":96,"../../type":113,"../common":20,"./mixins":56,"./valueref":62,tslib:5}],61:[function(z,H,B){"use strict";function V(X){var K=X.config,Q=X.markDef.orient,Z=X.getScaleComponent("horizontal"===Q?"x":"y");if(void 0!==K.tick.bandSize)return K.tick.bandSize;var J=Z?Z.get("range"):void 0,$=J&&q.isVgRangeStep(J)?J.step:K.scale.rangeStep;if("number"!=typeof $)throw new Error("Function does not handle non-numeric rangeStep");return $/1.5}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("../../vega.schema"),Y=z("./mixins"),G=z("./valueref");B.tick={vgMark:"rect",encodeEntry:function(K){var Q=K.config,Z=K.markDef,J=K.width,$=K.height,ee=Z.orient,te="horizontal"===ee?"width":"height",ae="horizontal"===ee?"height":"width";return W.__assign({},Y.pointPosition("x",K,G.mid(J),"xc"),Y.pointPosition("y",K,G.mid($),"yc"),Y.nonPosition("size",K,{defaultValue:V(K),vgChannel:te}),(ne={},ne[ae]={value:Q.tick.thickness},ne),Y.color(K),Y.nonPosition("opacity",K));var ne}}},{"../../vega.schema":116,"./mixins":56,"./valueref":62,tslib:5}],62:[function(z,H,B){"use strict";function V(ae,ne,ie,oe){var le={scale:ne,field:J.field(ae,ie)};return oe?Q.__assign({},le,oe):le}function W(ae,ne){return{signal:"(scale(\""+ne+"\", "+J.field(ae,{expr:"datum"})+") + scale(\""+ne+"\", "+J.field(ae,{binSuffix:"end",expr:"datum"})+"))/2"}}function q(ae,ne,ie,oe,le,se){if(ne){if(J.isFieldDef(ne)){if(ne.bin)return ee.contains(["x","y"],ae)&&"quantitative"===ne.type?le&&le.impute?V(ne,ie,{binSuffix:"mid"}):W(ne,ie):V(ne,ie,te.binRequiresRange(ne,ae)?{binSuffix:"range"}:{});var re=oe.get("type");return $.hasDiscreteDomain(re)?"band"===re?V(ne,ie,{binSuffix:"range"},{band:.5}):V(ne,ie,{binSuffix:"range"}):V(ne,ie,{})}if(J.isValueDef(ne))return{value:ne.value};throw new Error("FieldDef without field or value.")}if("zeroOrMin"===se){if(ae===Z.X||ae===Z.X2)return Y(ie,oe);if(ae===Z.Y||ae===Z.Y2)return X(ie,oe);throw new Error("Unsupported channel "+ae+" for base function")}if("zeroOrMax"===se){if(ae===Z.X||ae===Z.X2)return G(ie,oe);if(ae===Z.Y||ae===Z.Y2)return K(ie,oe);throw new Error("Unsupported channel "+ae+" for base function")}return se}function Y(ae,ne){return ae&&!ee.contains([$.ScaleType.LOG,$.ScaleType.TIME,$.ScaleType.UTC],ne.get("type"))&&!1!==ne.get("zero")?{scale:ae,value:0}:{value:0}}function G(ae,ne){return ae&&!ee.contains([$.ScaleType.LOG,$.ScaleType.TIME,$.ScaleType.UTC],ne.get("type"))&&!1!==ne.get("zero")?{scale:ae,value:0}:{field:{group:"width"}}}function X(ae,ne){return ae&&!ee.contains([$.ScaleType.LOG,$.ScaleType.TIME,$.ScaleType.UTC],ne.get("type"))&&!1!==ne.get("zero")?{scale:ae,value:0}:{field:{group:"height"}}}function K(ae,ne){return ae&&!ee.contains([$.ScaleType.LOG,$.ScaleType.TIME,$.ScaleType.UTC],ne.get("type"))&&!1!==ne.get("zero")?{scale:ae,value:0}:{value:0}}Object.defineProperty(B,"__esModule",{value:!0});var Q=z("tslib"),Z=z("../../channel"),J=z("../../fielddef"),$=z("../../scale"),ee=z("../../util"),te=z("../common");B.stackable=function(ae,ne,ie,oe,le,se){return J.isFieldDef(ne)&&le&&ae===le.fieldChannel?V(ne,ie,{suffix:"end"}):q(ae,ne,ie,oe,le,se)},B.stackable2=function(ae,ne,ie,oe,le,se,re){return J.isFieldDef(ne)&&se&&ae.charAt(0)===se.fieldChannel.charAt(0)?V(ne,oe,{suffix:"start"}):q(ae,ie,oe,le,se,re)},B.bin=function(ae,ne,ie,oe){return V(ae,ne,{binSuffix:"start"===ie?void 0:"end"},oe?{offset:oe}:{})},B.fieldRef=V,B.band=function(ae,ne){return void 0===ne&&(ne=!0),{scale:ae,band:ne}},B.midPoint=q,B.text=function(ae,ne){if(ae){if(J.isFieldDef(ae))return te.formatSignalRef(ae,ae.format,"datum",ne);if(J.isValueDef(ae))return{value:ae.value}}},B.mid=function(ae){return Q.__assign({},ae,{mult:.5})}},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../util":114,"../common":20,tslib:5}],63:[function(z,H,B){"use strict";function V(fe){return fe&&"unit"===fe.type}function W(fe){return fe&&"facet"===fe.type}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("vega-util"),G=z("../channel"),X=z("../encoding"),K=z("../fielddef"),Q=z("../log"),Z=z("../scale"),J=z("../title"),$=z("../transform"),ee=z("../util"),te=z("../vega.schema"),ae=z("./axis/assemble"),ne=z("./layout/header"),ie=z("./layoutsize/assemble"),oe=z("./legend/assemble"),le=z("./legend/parse"),se=z("./mark/mark"),re=z("./scale/assemble"),de=z("./scale/domain"),ce=z("./scale/parse"),pe=z("./split"),ue=function(){function fe(){this.nameMap={}}return fe.prototype.rename=function(he,ye){this.nameMap[he]=ye},fe.prototype.has=function(he){return void 0!==this.nameMap[he]},fe.prototype.get=function(he){for(;this.nameMap[he]&&he!==this.nameMap[he];)he=this.nameMap[he];return he},fe}();B.NameMap=ue,B.isUnitModel=V,B.isFacetModel=W,B.isRepeatModel=function(fe){return fe&&"repeat"===fe.type},B.isConcatModel=function(fe){return fe&&"concat"===fe.type},B.isLayerModel=function(fe){return fe&&"layer"===fe.type};var me=function(){function fe(he,ye,_e,Se,be){var ve=this;this.children=[],this.correctDataNames=function(xe){return xe.from&&xe.from.data&&(xe.from.data=ve.lookupDataSource(xe.from.data)),xe.from&&xe.from.facet&&xe.from.facet.data&&(xe.from.facet.data=ve.lookupDataSource(xe.from.facet.data)),xe},this.parent=ye,this.config=Se,this.name=he.name||_e,this.title=Y.isString(he.title)?{text:he.title}:he.title,this.scaleNameMap=ye?ye.scaleNameMap:new ue,this.layoutSizeNameMap=ye?ye.layoutSizeNameMap:new ue,this.data=he.data,this.description=he.description,this.transforms=$.normalizeTransform(he.transform||[]),this.component={data:{sources:ye?ye.component.data.sources:{},outputNodes:ye?ye.component.data.outputNodes:{},outputNodeRefCounts:ye?ye.component.data.outputNodeRefCounts:{},ancestorParse:ye?q.__assign({},ye.component.data.ancestorParse):{}},layoutSize:new pe.Split,layoutHeaders:{row:{},column:{}},mark:null,resolve:q.__assign({scale:{},axis:{},legend:{}},be||{}),selection:null,scales:null,axes:{},legends:{}}}return Object.defineProperty(fe.prototype,"width",{get:function(){return this.getSizeSignalRef("width")},enumerable:!0,configurable:!0}),Object.defineProperty(fe.prototype,"height",{get:function(){return this.getSizeSignalRef("height")},enumerable:!0,configurable:!0}),fe.prototype.initSize=function(he){var ye=he.width,_e=he.height;ye&&this.component.layoutSize.set("width",ye,!0),_e&&this.component.layoutSize.set("height",_e,!0)},fe.prototype.parse=function(){this.parseScale(),this.parseMarkDef(),this.parseLayoutSize(),this.renameTopLevelLayoutSize(),this.parseSelection(),this.parseData(),this.parseAxisAndHeader(),this.parseLegend(),this.parseMarkGroup()},fe.prototype.parseScale=function(){ce.parseScale(this)},fe.prototype.renameTopLevelLayoutSize=function(){"width"!==this.getName("width")&&this.renameLayoutSize(this.getName("width"),"width"),"height"!==this.getName("height")&&this.renameLayoutSize(this.getName("height"),"height")},fe.prototype.parseMarkDef=function(){se.parseMarkDef(this)},fe.prototype.parseLegend=function(){le.parseLegend(this)},fe.prototype.assembleGroupStyle=function(){if("unit"===this.type||"layer"===this.type)return"cell"},fe.prototype.assembleLayoutSize=function(){if("unit"===this.type||"layer"===this.type)return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},fe.prototype.assembleHeaderMarks=function(){for(var he=this.component.layoutHeaders,ye=[],_e=0,Se=ne.HEADER_CHANNELS;_e<Se.length;_e++)he[xe=Se[_e]].title&&ye.push(ne.getTitleGroup(this,xe));for(var be=0,ve=ne.HEADER_CHANNELS;be<ve.length;be++)for(var De,xe=ve[be],Ee=he[xe],Ne=0,Te=ne.HEADER_TYPES;Ne<Te.length;Ne++)if(De=Te[Ne],Ee[De])for(var ke=0,Oe=Ee[De];ke<Oe.length;ke++){var Ce=Oe[ke],Ae=ne.getHeaderGroup(this,xe,De,Ee,Ce);Ae&&ye.push(Ae)}return ye},fe.prototype.assembleAxes=function(){return ae.assembleAxes(this.component.axes)},fe.prototype.assembleLegends=function(){return oe.assembleLegends(this)},fe.prototype.assembleTitle=function(){var he=q.__assign({},J.extractTitleConfig(this.config.title).nonMark,this.title);if(he.text)return ee.contains(["unit","layer"],this.type)||(he.anchor&&"start"!==he.anchor&&Q.warn(Q.message.cannotSetTitleAnchor(this.type)),he.anchor="start"),0<ee.keys(he).length?he:void 0},fe.prototype.assembleGroup=function(he){void 0===he&&(he=[]);var ye={};0<(he=he.concat(this.assembleSelectionSignals())).length&&(ye.signals=he);var _e=this.assembleLayout();_e&&(ye.layout=_e),ye.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());var Se=!this.parent||W(this.parent)?re.assembleScales(this):[];0<Se.length&&(ye.scales=Se);var be=this.assembleAxes();0<be.length&&(ye.axes=be);var ve=this.assembleLegends();return 0<ve.length&&(ye.legends=ve),ye},fe.prototype.hasDescendantWithFieldOnChannel=function(he){for(var Se,ye=0,_e=this.children;ye<_e.length;ye++)if(Se=_e[ye],V(Se)){if(Se.channelHasField(he))return!0;}else if(Se.hasDescendantWithFieldOnChannel(he))return!0;return!1},fe.prototype.getName=function(he){return ee.varName((this.name?this.name+"_":"")+he)},fe.prototype.requestDataName=function(he){var ye=this.getName(he),_e=this.component.data.outputNodeRefCounts;return _e[ye]=(_e[ye]||0)+1,ye},fe.prototype.getSizeSignalRef=function(he){if(W(this.parent)){var ye="width"===he?"x":"y",_e=this.component.scales[ye];if(_e&&!_e.merged){var Se=_e.get("type"),be=_e.get("range");if(Z.hasDiscreteDomain(Se)&&te.isVgRangeStep(be)){var ve=_e.get("name"),xe=de.assembleDomain(this,ye),Ee=de.getFieldFromDomain(xe);if(Ee){var Ne=K.field({aggregate:"distinct",field:Ee},{expr:"datum"});return{signal:ie.sizeExpr(ve,_e,Ne)}}return Q.warn("Unknown field for ${channel}.  Cannot calculate view size."),null}}}return{signal:this.layoutSizeNameMap.get(this.getName(he))}},fe.prototype.lookupDataSource=function(he){var ye=this.component.data.outputNodes[he];return ye?ye.getSource():he},fe.prototype.getSizeName=function(he){return this.layoutSizeNameMap.get(he)},fe.prototype.renameLayoutSize=function(he,ye){this.layoutSizeNameMap.rename(he,ye)},fe.prototype.renameScale=function(he,ye){this.scaleNameMap.rename(he,ye)},fe.prototype.scaleName=function(he,ye){return ye?this.getName(he):G.isChannel(he)&&G.isScaleChannel(he)&&this.component.scales[he]||this.scaleNameMap.has(this.getName(he))?this.scaleNameMap.get(this.getName(he)):void 0},fe.prototype.getScaleComponent=function(he){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale().  Make sure you have called parseScale or use parseUnitModelWithScale().");var ye=this.component.scales[he];return ye&&!ye.merged?ye:this.parent?this.parent.getScaleComponent(he):void 0},fe.prototype.getSelectionComponent=function(he,ye){var _e=this.component.selection[he];if(!_e&&this.parent&&(_e=this.parent.getSelectionComponent(he,ye)),!_e)throw new Error(Q.message.selectionNotFound(ye));return _e},fe}();B.Model=me;var ge=function(fe){function he(){return null!==fe&&fe.apply(this,arguments)||this}return q.__extends(he,fe),he.prototype.field=function(ye,_e){void 0===_e&&(_e={});var Se=this.fieldDef(ye);if(Se)return K.field(Se,_e)},he.prototype.reduceFieldDef=function(ye,_e,Se){return X.reduce(this.getMapping(),function(be,ve,xe){var Ee=K.getFieldDef(ve);return Ee?ye(be,Ee,xe):be},_e,Se)},he.prototype.forEachFieldDef=function(ye,_e){X.forEach(this.getMapping(),function(Se,be){var ve=K.getFieldDef(Se);ve&&ye(ve,be)},_e)},he}(me);B.ModelWithField=ge},{"../channel":12,"../encoding":94,"../fielddef":96,"../log":101,"../scale":104,"../title":110,"../transform":112,"../util":114,"../vega.schema":116,"./axis/assemble":13,"./layout/header":43,"./layoutsize/assemble":44,"./legend/assemble":46,"./legend/parse":49,"./mark/mark":55,"./scale/assemble":67,"./scale/domain":69,"./scale/parse":70,"./split":86,tslib:5,"vega-util":7}],64:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("./baseconcat"),q=z("./buildmodel"),Y=z("./layoutsize/parse"),G=function(X){function K(Q,Z,J,$,ee){var te=X.call(this,Q,Z,J,ee,Q.resolve)||this;return te.type="repeat",te.repeat=Q.repeat,te.children=te._initChildren(Q,te.repeat,$,ee),te}return V.__extends(K,X),K.prototype._initChildren=function(Q,Z,J,$){for(var ee=[],te=Z.row||[J?J.row:null],ae=Z.column||[J?J.column:null],ne=0,ie=te;ne<ie.length;ne++)for(var oe=ie[ne],le=0,se=ae;le<se.length;le++){var re=se[le],de=(oe?"_"+oe:"")+(re?"_"+re:"");ee.push(q.buildModel(Q.spec,this,this.getName("child"+de),void 0,{row:oe,column:re},$))}return ee},K.prototype.parseLayoutSize=function(){Y.parseRepeatLayoutSize(this)},K.prototype.assembleLayout=function(){return{padding:{row:10,column:10},offset:10,columns:this.repeat&&this.repeat.column?this.repeat.column.length:1,bounds:"full",align:"all"}},K}(W.BaseConcatModel);B.RepeatModel=G},{"./baseconcat":18,"./buildmodel":19,"./layoutsize/parse":45,tslib:5}],65:[function(z,H,B){"use strict";function V(K,Q){var Z=K.field;return G.isRepeatRef(Z)?Z.repeat in Q?q.__assign({},K,{field:Q[Z.repeat]}):(X.warn(X.message.noSuchRepeatedValue(Z.repeat)),null):K}function W(K,Q){var Z={};for(var J in K)if(K.hasOwnProperty(J)){var $=K[J];if(Y.isArray($))Z[J]=$.map(function(te){return V(te,Q)}).filter(function(te){return null!==te});else{var ee=V($,Q);null!==ee&&(Z[J]=ee)}}return Z}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("vega-util"),G=z("../fielddef"),X=z("../log");B.replaceRepeaterInFacet=function(K,Q){return W(K,Q)},B.replaceRepeaterInEncoding=function(K,Q){return W(K,Q)}},{"../fielddef":96,"../log":101,tslib:5,"vega-util":7}],66:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../channel"),W=z("../log"),q=z("../util"),Y=z("./model");B.defaultScaleResolve=function(G,X){if(Y.isLayerModel(X)||Y.isFacetModel(X))return"shared";if(Y.isConcatModel(X)||Y.isRepeatModel(X))return q.contains(V.SPATIAL_SCALE_CHANNELS,G)?"independent":"shared";throw new Error("invalid model type for resolve")},B.parseGuideResolve=function(G,X){var K=G.scale[X],Q=q.contains(V.SPATIAL_SCALE_CHANNELS,X)?"axis":"legend";return"independent"===K?("shared"===G[Q][X]&&W.warn(W.message.independentScaleMeansIndependentGuide(X)),"independent"):G[Q][X]||"shared"}},{"../channel":12,"../log":101,"../util":114,"./model":63}],67:[function(z,H,B){"use strict";function V($){return Q.isLayerModel($)||Q.isConcatModel($)||Q.isRepeatModel($)?$.children.reduce(function(ee,te){return ee.concat(V(te))},W($)):W($)}function W($){return X.keys($.component.scales).reduce(function(ee,te){var ae=$.component.scales[te];if(ae.merged)return ee;var ne=ae.combine(),ie=ne.domainRaw,oe=ne.range,le=ne.name,se=ne.type,re=(ne.domainRaw,ne.range,Y.__rest(ne,["name","type","domainRaw","range"]));return oe=q(oe,le,$,te),ie&&Z.isRawSelectionDomain(ie)&&(ie=Z.selectionScaleDomain($,ie)),ee.push(Y.__assign({name:le,type:se,domain:J.assembleDomain($,te)},ie?{domainRaw:ie}:{},{range:oe},re)),ee},[])}function q($,ee,te,ae){if("x"===ae||"y"===ae){if(K.isVgRangeStep($))return{step:{signal:ee+"_step"}};if(G.isArray($)&&2===$.length){var ne=$[0],ie=$[1];if(0===ne&&K.isVgSignalRef(ie))return[0,{signal:te.getSizeName(ie.signal)}];if(K.isVgSignalRef(ne)&&0===ie)return[{signal:te.getSizeName(ne.signal)},0]}}return $}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("tslib"),G=z("vega-util"),X=z("../../util"),K=z("../../vega.schema"),Q=z("../model"),Z=z("../selection/selection"),J=z("./domain");B.assembleScales=V,B.assembleScalesForModel=W,B.assembleScaleRange=q},{"../../util":114,"../../vega.schema":116,"../model":63,"../selection/selection":76,"./domain":69,tslib:5,"vega-util":7}],68:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=function(q){function Y(G,X){var K=q.call(this,{},{name:G})||this;return K.merged=!1,K.domains=[],K.setWithExplicit("type",X),K}return V.__extends(Y,q),Y}(z("../split").Split);B.ScaleComponent=W},{"../split":86,tslib:5}],69:[function(z,H,B){"use strict";function V(fe){me.isUnitModel(fe)?W(fe):q(fe)}function W(fe){var he=fe.specifiedScales,ye=fe.component.scales;re.keys(ye).forEach(function(_e){var Se=he[_e],be=Se?Se.domain:void 0,ve=G(fe,_e),xe=ye[_e];xe.domains=ve,le.isSelectionDomain(be)&&xe.set("domainRaw",{signal:ge.SELECTION_DOMAIN+JSON.stringify(be)},!0)})}function q(fe){for(var he=0,ye=fe.children;he<ye.length;he++)V(ye[he]);var _e=fe.component.scales;re.keys(_e).forEach(function(Se){for(var be,Ee,ve=0,xe=fe.children;ve<xe.length;ve++)Ee=xe[ve].component.scales[Se],Ee&&(be=void 0===be?Ee.domains:be.concat(Ee.domains));me.isFacetModel(fe)&&be.forEach(function(Ne){de.isDataRefDomain(Ne)&&(Ne.data=ue.FACET_SCALE_PREFIX+Ne.data.replace(ue.FACET_SCALE_PREFIX,""))}),_e[Se].domains=be})}function Y(fe,he,ye,_e){if("unaggregated"===fe){var Se=Q(he,ye),be=Se.valid,ve=Se.reason;if(!be)return void oe.warn(ve)}else if(void 0===fe&&_e.useUnaggregatedDomain&&(be=Q(he,ye).valid))return"unaggregated";return fe}function G(fe,he){var ye=fe.getScaleComponent(he).get("type"),_e=Y(fe.scaleDomain(he),fe.fieldDef(he),ye,fe.config.scale);return _e!==fe.scaleDomain(he)&&(fe.specifiedScales[he]=J.__assign({},fe.specifiedScales[he],{domain:_e})),"x"===he&&fe.channelHasField("x2")?fe.channelHasField("x")?X(ye,_e,fe,"x").concat(X(ye,_e,fe,"x2")):X(ye,_e,fe,"x2"):"y"===he&&fe.channelHasField("y2")?fe.channelHasField("y")?X(ye,_e,fe,"y").concat(X(ye,_e,fe,"y2")):X(ye,_e,fe,"y2"):X(ye,_e,fe,he)}function X(fe,he,ye,_e){var Se=ye.fieldDef(_e);if(he&&"unaggregated"!==he&&!le.isSelectionDomain(he)){if(!Se.bin)return ie.isDateTime(he[0])?he.map(function(Ne){return{signal:"{data: "+ie.dateTimeExpr(Ne,!0)+"}"}}):[he];oe.warn(oe.message.conflictedDomain(_e))}var be=ye.stack;if(be&&_e===be.fieldChannel)return"normalize"===be.offset?[[0,1]]:[{data:Ee=ye.requestDataName(ne.MAIN),field:ye.field(_e,{suffix:"start"})},{data:Ee,field:ye.field(_e,{suffix:"end"})}];var ve=ae.isScaleChannel(_e)?K(ye,_e,fe):void 0;if("unaggregated"===he)return[{data:Ee=ye.requestDataName(ne.MAIN),field:ye.field(_e,{aggregate:"min"})},{data:Ee,field:ye.field(_e,{aggregate:"max"})}];if(Se.bin){if(le.isBinScale(fe)){var xe=ye.getName(te.binToString(Se.bin)+"_"+Se.field+"_bins");return[{signal:"sequence("+xe+".start, "+xe+".stop + "+xe+".step, "+xe+".step)"}]}if(le.hasDiscreteDomain(fe))return[{data:re.isBoolean(ve)?ye.requestDataName(ne.MAIN):ye.requestDataName(ne.RAW),field:ye.field(_e,pe.binRequiresRange(Se,_e)?{binSuffix:"range"}:{}),sort:!0!==ve&&se.isSortField(ve)?ve:{field:ye.field(_e,{}),op:"min"}}];if("x"===_e||"y"===_e){var Ee=ye.requestDataName(ne.MAIN);return[{data:Ee,field:ye.field(_e,{})},{data:Ee,field:ye.field(_e,{binSuffix:"end"})}]}return[{data:ye.requestDataName(ne.MAIN),field:ye.field(_e,{})}]}return ve?[{data:re.isBoolean(ve)?ye.requestDataName(ne.MAIN):ye.requestDataName(ne.RAW),field:ye.field(_e),sort:ve}]:[{data:ye.requestDataName(ne.MAIN),field:ye.field(_e)}]}function K(fe,he,ye){if(le.hasDiscreteDomain(ye)){var _e=fe.sort(he);return se.isSortField(_e)?_e:"descending"===_e?{op:"min",field:fe.field(he),order:"descending"}:!!re.contains(["ascending",void 0],_e)||void 0}}function Q(fe,he){return fe.aggregate?ee.SHARED_DOMAIN_OP_INDEX[fe.aggregate]?"quantitative"===fe.type&&"log"===he?{valid:!1,reason:oe.message.unaggregatedDomainWithLogScale(fe)}:{valid:!0}:{valid:!1,reason:oe.message.unaggregateDomainWithNonSharedDomainOp(fe.aggregate)}:{valid:!1,reason:oe.message.unaggregateDomainHasNoEffectForRawField(fe)}}function Z(fe){var he=re.unique(fe.map(function(Ne){return de.isDataRefDomain(Ne)?(Ne.sort,J.__rest(Ne,["sort"])):Ne}),re.hash),ye=re.unique(fe.map(function(Ne){if(de.isDataRefDomain(Ne)){var Te=Ne.sort;return void 0===Te||re.isBoolean(Te)||("count"===Te.op&&delete Te.field,"ascending"===Te.order&&delete Te.order),Te}}).filter(function(Ne){return void 0!==Ne}),re.hash);if(1===he.length){var _e=fe[0];if(de.isDataRefDomain(_e)&&0<ye.length){var Se=ye[0];return 1<ye.length&&(oe.warn(oe.message.MORE_THAN_ONE_SORT),Se=!0),J.__assign({},_e,{sort:Se})}return _e}var be=ye.filter(function(Ne){return!!re.isBoolean(Ne)||"count"===Ne.op||(oe.warn(oe.message.domainSortDropped(Ne)),!1)}),ve=!0;if(1===be.length)ve=be[0];else if(1<be.length){var xe=be.filter(function(Ne){return!1!==Ne});1<xe.length?(oe.warn(oe.message.MORE_THAN_ONE_SORT),ve=!0):ve=xe[0]}var Ee=re.unique(fe.map(function(Ne){return de.isDataRefDomain(Ne)?Ne.data:null}),function(Ne){return Ne});return 1===Ee.length&&null!==Ee[0]?_e={data:Ee[0],fields:he.map(function(Ne){return Ne.field}),sort:ve}:{fields:he,sort:ve}}Object.defineProperty(B,"__esModule",{value:!0});var J=z("tslib"),$=z("vega-util"),ee=z("../../aggregate"),te=z("../../bin"),ae=z("../../channel"),ne=z("../../data"),ie=z("../../datetime"),oe=z("../../log"),le=z("../../scale"),se=z("../../sort"),re=z("../../util"),de=z("../../vega.schema"),ce=z("../../vega.schema"),pe=z("../common"),ue=z("../data/optimize"),me=z("../model"),ge=z("../selection/selection");B.parseScaleDomain=V,B.parseDomainForChannel=G,B.domainSort=K,B.canUseUnaggregatedDomain=Q,B.mergeDomains=Z,B.getFieldFromDomain=function(fe){if(de.isDataRefDomain(fe)&&$.isString(fe.field))return fe.field;if(ce.isDataRefUnionedDomain(fe)){for(var Se,he=void 0,ye=0,_e=fe.fields;ye<_e.length;ye++)if(Se=_e[ye],de.isDataRefDomain(Se)&&$.isString(Se.field))if(!he)he=Se.field;else if(he!==Se.field)return oe.warn("Detected faceted independent scales that union domain of multiple fields from different data sources.  We will use the first field.  The result view size may be incorrect."),he;return oe.warn("Detected faceted independent scales that union domain of identical fields from different source detected.  We will assume that this is the same field from a different fork of the same data source.  However, if this is not case, the result view size maybe incorrect."),he}return ce.isFieldRefUnionDomain(fe)&&$.isString?(oe.warn("Detected faceted independent scales that union domain of multiple fields from the same data source.  We will use the first field.  The result view size may be incorrect."),he=fe.fields[0],$.isString(he)?he:void 0):void 0},B.assembleDomain=function(fe,he){return Z(fe.component.scales[he].domains.map(function(ye){return de.isDataRefDomain(ye)&&(ye.data=fe.lookupDataSource(ye.data)),ye}))}},{"../../aggregate":9,"../../bin":11,"../../channel":12,"../../data":92,"../../datetime":93,"../../log":101,"../../scale":104,"../../sort":106,"../../util":114,"../../vega.schema":116,"../common":20,"../data/optimize":35,"../model":63,"../selection/selection":76,tslib:5,"vega-util":7}],70:[function(z,H,B){"use strict";function V(oe){oe.component.scales=Q.isUnitModel(oe)?W(oe):q(oe)}function W(oe){var le=oe.encoding,se=oe.config,re=oe.mark();return Y.SCALE_CHANNELS.reduce(function(de,ce){var pe,ue={},me=le[ce];if(G.isFieldDef(me)?(pe=me,ue=me.scale||{}):G.isConditionalDef(me)&&G.isFieldDef(me.condition)?(pe=me.condition,ue=me.condition.scale||{}):"x"===ce?pe=G.getFieldDef(le.x2):"y"===ce&&(pe=G.getFieldDef(le.y2)),pe){var ge=ue.type,fe=ne.scaleType(ue.type,ce,pe,re,se.scale);de[ce]=new $.ScaleComponent(oe.scaleName(ce+"",!0),{value:fe,explicit:ge===fe})}return de},{})}function q(oe){for(var le=oe.component.scales={},se={},re=oe.component.resolve,de=0,ce=oe.children;de<ce.length;de++)!function(pe){V(pe),K.keys(pe.component.scales).forEach(function(ue){if(re.scale[ue]=re.scale[ue]||Z.defaultScaleResolve(ue,oe),"shared"===re.scale[ue]){var me=se[ue],ge=pe.component.scales[ue].getWithExplicit("type");me?X.scaleCompatible(me.value,ge.value)?se[ue]=J.mergeValuesWithExplicit(me,ge,"type","scale",ie):(re.scale[ue]="independent",delete se[ue]):se[ue]=ge}})}(ce[de]);return K.keys(se).forEach(function(pe){var ue=oe.scaleName(pe,!0),me=se[pe];le[pe]=new $.ScaleComponent(ue,me);for(var ge=0,fe=oe.children;ge<fe.length;ge++){var he=fe[ge],ye=he.component.scales[pe];ye&&(he.renameScale(ye.get("name"),ue),ye.merged=!0)}}),le}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("../../channel"),G=z("../../fielddef"),X=z("../../scale"),K=z("../../util"),Q=z("../model"),Z=z("../resolve"),J=z("../split"),$=z("./component"),ee=z("./domain"),te=z("./properties"),ae=z("./range"),ne=z("./type");B.parseScale=function(oe){V(oe),ee.parseScaleDomain(oe);for(var re,le=0,se=X.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES;le<se.length;le++)re=se[le],te.parseScaleProperty(oe,re);ae.parseScaleRange(oe)},B.parseScaleCore=V;var ie=J.tieBreakByComparing(function(oe,le){return X.scaleTypePrecedence(oe)-X.scaleTypePrecedence(le)})},{"../../channel":12,"../../fielddef":96,"../../scale":104,"../../util":114,"../model":63,"../resolve":66,"../split":86,"./component":68,"./domain":69,"./properties":71,"./range":72,"./type":73}],71:[function(z,H,B){"use strict";function V(re,de){oe.isUnitModel(re)?W(re,de):Y(re,de)}function W(re,de){var ce=re.component.scales;ie.keys(ce).forEach(function(pe){var ue=re.specifiedScales[pe],me=ce[pe],ge=re.getScaleComponent(pe),fe=re.fieldDef(pe),he=re.sort(pe),ye=re.config,_e=ue[de],Se=ge.get("type"),be=te.scaleTypeSupportProperty(Se,de),ve=te.channelScalePropertyIncompatability(pe,de);if(void 0!==_e&&(be?ve&&ee.warn(ve):ee.warn(ee.message.scalePropertyNotWorkWithScaleType(Se,de,pe))),be&&void 0===ve)if(void 0!==_e)me.copyKeyFromObject(de,ue);else{var xe=q(de,pe,fe,he,ge.get("type"),ge.get("padding"),ge.get("paddingInner"),ue.domain,ye.scale);void 0!==xe&&me.set(de,xe,!1)}})}function q(re,de,ce,pe,ue,me,ge,fe,he){return"nice"===re?G(ue,de,ce):"padding"===re?X(de,ue,he):"paddingInner"===re?K(me,de,he):"paddingOuter"===re?Q(me,de,ue,ge,he):"reverse"===re?Z(ue,pe):"zero"===re?J(de,ce,fe):he[re]}function Y(re,de){for(var me,ce=re.component.scales,pe=0,ue=re.children;pe<ue.length;pe++)me=ue[pe],"range"===de?se.parseScaleRange(me):V(me,de);ie.keys(ce).forEach(function(ge){for(var fe,_e,he=0,ye=re.children;he<ye.length;he++)if(_e=ye[he].component.scales[ge],_e){var Se=_e.getWithExplicit(de);fe=le.mergeValuesWithExplicit(fe,Se,de,"scale",le.tieBreakByComparing(function(be,ve){return"range"===de?be.step&&ve.step?be.step-ve.step:0:0}))}ce[ge].setWithExplicit(de,fe)})}function G(re,de,ce){return ne.contains([te.ScaleType.TIME,te.ScaleType.UTC],re)?ae.smallestUnit(ce.timeUnit):ce.bin?void 0:ne.contains([$.X,$.Y],de)}function X(re,de,ce){if(ne.contains([$.X,$.Y],re)&&de===te.ScaleType.POINT)return ce.pointPadding}function K(re,de,ce){if(void 0===re)return ne.contains([$.X,$.Y],de)?ce.bandPaddingInner:void 0}function Q(re,de,ce,pe,ue){if(void 0===re)return ne.contains([$.X,$.Y],de)&&ce===te.ScaleType.BAND?void 0===ue.bandPaddingOuter?pe/2:ue.bandPaddingOuter:void 0}function Z(re,de){if(te.hasContinuousDomain(re)&&"descending"===de)return!0}function J(re,de,ce){return"size"===re&&"quantitative"===de.type||(!ce||"unaggregated"===ce)&&!de.bin&&ne.contains([$.X,$.Y],re)}Object.defineProperty(B,"__esModule",{value:!0});var $=z("../../channel"),ee=z("../../log"),te=z("../../scale"),ae=z("../../timeunit"),ne=z("../../util"),ie=z("../../util"),oe=z("../model"),le=z("../split"),se=z("./range");B.parseScaleProperty=V,B.getDefaultValue=q,B.parseNonUnitScaleProperty=Y,B.nice=G,B.padding=X,B.paddingInner=K,B.paddingOuter=Q,B.reverse=Z,B.zero=J},{"../../channel":12,"../../log":101,"../../scale":104,"../../timeunit":109,"../../util":114,"../model":63,"../split":86,"./range":72}],72:[function(z,H,B){"use strict";function V(le){var se=le.component.scales;J.SCALE_CHANNELS.forEach(function(re){var de=se[re];if(de){var ce=le.getScaleComponent(re),pe=le.specifiedScales[re],ue=le.fieldDef(re),me="x"===re?"width":"y"===re?"height":void 0,ge=me?le.component.layoutSize.get(me):void 0,fe=W(le),he=q(re,ce.get("type"),ue.type,pe,le.config,de.get("zero"),le.mark(),ge,le.getName(me),fe);de.setWithExplicit("range",he)}})}function W(le){var se=[],re=le.getScaleComponent("x"),de=re&&re.get("range");de&&ae.isVgRangeStep(de)&&Z.isNumber(de.step)&&se.push(de.step);var ce=le.getScaleComponent("y"),pe=ce&&ce.get("range");return pe&&ae.isVgRangeStep(pe)&&Z.isNumber(pe.step)&&se.push(pe.step),se}function q(le,se,re,de,ce,pe,ue,me,ge,fe){for(var Se,he=!!me||null===de.rangeStep,ye=0,_e=B.RANGE_PROPERTIES;ye<_e.length;ye++)if(Se=_e[ye],void 0!==de[Se]){var be=ee.scaleTypeSupportProperty(se,Se),ve=ee.channelScalePropertyIncompatability(le,Se);if(!be)$.warn($.message.scalePropertyNotWorkWithScaleType(se,Se,le));else if(ve)$.warn(ve);else switch(Se){case"range":return ie.makeImplicit(de[Se]);case"scheme":return ie.makeImplicit(Y(de[Se]));case"rangeStep":var xe=de[Se];if(null!==xe){if(void 0===me)return ie.makeImplicit({step:xe});$.warn($.message.rangeStepDropped(le))}}}return{explicit:!1,value:G(le,se,re,ce,pe,ue,ge,fe,he)}}function Y(le){if(ee.isExtendedScheme(le)){var se={scheme:le.name};return le.count&&(se.count=le.count),le.extent&&(se.extent=le.extent),se}return{scheme:le}}function G(le,se,re,de,ce,pe,ue,me,ge){switch(le){case J.X:case J.Y:if(te.contains(["point","band"],se)&&!ge)if(le===J.X&&"text"===pe){if(de.scale.textXRangeStep)return{step:de.scale.textXRangeStep};}else if(de.scale.rangeStep)return{step:de.scale.rangeStep};return le===J.X?[0,{signal:ue}]:[{signal:ue},0];case J.SIZE:return[X(pe,ce,de),K(pe,me,de)];case J.SHAPE:return"symbol";case J.COLOR:return"ordinal"===se?"nominal"===re?"category":"ordinal":"rect"===pe?"heatmap":"ramp";case J.OPACITY:return[de.scale.minOpacity,de.scale.maxOpacity];}throw new Error("Scale range undefined for channel "+le)}function X(le,se,re){if(se)return 0;switch(le){case"bar":case"tick":return re.scale.minBandSize;case"line":case"rule":return re.scale.minStrokeWidth;case"text":return re.scale.minFontSize;case"point":case"square":case"circle":return re.scale.minSize;}throw new Error($.message.incompatibleChannel("size",le))}function K(le,se,re){var de=re.scale;switch(le){case"bar":case"tick":return void 0===re.scale.maxBandSize?Q(se,re.scale)-1:re.scale.maxBandSize;case"line":case"rule":return re.scale.maxStrokeWidth;case"text":return re.scale.maxFontSize;case"point":case"square":case"circle":if(re.scale.maxSize)return re.scale.maxSize;var ce=Q(se,de);return(ce-2)*(ce-2);}throw new Error($.message.incompatibleChannel("size",le))}function Q(le,se){return 0<le.length?Math.min.apply(null,le):se.rangeStep?se.rangeStep:21}Object.defineProperty(B,"__esModule",{value:!0});var Z=z("vega-util"),J=z("../../channel"),$=z("../../log"),ee=z("../../scale"),te=z("../../util"),ae=z("../../vega.schema"),ne=z("../model"),ie=z("../split"),oe=z("./properties");B.RANGE_PROPERTIES=["range","rangeStep","scheme"],B.parseScaleRange=function(le){ne.isUnitModel(le)?V(le):oe.parseNonUnitScaleProperty(le,"range")},B.parseRangeForChannel=q,B.defaultRange=G},{"../../channel":12,"../../log":101,"../../scale":104,"../../util":114,"../../vega.schema":116,"../model":63,"../split":86,"./properties":71,"vega-util":7}],73:[function(z,H,B){"use strict";function V(J,$,ee){switch($.type){case"nominal":case"ordinal":if("color"===J||"discrete"===q.rangeType(J))return"shape"===J&&"ordinal"===$.type&&Y.warn(Y.message.discreteChannelCannotEncode(J,"ordinal")),"ordinal";if(Q.contains(["x","y"],J)){if("rect"===ee)return"band";if("bar"===ee)return"band"}return"point";case"temporal":return"color"===J?"sequential":"discrete"===q.rangeType(J)?(Y.warn(Y.message.discreteChannelCannotEncode(J,"temporal")),"ordinal"):"time";case"quantitative":return"color"===J?$.bin?"bin-ordinal":"sequential":"discrete"===q.rangeType(J)?(Y.warn(Y.message.discreteChannelCannotEncode(J,"quantitative")),"ordinal"):$.bin&&"x"!==J&&"y"!==J?"bin-linear":"linear";}throw new Error(Y.message.invalidFieldType($.type))}function W(J,$){var ee=$.type;return Z.contains([K.Type.ORDINAL,K.Type.NOMINAL],ee)?void 0===J||X.hasDiscreteDomain(J):ee===K.Type.TEMPORAL?Z.contains([G.ScaleType.TIME,G.ScaleType.UTC,G.ScaleType.SEQUENTIAL,void 0],J):ee!==K.Type.QUANTITATIVE||($.bin?Z.contains([G.ScaleType.BIN_LINEAR,G.ScaleType.BIN_ORDINAL,G.ScaleType.LINEAR],J):Z.contains([G.ScaleType.LOG,G.ScaleType.POW,G.ScaleType.SQRT,G.ScaleType.QUANTILE,G.ScaleType.QUANTIZE,G.ScaleType.LINEAR,G.ScaleType.SEQUENTIAL,void 0],J))}Object.defineProperty(B,"__esModule",{value:!0});var q=z("../../channel"),Y=z("../../log"),G=z("../../scale"),X=z("../../scale"),K=z("../../type"),Q=z("../../util"),Z=z("../../util");B.scaleType=function(J,$,ee,te){var ne=V($,ee,te);return q.isScaleChannel($)?void 0===J?ne:G.channelSupportScaleType($,J)?W(J,ee)?J:(Y.warn(Y.message.scaleTypeNotWorkWithFieldDef(J,ne)),ne):(Y.warn(Y.message.scaleTypeNotWorkWithChannel($,J,ne)),ne):null},B.fieldDefMatchScaleType=W},{"../../channel":12,"../../log":101,"../../scale":104,"../../type":113,"../../util":114}],74:[function(z,H,B){"use strict";function V($,ee,te){var ae=Q.channelSignalName(ee,te,"visual"),ne=Q.channelSignalName(ee,te,"data"),ie=Z.default.has(ee),oe=$.scaleName(te),le=K.stringValue(oe),se=$.getScaleComponent(te),re=se?se.get("type"):void 0,de=$.getSizeSignalRef(te===Y.X?"width":"height").signal,ce=te+"(unit)",pe=W(ee,function(ue,me){return ue.concat({events:me.between[0],update:"["+ce+", "+ce+"]"},{events:me,update:"["+ae+"[0], clamp("+ce+", 0, "+de+")]"})});return pe.push({events:{signal:ee.name+B.SCALE_TRIGGER},update:X.hasContinuousDomain(re)&&!X.isBinScale(re)?"[scale("+le+", "+ne+"[0]), scale("+le+", "+ne+"[1])]":"[0, 0]"}),ie?[{name:ne,on:[]}]:[{name:ae,value:[],on:pe},{name:ne,on:[{events:{signal:ae},update:ae+"[0] === "+ae+"[1] ? null : invert("+le+", "+ae+")"}]}]}function W($,ee){return $.events.reduce(function(te,ae){return ae.between?ee(te,ae):(G.warn(ae+" is not an ordered event stream for interval selections"),te)},[])}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("../../channel"),G=z("../../log"),X=z("../../scale"),K=z("../../util"),Q=z("./selection"),Z=z("./transforms/scales");B.BRUSH="_brush",B.SCALE_TRIGGER="_scale_trigger";B.default={predicate:"vlInterval",scaleDomain:"vlIntervalDomain",signals:function(ee,te){var ae=te.name,ne=Z.default.has(te),ie=[],oe=[],le=[],se=[];if(te.translate&&!ne){var re="!event.item || event.item.mark.name !== "+K.stringValue(ae+B.BRUSH);W(te,function(de,ce){var pe=ce.between[0].filter||(ce.between[0].filter=[]);0>pe.indexOf(re)&&pe.push(re)})}return te.project.forEach(function(de){var ce=de.channel;if(ce===Y.X||ce===Y.Y){var pe=V(ee,te,ce),ue=Q.channelSignalName(te,ce,"data"),me=Q.channelSignalName(te,ce,"visual"),ge=K.stringValue(ee.scaleName(ce)),fe=ee.getScaleComponent(ce).get("type"),he=X.hasContinuousDomain(fe)?"+":"";ie.push.apply(ie,pe),le.push(ue),oe.push("{encoding: "+K.stringValue(ce)+", field: "+K.stringValue(de.field)+", extent: "+ue+"}"),se.push({scaleName:ee.scaleName(ce),expr:"(!isArray("+ue+") || ("+he+"invert("+ge+", "+me+")[0] === "+he+ue+"[0] && "+he+"invert("+ge+", "+me+")[1] === "+he+ue+"[1]))"})}else G.warn("Interval selections only support x and y encoding channels.")}),ne||ie.push({name:ae+B.SCALE_TRIGGER,update:se.map(function(de){return de.expr}).join(" && ")+" ? "+(ae+B.SCALE_TRIGGER)+" : {}"}),ie.concat({name:ae+Q.TUPLE,on:[{events:le.map(function(de){return{signal:de}}),update:le.join(" && ")+" ? {unit: "+Q.unitName(ee)+", intervals: ["+oe.join(", ")+"]} : null"}]})},modifyExpr:function(ee,te){return te.name+Q.TUPLE+", "+("global"===te.resolve?"true":"{unit: "+Q.unitName(ee)+"}")},marks:function(ee,te,ae){var ne=te.name,ie=Q.spatialProjections(te),oe=ie.xi,le=ie.yi,se="data("+K.stringValue(te.name+Q.STORE)+")";if(Z.default.has(te))return ae;var re={x:null===oe?{value:0}:{signal:ne+"_x[0]"},y:null===le?{value:0}:{signal:ne+"_y[0]"},x2:null===oe?{field:{group:"width"}}:{signal:ne+"_x[1]"},y2:null===le?{field:{group:"height"}}:{signal:ne+"_y[1]"}};"global"===te.resolve&&K.keys(re).forEach(function(ge){re[ge]=[q.__assign({test:se+".length && "+se+"[0].unit === "+Q.unitName(ee)},re[ge]),{value:0}]});var de=te.mark,ce=de.fill,pe=de.fillOpacity,ue=q.__rest(de,["fill","fillOpacity"]),me=K.keys(ue).reduce(function(ge,fe){return ge[fe]={value:ue[fe]},ge},{});return[{name:ne+B.BRUSH+"_bg",type:"rect",clip:!0,encode:{enter:{fill:{value:ce},fillOpacity:{value:pe}},update:re}}].concat(ae,{name:ne+B.BRUSH,type:"rect",clip:!0,encode:{enter:q.__assign({fill:{value:"transparent"}},me),update:re}})}}},{"../../channel":12,"../../log":101,"../../scale":104,"../../util":114,"./selection":76,"./transforms/scales":81,tslib:5}],75:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../util"),W=z("./selection"),q=z("./transforms/nearest");B.default={predicate:"vlMulti",scaleDomain:"vlMultiDomain",signals:function(X,K){var Q=K.project,Z=q.default.has(K)?"(item().isVoronoi ? datum.datum : datum)":"datum",J=[],$=Q.map(function(ae){return V.stringValue(ae.channel)}).filter(function(ae){return ae}).join(", "),ee=Q.map(function(ae){return V.stringValue(ae.field)}).join(", "),te=Q.map(function(ae){var ne=ae.channel,ie=X.fieldDef(ne);return ie&&ie.bin?(J.push(ae.field),"["+Z+"["+V.stringValue(X.field(ne,{}))+"], "+Z+"["+V.stringValue(X.field(ne,{binSuffix:"end"}))+"]]"):Z+"["+V.stringValue(ae.field)+"]"}).join(", ");return[{name:K.name+W.TUPLE,value:{},on:[{events:K.events,update:"datum && item().mark.marktype !== 'group' ? {unit: "+W.unitName(X)+", encodings: ["+$+"], fields: ["+ee+"], values: ["+te+"]"+(J.length?", "+J.map(function(ae){return V.stringValue("bin_"+ae)+": 1"}).join(", "):"")+"} : null",force:!0}]}]},modifyExpr:function(X,K){return K.name+W.TUPLE+", "+("global"===K.resolve?"null":"{unit: "+W.unitName(X)+"}")}}},{"../../util":114,"./selection":76,"./transforms/nearest":79}],76:[function(z,H,B){"use strict";function V(ie,oe){var le=oe;return W(ie,function(se,re){le=re.marks?re.marks(ie,se,le):le,ne.forEachTransform(se,function(de){de.marks&&(le=de.marks(ie,se,oe,le))})}),le}function W(ie,oe){var le=ie.component.selection;for(var se in le)if(le.hasOwnProperty(se)){var re=le[se];oe(re,q(re.type))}}function q(ie){return"single"===ie?ae.default:"multi"===ie?te.default:"interval"===ie?ee.default:null}function Y(ie){for(var oe=ie.parent;oe&&!$.isFacetModel(oe);)oe=oe.parent;return oe}Object.defineProperty(B,"__esModule",{value:!0});var G=z("tslib"),X=z("vega-event-selector"),K=z("../../channel"),Q=z("../../log"),Z=z("../../selection"),J=z("../../util"),$=z("../model"),ee=z("./interval"),te=z("./multi"),ae=z("./single"),ne=z("./transforms/transforms");B.STORE="_store",B.TUPLE="_tuple",B.MODIFY="_modify",B.SELECTION_DOMAIN="_selection_domain_",B.parseUnitSelection=function(ie,oe){var le={},se=ie.config.selection;for(var re in oe)!function(de){if(!oe.hasOwnProperty(de))return"continue";var ce=oe[de],pe=se[ce.type];for(var ue in pe)"encodings"===ue&&ce.fields||"fields"===ue&&ce.encodings||("mark"===ue&&(ce[ue]=G.__assign({},pe[ue],ce[ue])),void 0!==ce[ue]&&!0!==ce[ue]||(ce[ue]=pe[ue]||ce[ue]));de=J.varName(de);var me=le[de]=G.__assign({},ce,{name:de,events:J.isString(ce.on)?X.selector(ce.on,"scope"):ce.on});ne.forEachTransform(me,function(ge){ge.parse&&ge.parse(ie,ce,me)})}(re);return le},B.assembleUnitSelectionSignals=function(ie,oe){W(ie,function(re,de){var ce=re.name,pe=de.modifyExpr(ie,re);oe.push.apply(oe,de.signals(ie,re)),ne.forEachTransform(re,function(ue){ue.signals&&(oe=ue.signals(ie,re,oe)),ue.modifyExpr&&(pe=ue.modifyExpr(ie,re,pe))}),oe.push({name:ce+B.MODIFY,on:[{events:{signal:ce+B.TUPLE},update:"modify("+J.stringValue(re.name+B.STORE)+", "+pe+")"}]})});var le=Y(ie);if(oe.length&&le){var se=J.stringValue(le.getName("cell"));oe.unshift({name:"facet",value:{},on:[{events:X.selector("mousemove","scope"),update:"isTuple(facet) ? facet : group("+se+").datum"}]})}return oe},B.assembleTopLevelSignals=function(ie,oe){var le=!1;return W(ie,function(se,re){re.topLevelSignals&&(oe=re.topLevelSignals(ie,se,oe)),ne.forEachTransform(se,function(de){de.topLevelSignals&&(oe=de.topLevelSignals(ie,se,oe))}),le=!0}),le&&(oe.filter(function(se){return"unit"===se.name}).length||oe.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})),oe},B.assembleUnitSelectionData=function(ie,oe){return W(ie,function(le){oe.filter(function(se){return se.name===le.name+B.STORE}).length||oe.push({name:le.name+B.STORE})}),oe},B.assembleUnitSelectionMarks=V,B.assembleLayerSelectionMarks=function(ie,oe){return ie.children.forEach(function(le){$.isUnitModel(le)&&(oe=V(le,oe))}),oe},B.predicate=function(ie,oe,le){var se=[],re=J.logicalExpr(oe,function(de){var ce=J.varName(de),pe=ie.getSelectionComponent(ce,de),ue=J.stringValue(ce+B.STORE);if(pe.timeUnit){var me=le||ie.component.data.raw,ge=pe.timeUnit.clone();me.parent?ge.insertAsParentOf(me):me.parent=ge}return se.push(ue),q(pe.type).predicate+"("+ue+", datum"+("global"===pe.resolve?")":", "+J.stringValue(pe.resolve)+")")});return"!("+se.map(function(de){return"length(data("+de+"))"}).join(" || ")+") || ("+re+")"},B.isRawSelectionDomain=function(ie){return 0<=ie.signal.indexOf(B.SELECTION_DOMAIN)},B.selectionScaleDomain=function(ie,oe){var le=JSON.parse(oe.signal.replace(B.SELECTION_DOMAIN,"")),se=J.varName(le.selection),re=ie.component.selection&&ie.component.selection[se];return re?(Q.warn("Use \"bind\": \"scales\" to setup a binding for scales and selections within the same view."),{signal:"null"}):(re=ie.getSelectionComponent(se,le.selection),le.encoding||le.field||(le.field=re.project[0].field,1<re.project.length&&Q.warn("A \"field\" or \"encoding\" must be specified when using a selection as a scale domain. Using \"field\": "+J.stringValue(le.field)+".")),{signal:q(re.type).scaleDomain+"("+J.stringValue(se+B.STORE)+", "+J.stringValue(le.encoding||null)+", "+J.stringValue(le.field||null)+("global"===re.resolve?")":", "+J.stringValue(re.resolve)+")")})},B.unitName=function(ie){var oe=J.stringValue(ie.name),le=Y(ie);return le&&(oe+=(le.facet.row?" + '_' + facet["+J.stringValue(le.field("row"))+"]":"")+(le.facet.column?" + '_' + facet["+J.stringValue(le.field("column"))+"]":"")),oe},B.requiresSelectionId=function(ie){var oe=!1;return W(ie,function(le){oe=oe||le.project.some(function(se){return se.field===Z.SELECTION_ID})}),oe},B.channelSignalName=function(ie,oe,le){return J.varName(ie.name+"_"+("visual"===le?oe:ie.fields[oe]))},B.spatialProjections=function(ie){var oe=null,le=null,se=null,re=null;return ie.project.forEach(function(de,ce){de.channel===K.X?(oe=de,le=ce):de.channel===K.Y&&(se=de,re=ce)}),{x:oe,xi:le,y:se,yi:re}}},{"../../channel":12,"../../log":101,"../../selection":105,"../../util":114,"../model":63,"./interval":74,"./multi":75,"./single":77,"./transforms/transforms":83,tslib:5,"vega-event-selector":6}],77:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../util"),W=z("./multi"),q=z("./selection"),Y={predicate:"vlSingle",scaleDomain:"vlSingleDomain",signals:W.default.signals,topLevelSignals:function(X,K,Q){var Z=Q.filter(function(ee){return ee.name===K.name}),J="data("+V.stringValue(K.name+q.STORE)+")";return Z.length?Q:Q.concat({name:K.name,update:J+".length && {"+K.project.map(function(ee,te){return ee.field+": "+(J+"[0].values")+"["+te+"]"}).join(", ")+"}"})},modifyExpr:function(X,K){return K.name+q.TUPLE+", "+("global"===K.resolve?"true":"{unit: "+q.unitName(X)+"}")}};B.default=Y},{"../../util":114,"./multi":75,"./selection":76}],78:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../../util"),W=z("../selection"),q=z("./nearest");B.default={has:function(X){return"single"===X.type&&"global"===X.resolve&&X.bind&&"scales"!==X.bind},topLevelSignals:function(X,K,Q){var Z=K.name,J=K.project,$=K.bind,ee=q.default.has(K)?"(item().isVoronoi ? datum.datum : datum)":"datum";return J.forEach(function(te){var ae=V.varName(Z+"_"+te.field);Q.filter(function(ne){return ne.name===ae}).length||Q.unshift({name:ae,value:"",on:[{events:K.events,update:"datum && item().mark.marktype !== 'group' ? "+ee+"["+V.stringValue(te.field)+"] : null"}],bind:$[te.field]||$[te.channel]||$})}),Q},signals:function(X,K,Q){var Z=K.name,J=K.project,$=Q.filter(function(ae){return ae.name===Z+W.TUPLE})[0],ee=J.map(function(ae){return V.stringValue(ae.field)}).join(", "),te=J.map(function(ae){return V.varName(Z+"_"+ae.field)});return $.update=te.join(" && ")+" ? {fields: ["+ee+"], values: ["+te.join(", ")+"]} : null",delete $.value,delete $.on,Q}}},{"../../../util":114,"../selection":76,"./nearest":79}],79:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../selection");B.default={has:function(Y){return"interval"!==Y.type&&Y.nearest},marks:function(Y,G,X,K){var Q=V.spatialProjections(G),Z=Q.x,J=Q.y,$=X[0],ee=K.indexOf($),te=$.name===Y.getName("pathgroup"),ae=function(oe){return oe.name&&0<=oe.name.indexOf("voronoi")},ne={name:Y.getName("voronoi"),type:"path",from:{data:Y.getName("marks")},encode:{enter:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0}}},transform:[{type:"voronoi",x:!Z&&(Z||J)?{expr:"0"}:"datum.x",y:!J&&(Z||J)?{expr:"0"}:"datum.y",size:[Y.getSizeSignalRef("width"),Y.getSizeSignalRef("height")]}]};return te&&!$.marks.filter(ae).length?($.marks.push(ne),K.splice(ee,1,$)):te||K.filter(ae).length||K.splice(ee+1,0,ne),K}}},{"../selection":76}],80:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../../log"),W=z("../../../util"),q=z("../../data/timeunit");B.default={has:function(X){return void 0!==X.fields||void 0!==X.encodings},parse:function(X,K,Q){var Z={},J={};(K.fields||[]).forEach(function(ae){return Z[ae]=null}),(K.encodings||[]).forEach(function(ae){var ne=X.fieldDef(ae);if(!ne)V.warn(V.message.cannotProjectOnChannelWithoutField(ae));else if(ne.timeUnit){var ie=X.field(ae);Z[ie]=ae,J[ie]={as:ie,field:ne.field,timeUnit:ne.timeUnit}}else Z[ne.field]=ae});var $=Q.project||(Q.project=[]);for(var ee in Z)Z.hasOwnProperty(ee)&&$.push({field:ee,channel:Z[ee]});var te=Q.fields||(Q.fields={});$.filter(function(ae){return ae.channel}).forEach(function(ae){return te[ae.channel]=ae.field}),W.keys(J).length&&(Q.timeUnit=new q.TimeUnitNode(J))}}},{"../../../log":101,"../../../util":114,"../../data/timeunit":40}],81:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../../../log"),W=z("../../../scale"),q=z("../../../util"),Y=z("../selection");B.default={has:function(K){return"interval"===K.type&&"global"===K.resolve&&K.bind&&"scales"===K.bind},parse:function(K,Q,Z){var J=Z.scales=[];Z.project.forEach(function($){var ee=$.channel,te=K.getScaleComponent(ee),ae=te?te.get("type"):void 0;te&&W.hasContinuousDomain(ae)&&!W.isBinScale(ae)?(te.set("domainRaw",{signal:Y.channelSignalName(Z,ee,"data")},!0),J.push(ee)):V.warn("Scale bindings are currently only supported for scales with unbinned, continuous domains.")})},topLevelSignals:function(K,Q,Z){if(!K.parent)return Z;var J=Q.scales.filter(function($){return!Z.filter(function(ee){return ee.name===Y.channelSignalName(Q,$,"data")}).length});return Z.concat(J.map(function($){return{name:Y.channelSignalName(Q,$,"data")}}))},signals:function(K,Q,Z){return K.parent&&Q.scales.forEach(function(J){var $=Z.filter(function(ee){return ee.name===Y.channelSignalName(Q,J,"data")})[0];$.push="outer",delete $.value,delete $.update}),Z}},B.domain=function(X,K){return"domain("+q.stringValue(X.scaleName(K))+")"}},{"../../../log":101,"../../../scale":104,"../../../util":114,"../selection":76}],82:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("../selection");B.default={has:function(Y){return"multi"===Y.type&&Y.toggle},signals:function(Y,G,X){return X.concat({name:G.name+"_toggle",value:!1,on:[{events:G.events,update:G.toggle}]})},modifyExpr:function(Y,G){var K=G.name+V.TUPLE,Q=G.name+"_toggle";return Q+" ? null : "+K+", "+("global"===G.resolve?Q+" ? null : true, ":Q+" ? null : {unit: "+V.unitName(Y)+"}, ")+Q+" ? "+K+" : null"}}},{"../selection":76}],83:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./inputs"),W=z("./nearest"),q=z("./project"),Y=z("./scales"),G=z("./toggle"),X=z("./translate"),K=z("./zoom"),Q={project:q.default,toggle:G.default,scales:Y.default,translate:X.default,zoom:K.default,inputs:V.default,nearest:W.default};B.forEachTransform=function(Z,J){for(var $ in Q)Q[$].has(Z)&&J(Q[$])}},{"./inputs":78,"./nearest":79,"./project":80,"./scales":81,"./toggle":82,"./translate":84,"./zoom":85}],84:[function(z,H,B){"use strict";function V(J,$,ee,te,ae){var ne=$.name,ie=X.default.has($),oe=ae.filter(function(fe){return fe.name===G.channelSignalName($,ee,ie?"data":"visual")})[0],se=ne+Q,re=J.getSizeSignalRef(te).signal,de=J.getScaleComponent(ee),ce=de.get("type"),pe=ie&&ee===q.X?"-":"",ue=ne+K+".extent_"+ee,me=""+pe+se+"."+ee+" / "+(ie?""+re:"span("+ue+")"),ge=(ie?"log"===ce?"panLog":"pow"===ce?"panPow":"panLinear":"panLinear")+"("+ue+", "+me+(ie&&"pow"===ce?", "+(de.get("exponent")||1):"")+")";oe.on.push({events:{signal:se},update:ie?ge:"clampRange("+ge+", 0, "+re+")"})}Object.defineProperty(B,"__esModule",{value:!0});var W=z("vega-event-selector"),q=z("../../../channel"),Y=z("../interval"),G=z("../selection"),X=z("./scales"),K="_translate_anchor",Q="_translate_delta";B.default={has:function($){return"interval"===$.type&&$.translate},signals:function($,ee,te){var ae=ee.name,ne=X.default.has(ee),ie=ae+K,oe=G.spatialProjections(ee),le=oe.x,se=oe.y,re=W.selector(ee.translate,"scope");return ne||(re=re.map(function(de){return de.between[0].markname=ae+Y.BRUSH,de})),te.push({name:ie,value:{},on:[{events:re.map(function(de){return de.between[0]}),update:"{x: x(unit), y: y(unit)"+(null===le?"":", extent_x: "+(ne?X.domain($,q.X):"slice("+G.channelSignalName(ee,"x","visual")+")"))+(null===se?"":", extent_y: "+(ne?X.domain($,q.Y):"slice("+G.channelSignalName(ee,"y","visual")+")"))+"}"}]},{name:ae+Q,value:{},on:[{events:re,update:"{x: "+ie+".x - x(unit), y: "+ie+".y - y(unit)}"}]}),null!==le&&V($,ee,q.X,"width",te),null!==se&&V($,ee,q.Y,"height",te),te}}},{"../../../channel":12,"../interval":74,"../selection":76,"./scales":81,"vega-event-selector":6}],85:[function(z,H,B){"use strict";function V($,ee,te,ae,ne){var ie=ee.name,oe=K.default.has(ee),le=ne.filter(function(ge){return ge.name===X.channelSignalName(ee,te,oe?"data":"visual")})[0],se=$.getSizeSignalRef(ae).signal,re=$.getScaleComponent(te),de=re.get("type"),ce=oe?K.domain($,te):le.name,pe=ie+Z,me=(oe?"log"===de?"zoomLog":"pow"===de?"zoomPow":"zoomLinear":"zoomLinear")+"("+ce+", "+(""+ie+Q+"."+te)+", "+pe+(oe&&"pow"===de?", "+(re.get("exponent")||1):"")+")";le.on.push({events:{signal:pe},update:oe?me:"clampRange("+me+", 0, "+se+")"})}Object.defineProperty(B,"__esModule",{value:!0});var W=z("vega-event-selector"),q=z("../../../channel"),Y=z("../../../util"),G=z("../interval"),X=z("../selection"),K=z("./scales"),Q="_zoom_anchor",Z="_zoom_delta";B.default={has:function(ee){return"interval"===ee.type&&ee.zoom},signals:function(ee,te,ae){var ne=te.name,ie=K.default.has(te),le=X.spatialProjections(te),se=le.x,re=le.y,de=Y.stringValue(ee.scaleName(q.X)),ce=Y.stringValue(ee.scaleName(q.Y)),pe=W.selector(te.zoom,"scope");return ie||(pe=pe.map(function(ue){return ue.markname=ne+G.BRUSH,ue})),ae.push({name:ne+Q,on:[{events:pe,update:ie?"{"+[de?"x: invert("+de+", x(unit))":"",ce?"y: invert("+ce+", y(unit))":""].filter(function(ue){return!!ue}).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:ne+Z,on:[{events:pe,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),null!==se&&V(ee,te,"x","width",ae),null!==re&&V(ee,te,"y","height",ae),ae}}},{"../../../channel":12,"../../../util":114,"../interval":74,"../selection":76,"./scales":81,"vega-event-selector":6}],86:[function(z,H,B){"use strict";function V(X,K,Q,Z){return X.explicit&&K.explicit&&q.warn(q.message.mergeConflictingProperty(Q,Z,X.value,K.value)),X}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("../log"),Y=z("../util"),G=function(){function X(K,Q){void 0===K&&(K={}),void 0===Q&&(Q={}),this.explicit=K,this.implicit=Q}return X.prototype.clone=function(){return new X(Y.duplicate(this.explicit),Y.duplicate(this.implicit))},X.prototype.combine=function(){return W.__assign({},this.explicit,this.implicit)},X.prototype.get=function(K){return void 0===this.explicit[K]?this.implicit[K]:this.explicit[K]},X.prototype.getWithExplicit=function(K){return void 0===this.explicit[K]?void 0===this.implicit[K]?{explicit:!1,value:void 0}:{explicit:!1,value:this.implicit[K]}:{explicit:!0,value:this.explicit[K]}},X.prototype.setWithExplicit=function(K,Q){void 0!==Q.value&&this.set(K,Q.value,Q.explicit)},X.prototype.set=function(K,Q,Z){return delete this[Z?"implicit":"explicit"][K],this[Z?"explicit":"implicit"][K]=Q,this},X.prototype.copyKeyFromSplit=function(K,Q){void 0===Q.explicit[K]?void 0!==Q.implicit[K]&&this.set(K,Q.implicit[K],!1):this.set(K,Q.explicit[K],!0)},X.prototype.copyKeyFromObject=function(K,Q){void 0!==Q[K]&&this.set(K,Q[K],!0)},X}();B.Split=G,B.makeExplicit=function(X){return{explicit:!0,value:X}},B.makeImplicit=function(X){return{explicit:!1,value:X}},B.tieBreakByComparing=function(X){return function(K,Q,Z,J){var $=X(K.value,Q.value);return 0<$?K:0>$?Q:V(K,Q,Z,J)}},B.defaultTieBreaker=V,B.mergeValuesWithExplicit=function(X,K,Q,Z,J){return void 0===J&&(J=V),void 0===X||void 0===X.value?K:X.explicit&&!K.explicit?X:K.explicit&&!X.explicit?K:X.value===K.value?X:J(X,K,Q,Z)}},{"../log":101,"../util":114,tslib:5}],87:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib"),W=z("../channel"),q=z("../encoding"),Y=z("../encoding"),G=z("../fielddef"),X=z("../mark"),K=z("../stack"),Q=z("../util"),Z=z("./axis/parse"),J=z("./data/parse"),$=z("./layoutsize/assemble"),ee=z("./layoutsize/parse"),te=z("./mark/init"),ae=z("./mark/mark"),ne=z("./model"),ie=z("./repeater"),oe=z("./selection/selection"),le=function(se){function re(de,ce,pe,ue,me,ge){void 0===ue&&(ue={});var fe=se.call(this,de,ce,pe,ge,void 0)||this;fe.type="unit",fe.specifiedScales={},fe.specifiedAxes={},fe.specifiedLegends={},fe.selection={},fe.children=[],fe.initSize(V.__assign({},ue,de.width?{width:de.width}:{},de.height?{height:de.height}:{})),fe.markDef=X.isMarkDef(de.mark)?V.__assign({},de.mark):{type:de.mark};var he=fe.markDef.type,ye=fe.encoding=Y.normalizeEncoding(ie.replaceRepeaterInEncoding(de.encoding||{},me),he);return fe.stack=K.stack(he,ye,fe.config.stack),fe.specifiedScales=fe.initScales(he,ye),fe.encoding=te.initEncoding(fe.markDef,ye,fe.stack,fe.config),fe.specifiedAxes=fe.initAxes(ye),fe.specifiedLegends=fe.initLegend(ye),fe.selection=de.selection,fe}return V.__extends(re,se),re.prototype.scaleDomain=function(de){var ce=this.specifiedScales[de];return ce?ce.domain:void 0},re.prototype.sort=function(de){return(this.getMapping()[de]||{}).sort},re.prototype.axis=function(de){return this.specifiedAxes[de]},re.prototype.legend=function(de){return this.specifiedLegends[de]},re.prototype.initScales=function(de,ce){return W.SCALE_CHANNELS.reduce(function(pe,ue){var me,ge,fe=ce[ue];return G.isFieldDef(fe)?(me=fe,ge=fe.scale):G.isConditionalDef(fe)&&G.isFieldDef(fe.condition)?(me=fe.condition,ge=fe.condition.scale):"x"===ue?me=G.getFieldDef(ce.x2):"y"===ue&&(me=G.getFieldDef(ce.y2)),me&&(pe[ue]=ge||{}),pe},{})},re.prototype.initAxes=function(de){return[W.X,W.Y].reduce(function(ce,pe){var ue=de[pe];if(G.isFieldDef(ue)||pe===W.X&&G.isFieldDef(de.x2)||pe===W.Y&&G.isFieldDef(de.y2)){var me=G.isFieldDef(ue)?ue.axis:null;null!==me&&!1!==me&&(ce[pe]=V.__assign({},me))}return ce},{})},re.prototype.initLegend=function(de){return W.NONSPATIAL_SCALE_CHANNELS.reduce(function(ce,pe){var ue=de[pe];if(ue){var me=G.isFieldDef(ue)?ue.legend:ue.condition&&G.isFieldDef(ue.condition)?ue.condition.legend:null;null!==me&&!1!==me&&(ce[pe]=V.__assign({},me))}return ce},{})},re.prototype.parseData=function(){this.component.data=J.parseData(this)},re.prototype.parseLayoutSize=function(){ee.parseUnitLayoutSize(this)},re.prototype.parseSelection=function(){this.component.selection=oe.parseUnitSelection(this,this.selection)},re.prototype.parseMarkGroup=function(){this.component.mark=ae.parseMarkGroup(this)},re.prototype.parseAxisAndHeader=function(){this.component.axes=Z.parseUnitAxis(this)},re.prototype.assembleSelectionTopLevelSignals=function(de){return oe.assembleTopLevelSignals(this,de)},re.prototype.assembleSelectionSignals=function(){return oe.assembleUnitSelectionSignals(this,[])},re.prototype.assembleSelectionData=function(de){return oe.assembleUnitSelectionData(this,de)},re.prototype.assembleLayout=function(){return null},re.prototype.assembleLayoutSignals=function(){return $.assembleLayoutSignals(this)},re.prototype.assembleMarks=function(){var de=this.component.mark||[];return this.parent&&ne.isLayerModel(this.parent)||(de=oe.assembleUnitSelectionMarks(this,de)),de.map(this.correctDataNames)},re.prototype.assembleLayoutSize=function(){return{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")}},re.prototype.getMapping=function(){return this.encoding},re.prototype.toSpec=function(de,ce){var pe,ue=Q.duplicate(this.encoding);return pe={mark:this.markDef,encoding:ue},de||(pe.config=Q.duplicate(this.config)),ce||(pe.data=Q.duplicate(this.data)),pe},re.prototype.mark=function(){return this.markDef.type},re.prototype.channelHasField=function(de){return q.channelHasField(this.encoding,de)},re.prototype.fieldDef=function(de){var ce=this.encoding[de];return G.getFieldDef(ce)},re}(ne.ModelWithField);B.UnitModel=le},{"../channel":12,"../encoding":94,"../fielddef":96,"../mark":103,"../stack":108,"../util":114,"./axis/parse":16,"./data/parse":37,"./layoutsize/assemble":44,"./layoutsize/parse":45,"./mark/init":53,"./mark/mark":55,"./model":63,"./repeater":65,"./selection/selection":76,tslib:5}],88:[function(z,H,B){"use strict";function V(te){return!!te.type}function W(te){return X.__assign({},te,{encoding:Q.reduce(te.encoding,function(ae,ne,ie){return-1<ee.indexOf(ie)?ae[ie]=ne:$.warn($.message.incompatibleChannel(ie,B.BOXPLOT)),ae},{})})}function q(te){var ae=te.mark,ne=te.encoding;if(X.__rest(te,["mark","encoding"]),J.isFieldDef(ne.x)&&J.isContinuous(ne.x)){if(J.isFieldDef(ne.y)&&J.isContinuous(ne.y)){if(void 0===ne.x.aggregate&&ne.y.aggregate===B.BOXPLOT)return"vertical";if(void 0===ne.y.aggregate&&ne.x.aggregate===B.BOXPLOT)return"horizontal";if(ne.x.aggregate===B.BOXPLOT&&ne.y.aggregate===B.BOXPLOT)throw new Error("Both x and y cannot have aggregate");return V(ae)&&ae.orient?ae.orient:"vertical"}return"horizontal"}if(J.isFieldDef(ne.y)&&J.isContinuous(ne.y))return"vertical";throw new Error("Need a valid continuous axis for boxplots")}function Y(te,ae){te.mark;var ne,ie,oe=te.encoding;if(X.__rest(te,["mark","encoding"]),"vertical"===ae?(ie="y",ne=oe.y):(ie="x",ne=oe.x),ne&&ne.aggregate){var le=ne.aggregate,se=X.__rest(ne,["aggregate"]);le!==B.BOXPLOT&&$.warn("Continuous axis should not have customized aggregation function "+le),ne=se}return{continuousAxisChannelDef:ne,continuousAxis:ie}}function G(te,ae,ne){var ie=Y(te,ae),oe=ie.continuousAxisChannelDef,le=ie.continuousAxis,se=te.encoding,de=[{aggregate:"q1",field:oe.field,as:"lowerBox"},{aggregate:"q3",field:oe.field,as:"upperBox"},{aggregate:"median",field:oe.field,as:"midBox"}],ce=[];void 0===ne?(de.push({aggregate:"min",field:oe.field,as:"lowerWhisker"}),de.push({aggregate:"max",field:oe.field,as:"upperWhisker"})):ce=[{calculate:"datum.upperBox - datum.lowerBox",as:"IQR"},{calculate:"datum.lowerBox - datum.IQR * "+ne,as:"lowerWhisker"},{calculate:"datum.upperBox + datum.IQR * "+ne,as:"lowerWhisker"}];var pe=[],ue=[],me=[],ge={};return Z.forEach(se,function(fe,he){if(he!==le)if(J.isFieldDef(fe)){if(fe.aggregate&&fe.aggregate!==B.BOXPLOT)de.push({aggregate:fe.aggregate,field:fe.field,as:J.field(fe)});else if(void 0===fe.aggregate){var ye=J.field(fe),_e=fe.bin;if(_e){var Se=fe.field;ue.push({bin:_e,field:Se,as:ye})}else if(fe.timeUnit){var be=fe.timeUnit,ve=fe.field;me.push({timeUnit:be,field:ve,as:ye})}pe.push(ye)}ge[he]={field:J.field(fe),type:fe.type}}else ge[he]=se[he]}),{transform:[].concat(ue,me,[{summarize:de,groupby:pe}],ce),continuousAxisChannelDef:oe,continuousAxis:le,encodingWithoutContinuousAxis:ge}}Object.defineProperty(B,"__esModule",{value:!0});var X=z("tslib"),K=z("vega-util"),Q=z("../encoding"),Z=z("./../encoding"),J=z("./../fielddef"),$=z("./../log");B.BOXPLOT="box-plot",B.isBoxPlotDef=V,B.BOXPLOT_STYLES=["boxWhisker","box","boxMid"],B.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX={box:["size"]};var ee=["x","y","color","detail","opacity","size"];B.filterUnsupportedChannels=W,B.normalizeBoxPlot=function(te,ae){var ne=(te=W(te)).mark,ie=(te.encoding,te.selection),oe=X.__rest(te,["mark","encoding","selection"]),le;V(ne)&&ne.extent&&K.isNumber(ne.extent)&&(le=ne.extent);var se=G(te,q(te),le),re=se.transform,de=se.continuousAxisChannelDef,ce=se.continuousAxis,pe=se.encodingWithoutContinuousAxis,ue=pe.size,me=(pe.color,X.__rest(pe,["size","color"])),ge=ue?{size:ue}:{size:{value:ae.box.size}},fe={};return de.scale&&(fe.scale=de.scale),de.axis&&(fe.axis=de.axis),X.__assign({},oe,{transform:re,layer:[{mark:{type:"rule",style:"boxWhisker"},encoding:X.__assign((he={},he[ce]=X.__assign({field:"lowerWhisker",type:de.type},fe),he[ce+"2"]={field:"lowerBox",type:de.type},he),me)},{mark:{type:"rule",style:"boxWhisker"},encoding:X.__assign((ye={},ye[ce]={field:"upperBox",type:de.type},ye[ce+"2"]={field:"upperWhisker",type:de.type},ye),me)},X.__assign({},ie?{selection:ie}:{},{mark:{type:"bar",style:"box"},encoding:X.__assign((_e={},_e[ce]={field:"lowerBox",type:de.type},_e[ce+"2"]={field:"upperBox",type:de.type},_e),pe,ge)}),{mark:{type:"tick",style:"boxMid"},encoding:X.__assign((Se={},Se[ce]={field:"midBox",type:de.type},Se),me,ge)}]});var he,ye,_e,Se}},{"../encoding":94,"./../encoding":94,"./../fielddef":96,"./../log":101,tslib:5,"vega-util":7}],89:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib");B.ERRORBAR="error-bar",B.normalizeErrorBar=function(W){W.mark,W.selection;var q=W.encoding,Y=V.__rest(W,["mark","selection","encoding"]),G=(q.size,V.__rest(q,["size"])),X=(q.x2,q.y2,V.__rest(q,["x2","y2"])),K=(X.x,X.y,V.__rest(X,["x","y"]));if(!q.x2&&!q.y2)throw new Error("Neither x2 or y2 provided");return V.__assign({},Y,{layer:[{mark:"rule",encoding:G},{mark:"tick",encoding:X},{mark:"tick",encoding:q.x2?V.__assign({x:q.x2,y:q.y},K):V.__assign({x:q.x,y:q.y2},K)}]})}},{tslib:5}],90:[function(z,H,B){"use strict";function V(K,Q){X[K]=Q}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("./../mark"),Y=z("./boxplot"),G=z("./errorbar"),X={};B.add=V,B.remove=function(K){delete X[K]},B.COMPOSITE_MARK_STYLES=Y.BOXPLOT_STYLES,B.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX=W.__assign({},Y.VL_ONLY_BOXPLOT_CONFIG_PROPERTY_INDEX),V(Y.BOXPLOT,Y.normalizeBoxPlot),V(G.ERRORBAR,G.normalizeErrorBar),B.normalize=function(K,Q){var Z=q.isMarkDef(K.mark)?K.mark.type:K.mark,J=X[Z];if(J)return J(K,Q);throw new Error("Unregistered composite mark "+Z)}},{"./../mark":103,"./boxplot":88,"./errorbar":89,tslib:5}],91:[function(z,H,B){"use strict";function V(ie,oe,le){var se="title"===oe?$.extractTitleConfig(ie.title).mark:ie[oe];"view"===oe&&(le="cell");var re=W.__assign({},se,ie.style[oe]);0<ee.keys(re).length&&(ie.style[le||oe]=re),delete ie[oe]}Object.defineProperty(B,"__esModule",{value:!0});var W=z("tslib"),q=z("./compositemark"),Y=z("./compositemark/index"),G=z("./guide"),X=z("./legend"),K=z("./mark"),Q=z("./mark"),Z=z("./scale"),J=z("./selection"),$=z("./title"),ee=z("./util");B.defaultViewConfig={width:200,height:200},B.defaultConfig={padding:5,timeFormat:"%b %d, %Y",countTitle:"Number of Records",invalidValues:"filter",view:B.defaultViewConfig,mark:Q.defaultMarkConfig,area:{},bar:Q.defaultBarConfig,circle:{},line:{},point:{},rect:{},rule:{color:"black"},square:{},text:{color:"black"},tick:Q.defaultTickConfig,box:{size:14},boxWhisker:{},boxMid:{color:"white"},scale:Z.defaultScaleConfig,axis:{},axisX:{},axisY:{minExtent:30},axisLeft:{},axisRight:{},axisTop:{},axisBottom:{},axisBand:{},legend:X.defaultLegendConfig,selection:J.defaultConfig,style:{},title:{}},B.initConfig=function(ie){return ee.mergeDeep(ee.duplicate(B.defaultConfig),ie)};var te=["view"].concat(K.PRIMITIVE_MARKS,q.COMPOSITE_MARK_STYLES),ae=["padding","numberFormat","timeFormat","countTitle","stack","scale","selection","invalidValues","overlay"],ne=W.__assign({view:["width","height"]},K.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,Y.VL_ONLY_COMPOSITE_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX);B.stripAndRedirectConfig=function(ie){ie=ee.duplicate(ie);for(var oe=0,le=ae;oe<le.length;oe++)delete ie[ve=le[oe]];if(ie.axis)for(var se=0,re=G.VL_ONLY_GUIDE_CONFIG;se<re.length;se++)ve=re[se],delete ie.axis[ve];if(ie.legend)for(var de=0,ce=G.VL_ONLY_GUIDE_CONFIG;de<ce.length;de++)ve=ce[de],delete ie.legend[ve];if(ie.mark)for(var pe=0,ue=K.VL_ONLY_MARK_CONFIG_PROPERTIES;pe<ue.length;pe++)ve=ue[pe],delete ie.mark[ve];for(var me=0,ge=te;me<ge.length;me++){for(var fe=ge[me],he=0,ye=K.VL_ONLY_MARK_CONFIG_PROPERTIES;he<ye.length;he++)ve=ye[he],delete ie[fe][ve];var _e=ne[fe];if(_e)for(var Se=0,be=_e;Se<be.length;Se++)ve=be[Se],delete ie[fe][ve];V(ie,fe)}for(var ve in V(ie,"title","group-title"),ie)ee.isObject(ie[ve])&&0===ee.keys(ie[ve]).length&&delete ie[ve];return 0<ee.keys(ie).length?ie:void 0}},{"./compositemark":90,"./compositemark/index":90,"./guide":98,"./legend":100,"./mark":103,"./scale":104,"./selection":105,"./title":110,"./util":114,tslib:5}],92:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.isUrlData=function(V){return!!V.url},B.isInlineData=function(V){return!!V.values},B.isNamedData=function(V){return!!V.name},B.MAIN="main",B.RAW="raw"},{}],93:[function(z,H,B){"use strict";function V(K){if(G.isNumber(K))return 4<K&&Y.warn(Y.message.invalidTimeUnit("quarter",K)),K-1+"";throw new Error(Y.message.invalidTimeUnit("quarter",K))}function W(K){if(G.isNumber(K))return K-1+"";var Q=K.toLowerCase(),Z=B.MONTHS.indexOf(Q);if(-1!==Z)return Z+"";var J=Q.substr(0,3),$=B.SHORT_MONTHS.indexOf(J);if(-1!==$)return $+"";throw new Error(Y.message.invalidTimeUnit("month",K))}function q(K){if(G.isNumber(K))return K%7+"";var Q=K.toLowerCase(),Z=B.DAYS.indexOf(Q);if(-1!==Z)return Z+"";var J=Q.substr(0,3),$=B.SHORT_DAYS.indexOf(J);if(-1!==$)return $+"";throw new Error(Y.message.invalidTimeUnit("day",K))}Object.defineProperty(B,"__esModule",{value:!0});var Y=z("./log"),G=z("./util");B.isDateTime=function(K){return K&&(K.year||K.quarter||K.month||K.date||K.day||K.hours||K.minutes||K.seconds||K.milliseconds)},B.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],B.SHORT_MONTHS=B.MONTHS.map(function(K){return K.substr(0,3)}),B.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],B.SHORT_DAYS=B.DAYS.map(function(K){return K.substr(0,3)}),B.dateTimeExpr=function(K,Q){void 0===Q&&(Q=!1);var Z=[];if(Q&&void 0!==K.day&&1<G.keys(K).length&&(Y.warn(Y.message.droppedDay(K)),delete(K=G.duplicate(K)).day),void 0===K.year?void 0===K.day?Z.push(0):Z.push(2006):Z.push(K.year),void 0!==K.month){var J=Q?W(K.month):K.month;Z.push(J)}else if(void 0!==K.quarter){var $=Q?V(K.quarter):K.quarter;Z.push($+"*3")}else Z.push(0);if(void 0!==K.date)Z.push(K.date);else if(void 0!==K.day){var ee=Q?q(K.day):K.day;Z.push(ee+"+1")}else Z.push(1);for(var ne,te=0,ae=["hours","minutes","seconds","milliseconds"];te<ae.length;te++)ne=ae[te],void 0===K[ne]?Z.push(0):Z.push(K[ne]);return K.utc?"utc("+Z.join(", ")+")":"datetime("+Z.join(", ")+")"}},{"./log":101,"./util":114}],94:[function(z,H,B){"use strict";function V(X,K){var Q=X&&X[K];return!!Q&&(G.isArray(Q)?G.some(Q,function(Z){return!!Z.field}):q.isFieldDef(Q)||q.hasConditionFieldDef(Q))}Object.defineProperty(B,"__esModule",{value:!0});var W=z("./channel"),q=z("./fielddef"),Y=z("./log"),G=z("./util");B.channelHasField=V,B.isAggregate=function(X){return G.some(W.CHANNELS,function(K){if(V(X,K)){var Q=X[K];if(G.isArray(Q))return G.some(Q,function(J){return!!J.aggregate});var Z=q.getFieldDef(Q);return Z&&!!Z.aggregate}return!1})},B.normalizeEncoding=function(X,K){return G.keys(X).reduce(function(Q,Z){if(!W.supportMark(Z,K))return Y.warn(Y.message.incompatibleChannel(Z,K)),Q;if("size"===Z&&"line"===K){var J=q.getFieldDef(X[Z]);if(J&&J.aggregate)return Y.warn(Y.message.incompatibleChannel(Z,K,"when the field is aggregated.")),Q}if("detail"===Z||"order"===Z)($=X[Z])&&(Q[Z]=(G.isArray($)?$:[$]).reduce(function(ee,te){return q.isFieldDef(te)?ee.push(q.normalizeFieldDef(te,Z)):Y.warn(Y.message.emptyFieldDef(te,Z)),ee},[]));else{var $=X[Z];if(!q.isFieldDef($)&&!q.isValueDef($)&&!q.isConditionalDef($))return Y.warn(Y.message.emptyFieldDef($,Z)),Q;Q[Z]=q.normalize($,Z)}return Q},{})},B.isRanged=function(X){return X&&(!!X.x&&!!X.x2||!!X.y&&!!X.y2)},B.fieldDefs=function(X){var K=[];return W.CHANNELS.forEach(function(Q){if(V(X,Q)){var Z=X[Q];(G.isArray(Z)?Z:[Z]).forEach(function(J){q.isFieldDef(J)?K.push(J):q.hasConditionFieldDef(J)&&K.push(J.condition)})}}),K},B.forEach=function(X,K,Q){X&&G.keys(X).forEach(function(Z){var J=Z;G.isArray(X[J])?X[J].forEach(function($){K.call(Q,$,J)}):K.call(Q,X[J],J)})},B.reduce=function(X,K,Q,Z){return X?G.keys(X).reduce(function(J,$){var ee=$;return G.isArray(X[ee])?X[ee].reduce(function(te,ae){return K.call(Z,te,ae,ee)},J):K.call(Z,J,X[ee],ee)},Q):Q}},{"./channel":12,"./fielddef":96,"./log":101,"./util":114}],95:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0})},{}],96:[function(z,H,B){"use strict";function V(se){return!!se&&!!se.condition&&W(se.condition)}function W(se){return se&&(se.field||"count"===se.aggregate)}function q(se){switch(se.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!se.bin;case"temporal":return!1;}throw new Error(ae.message.invalidFieldType(se.type))}function Y(se){return!q(se)}function G(se){return"count"===se.aggregate}function X(se,re){if(se.timeUnit)return"temporal";if(se.bin)return"quantitative";switch(te.rangeType(re)){case"continuous":return"quantitative";case"discrete":case"flexible":return"nominal";default:return"quantitative";}}function K(se,re){if(se.aggregate&&!$.isAggregateOp(se.aggregate)){se.aggregate;var de=J.__rest(se,["aggregate"]);ae.warn(ae.message.invalidAggregate(se.aggregate)),se=de}if(se.timeUnit&&(se=J.__assign({},se,{timeUnit:ne.normalizeTimeUnit(se.timeUnit)})),se.bin&&(se=J.__assign({},se,{bin:Q(se.bin,re)})),se.type){var ce=ie.getFullName(se.type);se.type!==ce&&(se=J.__assign({},se,{type:ce})),"quantitative"!==se.type&&$.isCountingAggregateOp(se.aggregate)&&(ae.warn(ae.message.invalidFieldTypeForCountAggregate(se.type,se.aggregate)),se=J.__assign({},se,{type:"quantitative"}))}else{var pe=X(se,re);ae.warn(ae.message.emptyOrInvalidFieldType(se.type,re,pe)),se=J.__assign({},se,{type:pe})}var ue=Z(se,re),me=ue.compatible,ge=ue.warning;return me||ae.warn(ge),se}function Q(se,re){return oe.isBoolean(se)?{maxbins:ee.autoMaxBins(re)}:se.maxbins||se.step?se:J.__assign({},se,{maxbins:ee.autoMaxBins(re)})}function Z(se,re){switch(re){case"row":case"column":return Y(se)&&!se.timeUnit?{compatible:!1,warning:ae.message.facetChannelShouldBeDiscrete(re)}:le;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return le;case"opacity":case"size":case"x2":case"y2":return q(se)&&!se.bin?{compatible:!1,warning:"Channel "+re+" should not be used with discrete field."}:le;case"shape":return"nominal"===se.type?le:{compatible:!1,warning:"Shape channel should be used with nominal data only"};case"order":return"nominal"===se.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:le;}throw new Error("channelCompatability not implemented for channel "+re)}Object.defineProperty(B,"__esModule",{value:!0});var J=z("tslib"),$=z("./aggregate"),ee=z("./bin"),te=z("./channel"),ae=z("./log"),ne=z("./timeunit"),ie=z("./type"),oe=z("./util");B.isRepeatRef=function(se){return se&&!oe.isString(se)&&"repeat"in se},B.isConditionalDef=function(se){return!!se&&!!se.condition},B.hasConditionFieldDef=V,B.isFieldDef=W,B.isValueDef=function(se){return se&&"value"in se&&void 0!==se.value},B.isScaleFieldDef=function(se){return se&&(se.scale||se.sort)},B.field=function(se,re){void 0===re&&(re={});var de=se.field,ce=re.prefix,pe=re.suffix;if(G(se))de="count_*";else{var ue;re.nofn||(se.bin?(ue=ee.binToString(se.bin),pe=re.binSuffix||""):se.aggregate?ue=(re.aggregate||se.aggregate)+"":se.timeUnit&&(ue=se.timeUnit+"")),ue&&(de=ue+"_"+de)}return pe&&(de=de+"_"+pe),ce&&(de=ce+"_"+de),re.expr&&(de=re.expr+"["+oe.stringValue(de)+"]"),de},B.isDiscrete=q,B.isContinuous=Y,B.isCount=G,B.title=function(se,re){if(G(se))return re.countTitle;var de=se.aggregate||se.timeUnit||se.bin&&"bin";return de?de.toUpperCase()+"("+se.field+")":se.field},B.defaultType=X,B.getFieldDef=function(se){return W(se)?se:V(se)?se.condition:void 0},B.normalize=function(se,re){return W(se)?K(se,re):V(se)?J.__assign({},se,{condition:K(se.condition,re)}):se},B.normalizeFieldDef=K,B.normalizeBin=Q;var le={compatible:!0};B.channelCompatibility=Z,B.isNumberFieldDef=function(se){return"quantitative"===se.type||!!se.bin},B.isTimeFieldDef=function(se){return"temporal"===se.type||!!se.timeUnit}},{"./aggregate":9,"./bin":11,"./channel":12,"./log":101,"./timeunit":109,"./type":113,"./util":114,tslib:5}],97:[function(z,H,B){"use strict";function V(ae){return ae&&ae.selection}function W(ae){return ae&&!!ae.field&&void 0!==ae.equal}function q(ae){return!!(ae&&ae.field&&te.isArray(ae.range)&&2===ae.range.length)}function Y(ae){return ae&&!!ae.field&&(te.isArray(ae.oneOf)||te.isArray(ae.in))}function G(ae){return Y(ae)||W(ae)||q(ae)}function X(ae,ne){void 0===ne&&(ne=!0);var ie=ae.timeUnit?"time("+ee.fieldExpr(ae.timeUnit,ae.field)+")":$.field(ae,{expr:"datum"});if(W(ae))return ie+"==="+K(ae.equal,ae.timeUnit);if(Y(ae))return"indexof(["+(ae.oneOf||ae.in).map(function(re){return K(re,ae.timeUnit)}).join(",")+"], "+ie+") !== -1";if(q(ae)){var oe=ae.range[0],le=ae.range[1];if(null!==oe&&null!==le&&ne)return"inrange("+ie+", ["+K(oe,ae.timeUnit)+", "+K(le,ae.timeUnit)+"])";var se=[];return null!==oe&&se.push(ie+" >= "+K(oe,ae.timeUnit)),null!==le&&se.push(ie+" <= "+K(le,ae.timeUnit)),0<se.length?se.join(" && "):"true"}throw new Error("Invalid field filter: "+JSON.stringify(ae))}function K(ae,ne){if(J.isDateTime(ae))return"time("+(oe=J.dateTimeExpr(ae,!0))+")";if(ee.isLocalSingleTimeUnit(ne)){var ie={};ie[ne]=ae;var oe=J.dateTimeExpr(ie,!0);return"time("+oe+")"}return ee.isUtcSingleTimeUnit(ne)?K(ae,ee.getLocalTimeUnit(ne)):JSON.stringify(ae)}Object.defineProperty(B,"__esModule",{value:!0});var Q=z("tslib"),Z=z("./compile/selection/selection"),J=z("./datetime"),$=z("./fielddef"),ee=z("./timeunit"),te=z("./util");B.isSelectionFilter=V,B.isEqualFilter=W,B.isRangeFilter=q,B.isOneOfFilter=Y,B.isFieldFilter=G,B.expression=function(ae,ne,ie){return te.logicalExpr(ne,function(oe){return te.isString(oe)?oe:V(oe)?Z.predicate(ae,oe.selection,ie):X(oe)})},B.fieldFilterExpression=X,B.normalizeFilter=function(ae){return G(ae)&&ae.timeUnit?Q.__assign({},ae,{timeUnit:ee.normalizeTimeUnit(ae.timeUnit)}):ae}},{"./compile/selection/selection":76,"./datetime":93,"./fielddef":96,"./timeunit":109,"./util":114,tslib:5}],98:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.VL_ONLY_GUIDE_CONFIG=["shortTimeLabels"]},{}],99:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.axis=z("./axis"),B.aggregate=z("./aggregate"),B.bin=z("./bin"),B.channel=z("./channel"),B.compositeMark=z("./compositemark");var V=z("./compile/compile");B.compile=V.compile,B.config=z("./config"),B.data=z("./data"),B.datetime=z("./datetime"),B.encoding=z("./encoding"),B.facet=z("./facet"),B.fieldDef=z("./fielddef"),B.legend=z("./legend"),B.mark=z("./mark"),B.scale=z("./scale"),B.sort=z("./sort"),B.spec=z("./spec"),B.stack=z("./stack"),B.timeUnit=z("./timeunit"),B.transform=z("./transform"),B.type=z("./type"),B.util=z("./util"),B.validate=z("./validate"),B.version=z("../package.json").version},{"../package.json":8,"./aggregate":9,"./axis":10,"./bin":11,"./channel":12,"./compile/compile":21,"./compositemark":90,"./config":91,"./data":92,"./datetime":93,"./encoding":94,"./facet":95,"./fielddef":96,"./legend":100,"./mark":103,"./scale":104,"./sort":106,"./spec":107,"./stack":108,"./timeunit":109,"./transform":112,"./type":113,"./util":114,"./validate":115}],100:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.defaultLegendConfig={},B.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"],B.VG_LEGEND_PROPERTIES=[].concat(["fill","stroke","shape","size","opacity","encode"],B.LEGEND_PROPERTIES)},{}],101:[function(z,H,B){"use strict";function V(){return Y=q}Object.defineProperty(B,"__esModule",{value:!0});var W=z("vega-util"),q=W.logger(W.Warn),Y=q,G=function(){function X(){this.warns=[],this.infos=[],this.debugs=[]}return X.prototype.level=function(){return this},X.prototype.warn=function(){for(var K=[],Q=0;Q<arguments.length;Q++)K[Q]=arguments[Q];return(Z=this.warns).push.apply(Z,K),this;var Z},X.prototype.info=function(){for(var K=[],Q=0;Q<arguments.length;Q++)K[Q]=arguments[Q];return(Z=this.infos).push.apply(Z,K),this;var Z},X.prototype.debug=function(){for(var K=[],Q=0;Q<arguments.length;Q++)K[Q]=arguments[Q];return(Z=this.debugs).push.apply(Z,K),this;var Z},X}();B.LocalLogger=G,B.runLocalLogger=function(X){X(Y=new G),V()},B.wrap=function(X){return function(){var K=Y=new G;X(K),V()}},B.set=function(X){return Y=X},B.reset=V,B.warn=function(){for(var X=[],K=0;K<arguments.length;K++)X[K]=arguments[K];Y.warn.apply(Y,arguments)},B.info=function(){for(var X=[],K=0;K<arguments.length;K++)X[K]=arguments[K];Y.info.apply(Y,arguments)},B.debug=function(){for(var X=[],K=0;K<arguments.length;K++)X[K]=arguments[K];Y.debug.apply(Y,arguments)},!function(X){X.INVALID_SPEC="Invalid spec",X.cannotProjectOnChannelWithoutField=function(K){return"Cannot project a selection on encoding channel \""+K+"\", which has no field."},X.selectionNotFound=function(K){return"Cannot find a selection named \""+K+"\""},X.noSuchRepeatedValue=function(K){return"Unknown repeated value \""+K+"\"."},X.cannotSetTitleAnchor=function(K){return"Cannot set title \"anchor\" for a "+K+" spec"},X.unrecognizedParse=function(K){return"Unrecognized parse \""+K+"\"."},X.differentParse=function(K,Q,Z){return"An ancestor parsed field \""+K+"\" as "+Z+" but a child wants to parse the field as "+Q+"."},X.invalidTransformIgnored=function(K){return"Ignoring an invalid transform: "+JSON.stringify(K)+"."},X.NO_FIELDS_NEEDS_AS="If \"from.fields\" is not specified, \"as\" has to be a string that specifies the key to be used for the the data from the secondary source.",X.invalidFieldType=function(K){return"Invalid field type \""+K+"\""},X.invalidFieldTypeForCountAggregate=function(K,Q){return"Invalid field type \""+K+"\" for aggregate: \""+Q+"\", using \"quantitative\" instead."},X.invalidAggregate=function(K){return"Invalid aggregation operator \""+K+"\""},X.emptyOrInvalidFieldType=function(K,Q,Z){return"Invalid field type \""+K+"\" for channel \""+Q+"\", using \""+Z+"\" instead."},X.emptyFieldDef=function(K,Q){return"Dropping "+JSON.stringify(K)+" from channel \""+Q+"\" since it does not contain data field or value."},X.incompatibleChannel=function(K,Q,Z){return K+" dropped as it is incompatible with \""+Q+"\""+(Z?" when "+Z:"")+"."},X.facetChannelShouldBeDiscrete=function(K){return K+" encoding should be discrete (ordinal / nominal / binned)."},X.discreteChannelCannotEncode=function(K,Q){return"Using discrete channel \""+K+"\" to encode \""+Q+"\" field can be misleading as it does not encode "+("ordinal"===Q?"order":"magnitude")+"."},X.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",X.unclearOrientContinuous=function(K){return"Cannot clearly determine orientation for \""+K+"\" since both x and y channel encode continous fields. In this case, we use vertical by default"},X.unclearOrientDiscreteOrEmpty=function(K){return"Cannot clearly determine orientation for \""+K+"\" since both x and y channel encode discrete or empty fields."},X.orientOverridden=function(K,Q){return"Specified orient \""+K+"\" overridden with \""+Q+"\""},X.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",X.cannotUseScalePropertyWithNonColor=function(K){return"Cannot use the scale property \""+K+"\" with non-color channel."},X.unaggregateDomainHasNoEffectForRawField=function(K){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(K)+")."},X.unaggregateDomainWithNonSharedDomainOp=function(K){return"Unaggregated domain not applicable for \""+K+"\" since it produces values outside the origin domain of the source data."},X.unaggregatedDomainWithLogScale=function(K){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(K)+")."},X.CANNOT_USE_RANGE_WITH_POSITION="Cannot use a custom \"range\" with x or y channel.  Please customize width, height, padding, or rangeStep instead.",X.cannotUseSizeFieldWithBandSize=function(K){return"Using size field when "+K+"-channel has a band scale is not supported."},X.cannotApplySizeToNonOrientedMark=function(K){return"Cannot apply size to non-oriented mark \""+K+"\"."},X.rangeStepDropped=function(K){return"rangeStep for \""+K+"\" is dropped as top-level "+("x"===K?"width":"height")+" is provided."},X.scaleTypeNotWorkWithChannel=function(K,Q,Z){return"Channel \""+K+"\" does not work with \""+Q+"\" scale. We are using \""+Z+"\" scale instead."},X.scaleTypeNotWorkWithFieldDef=function(K,Q){return"FieldDef does not work with \""+K+"\" scale. We are using \""+Q+"\" scale instead."},X.scalePropertyNotWorkWithScaleType=function(K,Q,Z){return Z+"-scale's \""+Q+"\" is dropped as it does not work with "+K+" scale."},X.scaleTypeNotWorkWithMark=function(K,Q){return"Scale type \""+Q+"\" does not work with mark \""+K+"\"."},X.mergeConflictingProperty=function(K,Q,Z,J){return"Conflicting "+Q+" property \""+K+"\" (\""+Z+"\" and \""+J+"\").  Using \""+Z+"\"."},X.independentScaleMeansIndependentGuide=function(K){return"Setting the scale to be independent for \""+K+"\" means we also have to set the guide (axis or legend) to be independent."},X.conflictedDomain=function(K){return"Cannot set "+K+"-scale's \"domain\" as it is binned. Please use \"bin\"'s \"extent\" instead."},X.domainSortDropped=function(K){return"Dropping sort property \""+JSON.stringify(K)+"\" as unioned domains only support boolean or op 'count'."},X.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",X.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",X.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",X.cannotStackRangedMark=function(K){return"Cannot stack \""+K+"\" if there is already \""+K+"2\""},X.cannotStackNonLinearScale=function(K){return"Cannot stack non-linear scale ("+K+")"},X.cannotStackNonSummativeAggregate=function(K){return"Cannot stack when the aggregate function is non-summative (\""+K+"\")"},X.invalidTimeUnit=function(K,Q){return"Invalid "+K+": \""+Q+"\""},X.dayReplacedWithDate=function(K){return"Time unit \""+K+"\" is not supported. We are replacing it with "+K.replace("day","date")+"."},X.droppedDay=function(K){return"Dropping day from datetime "+JSON.stringify(K)+" as day cannot be combined with other units."}}(B.message||(B.message={}))},{"vega-util":7}],102:[function(z,H,B){"use strict";function V(X){return!!X.or}function W(X){return!!X.and}function q(X){return!!X.not}function Y(X,K){if(q(X))Y(X.not,K);else if(W(X))for(var Q=0,Z=X.and;Q<Z.length;Q++)Y(ee=Z[Q],K);else if(V(X))for(var ee,J=0,$=X.or;J<$.length;J++)ee=$[J],Y(ee,K);else K(X)}function G(X,K){return q(X)?{not:G(X.not,K)}:W(X)?{and:X.and.map(function(Q){return G(Q,K)})}:V(X)?{or:X.or.map(function(Q){return G(Q,K)})}:K(X)}Object.defineProperty(B,"__esModule",{value:!0}),B.isLogicalOr=V,B.isLogicalAnd=W,B.isLogicalNot=q,B.forEachLeave=Y,B.normalizeLogicalOperand=G},{}],103:[function(z,H,B){"use strict";function V(X){return X.type}Object.defineProperty(B,"__esModule",{value:!0});var W,q=z("./util");!function(X){X.AREA="area",X.BAR="bar",X.LINE="line",X.POINT="point",X.RECT="rect",X.RULE="rule",X.TEXT="text",X.TICK="tick",X.CIRCLE="circle",X.SQUARE="square"}(W=B.Mark||(B.Mark={})),B.AREA=W.AREA,B.BAR=W.BAR,B.LINE=W.LINE,B.POINT=W.POINT,B.TEXT=W.TEXT,B.TICK=W.TICK,B.RECT=W.RECT,B.RULE=W.RULE,B.CIRCLE=W.CIRCLE,B.SQUARE=W.SQUARE;var Y={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,rule:1,circle:1,square:1};B.isMark=function(X){return!!Y[X]},B.PRIMITIVE_MARKS=q.flagKeys(Y),B.isMarkDef=V;var G=q.toSet(B.PRIMITIVE_MARKS);B.isPrimitiveMark=function(X){return(V(X)?X.type:X)in G},B.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],B.FILL_CONFIG=["fill","fillOpacity"],B.FILL_STROKE_CONFIG=[].concat(B.STROKE_CONFIG,B.FILL_CONFIG),B.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],B.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},B.defaultMarkConfig={color:"#4c78a8"},B.defaultBarConfig={binSpacing:1,continuousBandSize:2},B.defaultTickConfig={thickness:1}},{"./util":114}],104:[function(z,H,B){"use strict";function V(ne){return ne in J}function W(ne){return ne in Z}Object.defineProperty(B,"__esModule",{value:!0});var q=z("tslib"),Y=z("./channel"),G=z("./log"),X=z("./util");!function(ne){ne.LINEAR="linear",ne.BIN_LINEAR="bin-linear",ne.LOG="log",ne.POW="pow",ne.SQRT="sqrt",ne.TIME="time",ne.UTC="utc",ne.SEQUENTIAL="sequential",ne.QUANTILE="quantile",ne.QUANTIZE="quantize",ne.THRESHOLD="threshold",ne.ORDINAL="ordinal",ne.BIN_ORDINAL="bin-ordinal",ne.POINT="point",ne.BAND="band"}(B.ScaleType||(B.ScaleType={}));var K={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};B.SCALE_TYPES=X.keys(K),B.scaleCompatible=function(ne,ie){var oe=K[ne],le=K[ie];return oe===le||"ordinal-position"===oe&&"time"===le||"ordinal-position"===le&&"time"===oe};var Q={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};B.scaleTypePrecedence=function(ne){return Q[ne]},B.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var Z=X.toSet(B.CONTINUOUS_TO_CONTINUOUS_SCALES);B.CONTINUOUS_DOMAIN_SCALES=B.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var J=X.toSet(B.CONTINUOUS_DOMAIN_SCALES);B.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var $=X.toSet(B.DISCRETE_DOMAIN_SCALES),ee=X.toSet(["bin-linear","bin-ordinal"]);B.TIME_SCALE_TYPES=["time","utc"],B.hasDiscreteDomain=function(ne){return ne in $},B.isBinScale=function(ne){return ne in ee},B.hasContinuousDomain=V,B.isContinuousToContinuous=W,B.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},B.isExtendedScheme=function(ne){return ne&&!!ne.name},B.isSelectionDomain=function(ne){return ne&&ne.selection};var te={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};B.SCALE_PROPERTIES=X.flagKeys(te);var ae=q.__rest(te,["type","domain","range","rangeStep","scheme"]);B.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=X.flagKeys(ae),B.scaleTypeSupportProperty=function(ne,ie){switch(ie){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return X.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],ne);case"interpolate":return X.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],ne);case"round":return W(ne)||"band"===ne||"point"===ne;case"rangeStep":case"padding":case"paddingOuter":return X.contains(["point","band"],ne);case"paddingInner":return"band"===ne;case"clamp":return W(ne)||"sequential"===ne;case"nice":return W(ne)||"sequential"===ne||"quantize"===ne;case"exponent":return"pow"===ne;case"base":return"log"===ne;case"zero":return V(ne)&&!X.contains(["log","time","utc","bin-linear","threshold","quantile"],ne);}throw new Error("Invalid scale property "+ie+".")},B.channelScalePropertyIncompatability=function(ne,ie){switch(ie){case"range":return"x"===ne||"y"===ne?G.message.CANNOT_USE_RANGE_WITH_POSITION:void 0;case"interpolate":case"scheme":return"color"===ne?void 0:G.message.cannotUseScalePropertyWithNonColor(ne);case"type":case"domain":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return;}throw new Error("Invalid scale property \""+ie+"\".")},B.channelSupportScaleType=function(ne,ie){return ne===Y.Channel.X||ne===Y.Channel.Y||ne===Y.Channel.SIZE||ne===Y.Channel.OPACITY?W(ie)||X.contains(["band","point"],ie):ne===Y.Channel.COLOR?"band"!==ie:!(ne!==Y.Channel.SHAPE)&&"ordinal"===ie}},{"./channel":12,"./log":101,"./util":114,tslib:5}],105:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.SELECTION_ID="_vgsid_",B.defaultConfig={single:{on:"click",fields:[B.SELECTION_ID],resolve:"global"},multi:{on:"click",fields:[B.SELECTION_ID],toggle:"event.shiftKey",resolve:"global"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global"}}},{}],106:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.isSortField=function(V){return V&&("count"===V.op||V.field)&&V.op}},{}],107:[function(z,H,B){"use strict";function V(_e){return void 0!==_e.facet}function W(_e){return!!_e.mark}function q(_e){return void 0!==_e.layer}function Y(_e){return void 0!==_e.repeat}function G(_e){return X(_e)||K(_e)}function X(_e){return void 0!==_e.vconcat}function K(_e){return void 0!==_e.hconcat}function Q(_e,Se){if(V(_e))return Z(_e,Se);if(q(_e))return J(_e,Se);if(Y(_e))return $(_e,Se);if(X(_e))return ee(_e,Se);if(K(_e))return te(_e,Se);if(W(_e)){var be=ue.channelHasField(_e.encoding,ce.ROW),ve=ue.channelHasField(_e.encoding,ce.COLUMN);return be||ve?ae(_e,Se):ie(_e,Se)}throw new Error(ge.message.INVALID_SPEC)}function Z(_e,Se){var be=_e.spec,ve=de.__rest(_e,["spec"]);return de.__assign({},ve,{spec:Q(be,Se)})}function J(_e,Se){var be=_e.layer,ve=de.__rest(_e,["layer"]);return de.__assign({},ve,{layer:be.map(function(xe){return q(xe)?J(xe,Se):ie(xe,Se)})})}function $(_e,Se){var be=_e.spec,ve=de.__rest(_e,["spec"]);return de.__assign({},ve,{spec:Q(be,Se)})}function ee(_e,Se){var be=_e.vconcat,ve=de.__rest(_e,["vconcat"]);return de.__assign({},ve,{vconcat:be.map(function(xe){return Q(xe,Se)})})}function te(_e,Se){var be=_e.hconcat,ve=de.__rest(_e,["hconcat"]);return de.__assign({},ve,{hconcat:be.map(function(xe){return Q(xe,Se)})})}function ae(_e,Se){var be=_e.encoding,ve=be.row,xe=be.column,Ee=de.__rest(be,["row","column"]),Ne=_e.mark,Te=_e.width,De=_e.height,ke=_e.selection,Oe=(_e.encoding,de.__rest(_e,["mark","width","height","selection","encoding"]));return de.__assign({},Oe,{facet:de.__assign({},ve?{row:ve}:{},xe?{column:xe}:{}),spec:ie(de.__assign({mark:Ne},Te?{width:Te}:{},De?{height:De}:{},{encoding:Ee},ke?{selection:ke}:{}),Se)})}function ne(_e){return fe.isPrimitiveMark(_e.mark)}function ie(_e,Se){if(ne(_e)){if(ue.isRanged(_e.encoding))return oe(_e);var be=Se&&Se.overlay,ve=be&&_e.mark===fe.AREA&&ye.contains(["linepoint","line"],be.area),xe=be&&(be.line&&_e.mark===fe.LINE||"linepoint"===be.area&&_e.mark===fe.AREA);return xe||ve?le(_e,xe,ve,Se):_e}return pe.normalize(_e,Se)}function oe(_e){var Se=ue.channelHasField(_e.encoding,ce.X),be=ue.channelHasField(_e.encoding,ce.Y),ve=ue.channelHasField(_e.encoding,ce.X2),xe=ue.channelHasField(_e.encoding,ce.Y2);if(ve&&!Se||xe&&!be){var Ee=ye.duplicate(_e);return ve&&!Se&&(Ee.encoding.x=Ee.encoding.x2,delete Ee.encoding.x2),xe&&!be&&(Ee.encoding.y=Ee.encoding.y2,delete Ee.encoding.y2),Ee}return _e}function le(_e,Se,be,ve){var xe=_e.mark,Ee=_e.selection,Ne=_e.encoding,Te=de.__rest(_e,["mark","selection","encoding"]),De=[{mark:xe,encoding:Ne}],ke=he.stack(xe,Ne,ve?ve.stack:void 0),Oe=Ne;if(ke){var Ce=ke.fieldChannel,Ae=ke.offset;Oe=de.__assign({},Ne,(Pe={},Pe[Ce]=de.__assign({},Ne[Ce],Ae?{stack:Ae}:{}),Pe))}return be&&De.push(de.__assign({mark:{type:"line",style:"lineOverlay"}},Ee?{selection:Ee}:{},{encoding:Oe})),Se&&De.push(de.__assign({mark:{type:"point",filled:!0,style:"pointOverlay"}},Ee?{selection:Ee}:{},{encoding:Oe})),de.__assign({},Te,{layer:De});var Pe}function se(_e,Se){return Se.forEach(function(be){var ve=["field","type","value","timeUnit","bin","aggregate"].reduce(function(Ee,Ne){return void 0!==be[Ne]&&(Ee[Ne]=be[Ne]),Ee},{}),xe=ye.hash(ve);_e[xe]=_e[xe]||be}),_e}function re(_e,Se){return void 0===Se&&(Se={}),q(_e)?_e.layer.forEach(function(be){W(be)?se(Se,me.fieldDefs(be.encoding)):re(be,Se)}):V(_e)?(se(Se,me.fieldDefs(_e.facet)),re(_e.spec,Se)):Y(_e)?re(_e.spec,Se):G(_e)?(X(_e)?_e.vconcat:_e.hconcat).forEach(function(be){return re(be,Se)}):se(Se,me.fieldDefs(_e.encoding)),Se}Object.defineProperty(B,"__esModule",{value:!0});var de=z("tslib"),ce=z("./channel"),pe=z("./compositemark"),ue=z("./encoding"),me=z("./encoding"),ge=z("./log"),fe=z("./mark"),he=z("./stack"),ye=z("./util");B.isFacetSpec=V,B.isUnitSpec=W,B.isLayerSpec=q,B.isRepeatSpec=Y,B.isConcatSpec=G,B.isVConcatSpec=X,B.isHConcatSpec=K,B.normalize=Q,B.fieldDefs=function(_e){return ye.vals(re(_e))},B.isStacked=function(_e,Se){return Se=Se||_e.config,!!fe.isPrimitiveMark(_e.mark)&&null!==he.stack(_e.mark,_e.encoding,Se?Se.stack:void 0)}},{"./channel":12,"./compositemark":90,"./encoding":94,"./log":101,"./mark":103,"./stack":108,"./util":114,tslib:5}],108:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./aggregate"),W=z("./channel"),q=z("./encoding"),Y=z("./fielddef"),G=z("./log"),X=z("./mark"),K=z("./scale"),Q=z("./util");B.STACKABLE_MARKS=[X.BAR,X.AREA,X.RULE,X.POINT,X.CIRCLE,X.SQUARE,X.LINE,X.TEXT,X.TICK],B.STACK_BY_DEFAULT_MARKS=[X.BAR,X.AREA],B.stack=function(Z,J,$){var ee=X.isMarkDef(Z)?Z.type:Z;if(!Q.contains(B.STACKABLE_MARKS,ee))return null;if(!q.isAggregate(J))return null;var te=W.NONSPATIAL_CHANNELS.reduce(function(ce,pe){if(q.channelHasField(J,pe)){var ue=J[pe];(Q.isArray(ue)?ue:[ue]).forEach(function(me){var ge=Y.getFieldDef(me);ge.aggregate||ce.push({channel:pe,fieldDef:ge})})}return ce},[]);if(0===te.length)return null;var ae=Y.isFieldDef(J.x),ne=Y.isFieldDef(J.y),ie=Y.isFieldDef(J.x)&&!!J.x.aggregate;if(ie!==(Y.isFieldDef(J.y)&&!!J.y.aggregate)){var oe=ie?W.X:W.Y,le=J[oe],se=le.aggregate,re=le.scale,de=null;return(de=void 0===le.stack?Q.contains(B.STACK_BY_DEFAULT_MARKS,ee)&&void 0===$?"zero":$:le.stack)&&"none"!==de?re&&re.type&&re.type!==K.ScaleType.LINEAR?(G.warn(G.message.cannotStackNonLinearScale(re.type)),null):q.channelHasField(J,oe===W.X?W.X2:W.Y2)?(G.warn(G.message.cannotStackRangedMark(oe)),null):Q.contains(V.SUM_OPS,se)?{groupbyChannel:ie?ne?W.Y:null:ae?W.X:null,fieldChannel:oe,impute:Q.contains(["area","line"],ee),stackBy:te,offset:de}:(G.warn(G.message.cannotStackNonSummativeAggregate(se)),null):null}return null}},{"./aggregate":9,"./channel":12,"./encoding":94,"./fielddef":96,"./log":101,"./mark":103,"./scale":104,"./util":114}],109:[function(z,H,B){"use strict";function V(ie){return!!te[ie]}function W(ie,oe){var le=ne[ie];return{setDateMethod:oe?"setUTC"+le.substr(3):le,getDateMethod:"get"+(oe?"UTC":"")+le.substr(3)}}function q(ie,oe){var le=ie.indexOf(oe);return-1<le&&(oe!==Y.SECONDS||0===le||"i"!==ie.charAt(le-1))}Object.defineProperty(B,"__esModule",{value:!0});var Y,G=z("tslib"),X=z("./datetime"),K=z("./log"),Q=z("./util");!function(ie){ie.YEAR="year",ie.MONTH="month",ie.DAY="day",ie.DATE="date",ie.HOURS="hours",ie.MINUTES="minutes",ie.SECONDS="seconds",ie.MILLISECONDS="milliseconds",ie.YEARMONTH="yearmonth",ie.YEARMONTHDATE="yearmonthdate",ie.YEARMONTHDATEHOURS="yearmonthdatehours",ie.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",ie.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",ie.MONTHDATE="monthdate",ie.HOURSMINUTES="hoursminutes",ie.HOURSMINUTESSECONDS="hoursminutesseconds",ie.MINUTESSECONDS="minutesseconds",ie.SECONDSMILLISECONDS="secondsmilliseconds",ie.QUARTER="quarter",ie.YEARQUARTER="yearquarter",ie.QUARTERMONTH="quartermonth",ie.YEARQUARTERMONTH="yearquartermonth",ie.UTCYEAR="utcyear",ie.UTCMONTH="utcmonth",ie.UTCDAY="utcday",ie.UTCDATE="utcdate",ie.UTCHOURS="utchours",ie.UTCMINUTES="utcminutes",ie.UTCSECONDS="utcseconds",ie.UTCMILLISECONDS="utcmilliseconds",ie.UTCYEARMONTH="utcyearmonth",ie.UTCYEARMONTHDATE="utcyearmonthdate",ie.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",ie.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",ie.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",ie.UTCMONTHDATE="utcmonthdate",ie.UTCHOURSMINUTES="utchoursminutes",ie.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",ie.UTCMINUTESSECONDS="utcminutesseconds",ie.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",ie.UTCQUARTER="utcquarter",ie.UTCYEARQUARTER="utcyearquarter",ie.UTCQUARTERMONTH="utcquartermonth",ie.UTCYEARQUARTERMONTH="utcyearquartermonth"}(Y=B.TimeUnit||(B.TimeUnit={}));var Z={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};B.TIMEUNIT_PARTS=Q.flagKeys(Z),B.isLocalSingleTimeUnit=function(ie){return!!Z[ie]};var J={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};B.isUtcSingleTimeUnit=function(ie){return!!J[ie]};var ee={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},te=G.__assign({},J,ee);B.isUTCTimeUnit=V,B.getLocalTimeUnit=function(ie){return ie.substr(3)};var ae=G.__assign({},Z,J,{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},ee);B.TIMEUNITS=Q.flagKeys(ae),B.isTimeUnit=function(ie){return!!ae[ie]};var ne={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};B.convert=function(ie,oe){var le=V(ie),se=le?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0);return B.TIMEUNIT_PARTS.forEach(function(re){if(q(ie,re))switch(re){case Y.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case Y.QUARTER:var de=W("month",le),ce=de.getDateMethod,pe=de.setDateMethod;se[pe](3*Math.floor(oe[ce]()/3));break;default:var ue=W(re,le),me=ue.getDateMethod,ge=ue.setDateMethod;se[ge](oe[me]());}}),se},B.containsTimeUnit=q,B.fieldExpr=function(ie,oe){function le(ce){return ce===Y.QUARTER?"("+re+"quarter("+se+")-1)":""+re+ce+"("+se+")"}var se="datum["+Q.stringValue(oe)+"]",re=V(ie)?"utc":"",de=B.TIMEUNIT_PARTS.reduce(function(ce,pe){return q(ie,pe)&&(ce[pe]=le(pe)),ce},{});return X.dateTimeExpr(de)},B.smallestUnit=function(ie){if(ie)return q(ie,Y.SECONDS)?"second":q(ie,Y.MINUTES)?"minute":q(ie,Y.HOURS)?"hour":q(ie,Y.DAY)||q(ie,Y.DATE)?"day":q(ie,Y.MONTH)?"month":q(ie,Y.YEAR)?"year":void 0},B.formatExpression=function(ie,oe,le,se){if(ie){var re=[],de="",ce=q(ie,Y.YEAR);q(ie,Y.QUARTER)&&(de="'Q' + quarter("+oe+")"),q(ie,Y.MONTH)&&re.push(!1===le?"%B":"%b"),q(ie,Y.DAY)?re.push(le?"%a":"%A"):q(ie,Y.DATE)&&re.push("%d"+(ce?",":"")),ce&&re.push(le?"%y":"%Y");var pe=[];q(ie,Y.HOURS)&&pe.push("%H"),q(ie,Y.MINUTES)&&pe.push("%M"),q(ie,Y.SECONDS)&&pe.push("%S"),q(ie,Y.MILLISECONDS)&&pe.push("%L");var ue=[];return 0<re.length&&ue.push(re.join(" ")),0<pe.length&&ue.push(pe.join(":")),0<ue.length&&(de&&(de+=" + ' ' + "),de+=se?"utcFormat("+oe+", '"+ue.join(" ")+"')":"timeFormat("+oe+", '"+ue.join(" ")+"')"),de||void 0}},B.normalizeTimeUnit=function(ie){return"day"!==ie&&0<=ie.indexOf("day")?(K.warn(K.message.dayReplacedWithDate(ie)),ie.replace("day","date")):ie}},{"./datetime":93,"./log":101,"./util":114,tslib:5}],110:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("tslib");B.extractTitleConfig=function(W){var q=W.anchor,Y=W.offset,G=W.orient,X=W.color,K=V.__rest(W,["anchor","offset","orient","color"]);return{mark:V.__assign({},K,X?{fill:X}:{}),nonMark:V.__assign({},q?{anchor:q}:{},Y?{offset:Y}:{},G?{orient:G}:{})}}},{tslib:5}],111:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=["background","padding","autoResize"];B.extractTopLevelProperties=function(W){return V.reduce(function(q,Y){return W&&void 0!==W[Y]&&(q[Y]=W[Y]),q},{})}},{}],112:[function(z,H,B){"use strict";function V(Y){return void 0!==Y.filter}Object.defineProperty(B,"__esModule",{value:!0});var W=z("./filter"),q=z("./logical");B.isFilter=V,B.isLookup=function(Y){return void 0!==Y.lookup},B.isCalculate=function(Y){return void 0!==Y.calculate},B.isBin=function(Y){return!!Y.bin},B.isTimeUnit=function(Y){return void 0!==Y.timeUnit},B.isSummarize=function(Y){return void 0!==Y.summarize},B.normalizeTransform=function(Y){return Y.map(function(G){return V(G)?{filter:q.normalizeLogicalOperand(G.filter,W.normalizeFilter)}:G})}},{"./filter":97,"./logical":102}],113:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V;!function(q){q.QUANTITATIVE="quantitative",q.ORDINAL="ordinal",q.TEMPORAL="temporal",q.NOMINAL="nominal"}(V=B.Type||(B.Type={}));var W={quantitative:1,ordinal:1,temporal:1,nominal:1};B.isType=function(q){return!!W[q]},B.QUANTITATIVE=V.QUANTITATIVE,B.ORDINAL=V.ORDINAL,B.TEMPORAL=V.TEMPORAL,B.NOMINAL=V.NOMINAL,B.getFullName=function(q){if(q)switch(q=q.toLowerCase()){case"q":case B.QUANTITATIVE:return"quantitative";case"t":case B.TEMPORAL:return"temporal";case"o":case B.ORDINAL:return"ordinal";case"n":case B.NOMINAL:return"nominal";}}},{}],114:[function(z,H,B){"use strict";function V(ee,te){return-1<ee.indexOf(te)}function W(ee,te){return ee.filter(function(ae){return!V(te,ae)})}function q(ee){for(var te=[],ae=1;ae<arguments.length;ae++)te[ae-1]=arguments[ae];for(var ne=0,ie=te;ne<ie.length;ne++)ee=Y(ee,ie[ne]);return ee}function Y(ee,te){if("object"!=("undefined"===typeof te?"undefined":babelHelpers.typeof(te))||null===te)return ee;for(var ae in te)te.hasOwnProperty(ae)&&void 0!==te[ae]&&("object"!=babelHelpers.typeof(te[ae])||Z.isArray(te[ae])||null===te[ae]?ee[ae]=te[ae]:"object"!=babelHelpers.typeof(ee[ae])||null===ee[ae]?ee[ae]=q(Z.isArray(te[ae].constructor)?[]:{},te[ae]):q(ee[ae],te[ae]));return ee}function G(ee){return JSON.parse(JSON.stringify(ee))}function X(ee){return!0===ee||!1===ee}function K(ee,te){return J.isLogicalNot(ee)?"!("+K(ee.not,te)+")":J.isLogicalAnd(ee)?"("+ee.and.map(function(ae){return K(ae,te)}).join(") && (")+")":J.isLogicalOr(ee)?"("+ee.or.map(function(ae){return K(ae,te)}).join(") || (")+")":te(ee)}Object.defineProperty(B,"__esModule",{value:!0});var Q=z("json-stable-stringify"),Z=z("vega-util"),J=z("./logical"),$=z("vega-util");B.isArray=$.isArray,B.isObject=$.isObject,B.isNumber=$.isNumber,B.isString=$.isString,B.truncate=$.truncate,B.toSet=$.toSet,B.stringValue=$.stringValue,B.pick=function(ee,te){var ae={};return te.forEach(function(ne){ee.hasOwnProperty(ne)&&(ae[ne]=ee[ne])}),ae},B.omit=function(ee,te){var ae=G(ee);return te.forEach(function(ne){delete ae[ne]}),ae},B.hash=function(ee){if(Z.isString(ee)||Z.isNumber(ee)||X(ee))return ee+"";var te=Q(ee);if(100>te.length)return te;for(var ae=0,ne=0;ne<te.length;ne++)ae=(ae<<5)-ae+te.charCodeAt(ne),ae&=ae;return ae},B.contains=V,B.without=W,B.union=function(ee,te){return ee.concat(W(te,ee))},B.some=function(ee,te){for(var ae=0,ne=0;ne<ee.length;ne++)if(te(ee[ne],ne,ae++))return!0;return!1},B.every=function(ee,te){for(var ae=0,ne=0;ne<ee.length;ne++)if(!te(ee[ne],ne,ae++))return!1;return!0},B.flatten=function(ee){return[].concat.apply([],ee)},B.mergeDeep=q,B.unique=function(ee,te){for(var ae,se,ne=[],ie={},oe=0,le=ee;oe<le.length;oe++)se=le[oe],(ae=te(se))in ie||(ie[ae]=1,ne.push(se));return ne},B.differ=function(ee,te){for(var ae in ee)if(ee.hasOwnProperty(ae)&&te[ae]&&ee[ae]&&te[ae]!==ee[ae])return!0;return!1},B.hasIntersection=function(ee,te){for(var ae in ee)if(ae in te)return!0;return!1},B.differArray=function(ee,te){if(ee.length!==te.length)return!0;ee.sort(),te.sort();for(var ae=0;ae<ee.length;ae++)if(te[ae]!==ee[ae])return!0;return!1},B.keys=Object.keys,B.vals=function(ee){var te=[];for(var ae in ee)ee.hasOwnProperty(ae)&&te.push(ee[ae]);return te},B.flagKeys=function(ee){return B.keys(ee)},B.duplicate=G,B.isBoolean=X,B.varName=function(ee){var te=ee.replace(/\W/g,"_");return(ee.match(/^\d+/)?"_":"")+te},B.logicalExpr=K,B.deleteNestedProperty=function(ee,te){for(var ae=!0;0<te.length&&ae;){for(var ne=ee,ie=0;ie<te.length-1;ie++)ne=ne[te[ie]];delete ne[te.pop()],0!==B.keys(ne).length&&(ae=!1)}}},{"./logical":102,"json-stable-stringify":1,"vega-util":7}],115:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./mark"),W=z("./mark"),q=z("./util");B.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},B.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:q.toSet(["row","column","x","y","size","color","detail"]),line:q.toSet(["row","column","x","y","color","detail"]),area:q.toSet(["row","column","x","y","color","detail"]),tick:q.toSet(["row","column","x","y","color","detail"]),circle:q.toSet(["row","column","x","y","color","size","detail"]),square:q.toSet(["row","column","x","y","color","size","detail"]),point:q.toSet(["row","column","x","y","color","size","detail","shape"]),text:q.toSet(["row","column","size","color","text"])},B.getEncodingMappingError=function(Y,G,X){void 0===G&&(G=B.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===X&&(X=B.DEFAULT_SUPPORTED_CHANNEL_TYPE);var K=V.isMarkDef(Y.mark)?Y.mark.type:Y.mark,Q=Y.encoding,Z=G[K],J=X[K];for(var $ in Z)if(!(Z[$]in Q))return"Missing encoding channel \""+Z[$]+"\" for mark \""+K+"\"";for(var ee in Q)if(!J[ee])return"Encoding channel \""+ee+"\" is not supported by mark type \""+K+"\"";return K!==W.BAR||Q.x||Q.y?null:"Missing both x and y for bar"}},{"./mark":103,"./util":114}],116:[function(z,H,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var V=z("./util");B.isVgSignalRef=function(W){return!!W.signal},B.isVgRangeStep=function(W){return!!W.step},B.isDataRefUnionedDomain=function(W){return!V.isArray(W)&&"fields"in W&&!("data"in W)},B.isFieldRefUnionDomain=function(W){return!V.isArray(W)&&"fields"in W&&"data"in W},B.isDataRefDomain=function(W){return!V.isArray(W)&&"field"in W&&"data"in W},B.isSignalRefDomain=function(W){return!V.isArray(W)&&"signal"in W}},{"./util":114}]},{},[99])(99)});</script></head><body></body></html>